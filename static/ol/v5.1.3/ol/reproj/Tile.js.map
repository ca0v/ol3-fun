{"version":3,"file":"Tile.js","sources":["../../../src/ol/reproj/Tile.js"],"sourcesContent":["/**\r\n * @module ol/reproj/Tile\r\n */\r\nimport {ERROR_THRESHOLD} from './common.js';\r\n\r\nimport Tile from '../Tile.js';\r\nimport TileState from '../TileState.js';\r\nimport {listen, unlistenByKey} from '../events.js';\r\nimport EventType from '../events/EventType.js';\r\nimport {getArea, getCenter, getIntersection} from '../extent.js';\r\nimport {clamp} from '../math.js';\r\nimport {calculateSourceResolution, render as renderReprojected} from '../reproj.js';\r\nimport Triangulation from '../reproj/Triangulation.js';\r\n\r\n\r\n/**\r\n * @typedef {function(number, number, number, number) : module:ol/Tile} FunctionType\r\n */\r\n\r\n\r\n/**\r\n * @classdesc\r\n * Class encapsulating single reprojected tile.\r\n * See {@link module:ol/source/TileImage~TileImage}.\r\n *\r\n */\r\nclass ReprojTile extends Tile {\r\n  /**\r\n   * @param {module:ol/proj/Projection} sourceProj Source projection.\r\n   * @param {module:ol/tilegrid/TileGrid} sourceTileGrid Source tile grid.\r\n   * @param {module:ol/proj/Projection} targetProj Target projection.\r\n   * @param {module:ol/tilegrid/TileGrid} targetTileGrid Target tile grid.\r\n   * @param {module:ol/tilecoord~TileCoord} tileCoord Coordinate of the tile.\r\n   * @param {module:ol/tilecoord~TileCoord} wrappedTileCoord Coordinate of the tile wrapped in X.\r\n   * @param {number} pixelRatio Pixel ratio.\r\n   * @param {number} gutter Gutter of the source tiles.\r\n   * @param {module:ol/reproj/Tile~FunctionType} getTileFunction\r\n   *     Function returning source tiles (z, x, y, pixelRatio).\r\n   * @param {number=} opt_errorThreshold Acceptable reprojection error (in px).\r\n   * @param {boolean=} opt_renderEdges Render reprojection edges.\r\n   */\r\n  constructor(\r\n    sourceProj,\r\n    sourceTileGrid,\r\n    targetProj,\r\n    targetTileGrid,\r\n    tileCoord,\r\n    wrappedTileCoord,\r\n    pixelRatio,\r\n    gutter,\r\n    getTileFunction,\r\n    opt_errorThreshold,\r\n    opt_renderEdges\r\n  ) {\r\n    super(tileCoord, TileState.IDLE);\r\n\r\n    /**\r\n     * @private\r\n     * @type {boolean}\r\n     */\r\n    this.renderEdges_ = opt_renderEdges !== undefined ? opt_renderEdges : false;\r\n\r\n    /**\r\n     * @private\r\n     * @type {number}\r\n     */\r\n    this.pixelRatio_ = pixelRatio;\r\n\r\n    /**\r\n     * @private\r\n     * @type {number}\r\n     */\r\n    this.gutter_ = gutter;\r\n\r\n    /**\r\n     * @private\r\n     * @type {HTMLCanvasElement}\r\n     */\r\n    this.canvas_ = null;\r\n\r\n    /**\r\n     * @private\r\n     * @type {module:ol/tilegrid/TileGrid}\r\n     */\r\n    this.sourceTileGrid_ = sourceTileGrid;\r\n\r\n    /**\r\n     * @private\r\n     * @type {module:ol/tilegrid/TileGrid}\r\n     */\r\n    this.targetTileGrid_ = targetTileGrid;\r\n\r\n    /**\r\n     * @private\r\n     * @type {module:ol/tilecoord~TileCoord}\r\n     */\r\n    this.wrappedTileCoord_ = wrappedTileCoord ? wrappedTileCoord : tileCoord;\r\n\r\n    /**\r\n     * @private\r\n     * @type {!Array.<module:ol/Tile>}\r\n     */\r\n    this.sourceTiles_ = [];\r\n\r\n    /**\r\n     * @private\r\n     * @type {Array.<module:ol/events~EventsKey>}\r\n     */\r\n    this.sourcesListenerKeys_ = null;\r\n\r\n    /**\r\n     * @private\r\n     * @type {number}\r\n     */\r\n    this.sourceZ_ = 0;\r\n\r\n    const targetExtent = targetTileGrid.getTileCoordExtent(this.wrappedTileCoord_);\r\n    const maxTargetExtent = this.targetTileGrid_.getExtent();\r\n    let maxSourceExtent = this.sourceTileGrid_.getExtent();\r\n\r\n    const limitedTargetExtent = maxTargetExtent ?\r\n      getIntersection(targetExtent, maxTargetExtent) : targetExtent;\r\n\r\n    if (getArea(limitedTargetExtent) === 0) {\r\n      // Tile is completely outside range -> EMPTY\r\n      // TODO: is it actually correct that the source even creates the tile ?\r\n      this.state = TileState.EMPTY;\r\n      return;\r\n    }\r\n\r\n    const sourceProjExtent = sourceProj.getExtent();\r\n    if (sourceProjExtent) {\r\n      if (!maxSourceExtent) {\r\n        maxSourceExtent = sourceProjExtent;\r\n      } else {\r\n        maxSourceExtent = getIntersection(maxSourceExtent, sourceProjExtent);\r\n      }\r\n    }\r\n\r\n    const targetResolution = targetTileGrid.getResolution(\r\n      this.wrappedTileCoord_[0]);\r\n\r\n    const targetCenter = getCenter(limitedTargetExtent);\r\n    const sourceResolution = calculateSourceResolution(\r\n      sourceProj, targetProj, targetCenter, targetResolution);\r\n\r\n    if (!isFinite(sourceResolution) || sourceResolution <= 0) {\r\n      // invalid sourceResolution -> EMPTY\r\n      // probably edges of the projections when no extent is defined\r\n      this.state = TileState.EMPTY;\r\n      return;\r\n    }\r\n\r\n    const errorThresholdInPixels = opt_errorThreshold !== undefined ?\r\n      opt_errorThreshold : ERROR_THRESHOLD;\r\n\r\n    /**\r\n     * @private\r\n     * @type {!module:ol/reproj/Triangulation}\r\n     */\r\n    this.triangulation_ = new Triangulation(\r\n      sourceProj, targetProj, limitedTargetExtent, maxSourceExtent,\r\n      sourceResolution * errorThresholdInPixels);\r\n\r\n    if (this.triangulation_.getTriangles().length === 0) {\r\n      // no valid triangles -> EMPTY\r\n      this.state = TileState.EMPTY;\r\n      return;\r\n    }\r\n\r\n    this.sourceZ_ = sourceTileGrid.getZForResolution(sourceResolution);\r\n    let sourceExtent = this.triangulation_.calculateSourceExtent();\r\n\r\n    if (maxSourceExtent) {\r\n      if (sourceProj.canWrapX()) {\r\n        sourceExtent[1] = clamp(\r\n          sourceExtent[1], maxSourceExtent[1], maxSourceExtent[3]);\r\n        sourceExtent[3] = clamp(\r\n          sourceExtent[3], maxSourceExtent[1], maxSourceExtent[3]);\r\n      } else {\r\n        sourceExtent = getIntersection(sourceExtent, maxSourceExtent);\r\n      }\r\n    }\r\n\r\n    if (!getArea(sourceExtent)) {\r\n      this.state = TileState.EMPTY;\r\n    } else {\r\n      const sourceRange = sourceTileGrid.getTileRangeForExtentAndZ(\r\n        sourceExtent, this.sourceZ_);\r\n\r\n      for (let srcX = sourceRange.minX; srcX <= sourceRange.maxX; srcX++) {\r\n        for (let srcY = sourceRange.minY; srcY <= sourceRange.maxY; srcY++) {\r\n          const tile = getTileFunction(this.sourceZ_, srcX, srcY, pixelRatio);\r\n          if (tile) {\r\n            this.sourceTiles_.push(tile);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (this.sourceTiles_.length === 0) {\r\n        this.state = TileState.EMPTY;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  disposeInternal() {\r\n    if (this.state == TileState.LOADING) {\r\n      this.unlistenSources_();\r\n    }\r\n    Tile.prototype.disposeInternal.call(this);\r\n  }\r\n\r\n  /**\r\n   * Get the HTML Canvas element for this tile.\r\n   * @return {HTMLCanvasElement} Canvas.\r\n   */\r\n  getImage() {\r\n    return this.canvas_;\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  reproject_() {\r\n    const sources = [];\r\n    this.sourceTiles_.forEach(function(tile, i, arr) {\r\n      if (tile && tile.getState() == TileState.LOADED) {\r\n        sources.push({\r\n          extent: this.sourceTileGrid_.getTileCoordExtent(tile.tileCoord),\r\n          image: tile.getImage()\r\n        });\r\n      }\r\n    }.bind(this));\r\n    this.sourceTiles_.length = 0;\r\n\r\n    if (sources.length === 0) {\r\n      this.state = TileState.ERROR;\r\n    } else {\r\n      const z = this.wrappedTileCoord_[0];\r\n      const size = this.targetTileGrid_.getTileSize(z);\r\n      const width = typeof size === 'number' ? size : size[0];\r\n      const height = typeof size === 'number' ? size : size[1];\r\n      const targetResolution = this.targetTileGrid_.getResolution(z);\r\n      const sourceResolution = this.sourceTileGrid_.getResolution(this.sourceZ_);\r\n\r\n      const targetExtent = this.targetTileGrid_.getTileCoordExtent(\r\n        this.wrappedTileCoord_);\r\n      this.canvas_ = renderReprojected(width, height, this.pixelRatio_,\r\n        sourceResolution, this.sourceTileGrid_.getExtent(),\r\n        targetResolution, targetExtent, this.triangulation_, sources,\r\n        this.gutter_, this.renderEdges_);\r\n\r\n      this.state = TileState.LOADED;\r\n    }\r\n    this.changed();\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  load() {\r\n    if (this.state == TileState.IDLE) {\r\n      this.state = TileState.LOADING;\r\n      this.changed();\r\n\r\n      let leftToLoad = 0;\r\n\r\n      this.sourcesListenerKeys_ = [];\r\n      this.sourceTiles_.forEach(function(tile, i, arr) {\r\n        const state = tile.getState();\r\n        if (state == TileState.IDLE || state == TileState.LOADING) {\r\n          leftToLoad++;\r\n\r\n          const sourceListenKey = listen(tile, EventType.CHANGE,\r\n            function(e) {\r\n              const state = tile.getState();\r\n              if (state == TileState.LOADED ||\r\n                    state == TileState.ERROR ||\r\n                    state == TileState.EMPTY) {\r\n                unlistenByKey(sourceListenKey);\r\n                leftToLoad--;\r\n                if (leftToLoad === 0) {\r\n                  this.unlistenSources_();\r\n                  this.reproject_();\r\n                }\r\n              }\r\n            }, this);\r\n          this.sourcesListenerKeys_.push(sourceListenKey);\r\n        }\r\n      }.bind(this));\r\n\r\n      this.sourceTiles_.forEach(function(tile, i, arr) {\r\n        const state = tile.getState();\r\n        if (state == TileState.IDLE) {\r\n          tile.load();\r\n        }\r\n      });\r\n\r\n      if (leftToLoad === 0) {\r\n        setTimeout(this.reproject_.bind(this), 0);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  unlistenSources_() {\r\n    this.sourcesListenerKeys_.forEach(unlistenByKey);\r\n    this.sourcesListenerKeys_ = null;\r\n  }\r\n}\r\n\r\n\r\nexport default ReprojTile;\r\n"],"names":["super","const","let","this"],"mappings":"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"}