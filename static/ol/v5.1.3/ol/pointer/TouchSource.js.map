{"version":3,"file":"TouchSource.js","sources":["../../../src/ol/pointer/TouchSource.js"],"sourcesContent":["/**\r\n * @module ol/pointer/TouchSource\r\n */\r\n\r\n// Based on https://github.com/Polymer/PointerEvents\r\n\r\n// Copyright (c) 2013 The Polymer Authors. All rights reserved.\r\n//\r\n// Redistribution and use in source and binary forms, with or without\r\n// modification, are permitted provided that the following conditions are\r\n// met:\r\n//\r\n// * Redistributions of source code must retain the above copyright\r\n// notice, this list of conditions and the following disclaimer.\r\n// * Redistributions in binary form must reproduce the above\r\n// copyright notice, this list of conditions and the following disclaimer\r\n// in the documentation and/or other materials provided with the\r\n// distribution.\r\n// * Neither the name of Google Inc. nor the names of its\r\n// contributors may be used to endorse or promote products derived from\r\n// this software without specific prior written permission.\r\n//\r\n// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\r\n// \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\r\n// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\r\n// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\r\n// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\r\n// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\r\n// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\r\n// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\r\n// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\r\n// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n\r\nimport {remove} from '../array.js';\r\nimport EventSource from '../pointer/EventSource.js';\r\nimport {POINTER_ID} from '../pointer/MouseSource.js';\r\n\r\n\r\n/**\r\n * @type {number}\r\n */\r\nconst CLICK_COUNT_TIMEOUT = 200;\r\n\r\n/**\r\n * @type {string}\r\n */\r\nconst POINTER_TYPE = 'touch';\r\n\r\n/**\r\n * Handler for `touchstart`, triggers `pointerover`,\r\n * `pointerenter` and `pointerdown` events.\r\n *\r\n * @this {module:ol/pointer/TouchSource}\r\n * @param {TouchEvent} inEvent The in event.\r\n */\r\nfunction touchstart(inEvent) {\r\n  this.vacuumTouches_(inEvent);\r\n  this.setPrimaryTouch_(inEvent.changedTouches[0]);\r\n  this.dedupSynthMouse_(inEvent);\r\n  this.clickCount_++;\r\n  this.processTouches_(inEvent, this.overDown_);\r\n}\r\n\r\n/**\r\n * Handler for `touchmove`.\r\n *\r\n * @this {module:ol/pointer/TouchSource}\r\n * @param {TouchEvent} inEvent The in event.\r\n */\r\nfunction touchmove(inEvent) {\r\n  inEvent.preventDefault();\r\n  this.processTouches_(inEvent, this.moveOverOut_);\r\n}\r\n\r\n/**\r\n * Handler for `touchend`, triggers `pointerup`,\r\n * `pointerout` and `pointerleave` events.\r\n *\r\n * @this {module:ol/pointer/TouchSource}\r\n * @param {TouchEvent} inEvent The event.\r\n */\r\nfunction touchend(inEvent) {\r\n  this.dedupSynthMouse_(inEvent);\r\n  this.processTouches_(inEvent, this.upOut_);\r\n}\r\n\r\n/**\r\n * Handler for `touchcancel`, triggers `pointercancel`,\r\n * `pointerout` and `pointerleave` events.\r\n *\r\n * @this {module:ol/pointer/TouchSource}\r\n * @param {TouchEvent} inEvent The in event.\r\n */\r\nfunction touchcancel(inEvent) {\r\n  this.processTouches_(inEvent, this.cancelOut_);\r\n}\r\n\r\n\r\nclass TouchSource extends EventSource {\r\n\r\n  /**\r\n   * @param {module:ol/pointer/PointerEventHandler} dispatcher The event handler.\r\n   * @param {module:ol/pointer/MouseSource} mouseSource Mouse source.\r\n   */\r\n  constructor(dispatcher, mouseSource) {\r\n    const mapping = {\r\n      'touchstart': touchstart,\r\n      'touchmove': touchmove,\r\n      'touchend': touchend,\r\n      'touchcancel': touchcancel\r\n    };\r\n    super(dispatcher, mapping);\r\n\r\n    /**\r\n     * @const\r\n     * @type {!Object.<string, Event|Object>}\r\n     */\r\n    this.pointerMap = dispatcher.pointerMap;\r\n\r\n    /**\r\n     * @const\r\n     * @type {module:ol/pointer/MouseSource}\r\n     */\r\n    this.mouseSource = mouseSource;\r\n\r\n    /**\r\n     * @private\r\n     * @type {number|undefined}\r\n     */\r\n    this.firstTouchId_ = undefined;\r\n\r\n    /**\r\n     * @private\r\n     * @type {number}\r\n     */\r\n    this.clickCount_ = 0;\r\n\r\n    /**\r\n     * @private\r\n     * @type {number|undefined}\r\n     */\r\n    this.resetId_ = undefined;\r\n\r\n    /**\r\n     * Mouse event timeout: This should be long enough to\r\n     * ignore compat mouse events made by touch.\r\n     * @private\r\n     * @type {number}\r\n     */\r\n    this.dedupTimeout_ = 2500;\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {Touch} inTouch The in touch.\r\n   * @return {boolean} True, if this is the primary touch.\r\n   */\r\n  isPrimaryTouch_(inTouch) {\r\n    return this.firstTouchId_ === inTouch.identifier;\r\n  }\r\n\r\n  /**\r\n   * Set primary touch if there are no pointers, or the only pointer is the mouse.\r\n   * @param {Touch} inTouch The in touch.\r\n   * @private\r\n   */\r\n  setPrimaryTouch_(inTouch) {\r\n    const count = Object.keys(this.pointerMap).length;\r\n    if (count === 0 || (count === 1 && POINTER_ID.toString() in this.pointerMap)) {\r\n      this.firstTouchId_ = inTouch.identifier;\r\n      this.cancelResetClickCount_();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {PointerEvent} inPointer The in pointer object.\r\n   */\r\n  removePrimaryPointer_(inPointer) {\r\n    if (inPointer.isPrimary) {\r\n      this.firstTouchId_ = undefined;\r\n      this.resetClickCount_();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  resetClickCount_() {\r\n    this.resetId_ = setTimeout(\r\n      this.resetClickCountHandler_.bind(this),\r\n      CLICK_COUNT_TIMEOUT);\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  resetClickCountHandler_() {\r\n    this.clickCount_ = 0;\r\n    this.resetId_ = undefined;\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  cancelResetClickCount_() {\r\n    if (this.resetId_ !== undefined) {\r\n      clearTimeout(this.resetId_);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {TouchEvent} browserEvent Browser event\r\n   * @param {Touch} inTouch Touch event\r\n   * @return {PointerEvent} A pointer object.\r\n   */\r\n  touchToPointer_(browserEvent, inTouch) {\r\n    const e = this.dispatcher.cloneEvent(browserEvent, inTouch);\r\n    // Spec specifies that pointerId 1 is reserved for Mouse.\r\n    // Touch identifiers can start at 0.\r\n    // Add 2 to the touch identifier for compatibility.\r\n    e.pointerId = inTouch.identifier + 2;\r\n    // TODO: check if this is necessary?\r\n    //e.target = findTarget(e);\r\n    e.bubbles = true;\r\n    e.cancelable = true;\r\n    e.detail = this.clickCount_;\r\n    e.button = 0;\r\n    e.buttons = 1;\r\n    e.width = inTouch.webkitRadiusX || inTouch.radiusX || 0;\r\n    e.height = inTouch.webkitRadiusY || inTouch.radiusY || 0;\r\n    e.pressure = inTouch.webkitForce || inTouch.force || 0.5;\r\n    e.isPrimary = this.isPrimaryTouch_(inTouch);\r\n    e.pointerType = POINTER_TYPE;\r\n\r\n    // make sure that the properties that are different for\r\n    // each `Touch` object are not copied from the BrowserEvent object\r\n    e.clientX = inTouch.clientX;\r\n    e.clientY = inTouch.clientY;\r\n    e.screenX = inTouch.screenX;\r\n    e.screenY = inTouch.screenY;\r\n\r\n    return e;\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {TouchEvent} inEvent Touch event\r\n   * @param {function(TouchEvent, PointerEvent)} inFunction In function.\r\n   */\r\n  processTouches_(inEvent, inFunction) {\r\n    const touches = Array.prototype.slice.call(inEvent.changedTouches);\r\n    const count = touches.length;\r\n    function preventDefault() {\r\n      inEvent.preventDefault();\r\n    }\r\n    for (let i = 0; i < count; ++i) {\r\n      const pointer = this.touchToPointer_(inEvent, touches[i]);\r\n      // forward touch preventDefaults\r\n      pointer.preventDefault = preventDefault;\r\n      inFunction.call(this, inEvent, pointer);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {TouchList} touchList The touch list.\r\n   * @param {number} searchId Search identifier.\r\n   * @return {boolean} True, if the `Touch` with the given id is in the list.\r\n   */\r\n  findTouch_(touchList, searchId) {\r\n    const l = touchList.length;\r\n    for (let i = 0; i < l; i++) {\r\n      const touch = touchList[i];\r\n      if (touch.identifier === searchId) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * In some instances, a touchstart can happen without a touchend. This\r\n   * leaves the pointermap in a broken state.\r\n   * Therefore, on every touchstart, we remove the touches that did not fire a\r\n   * touchend event.\r\n   * To keep state globally consistent, we fire a pointercancel for\r\n   * this \"abandoned\" touch\r\n   *\r\n   * @private\r\n   * @param {TouchEvent} inEvent The in event.\r\n   */\r\n  vacuumTouches_(inEvent) {\r\n    const touchList = inEvent.touches;\r\n    // pointerMap.getCount() should be < touchList.length here,\r\n    // as the touchstart has not been processed yet.\r\n    const keys = Object.keys(this.pointerMap);\r\n    const count = keys.length;\r\n    if (count >= touchList.length) {\r\n      const d = [];\r\n      for (let i = 0; i < count; ++i) {\r\n        const key = keys[i];\r\n        const value = this.pointerMap[key];\r\n        // Never remove pointerId == 1, which is mouse.\r\n        // Touch identifiers are 2 smaller than their pointerId, which is the\r\n        // index in pointermap.\r\n        if (key != POINTER_ID && !this.findTouch_(touchList, key - 2)) {\r\n          d.push(value.out);\r\n        }\r\n      }\r\n      for (let i = 0; i < d.length; ++i) {\r\n        this.cancelOut_(inEvent, d[i]);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {TouchEvent} browserEvent The event.\r\n   * @param {PointerEvent} inPointer The in pointer object.\r\n   */\r\n  overDown_(browserEvent, inPointer) {\r\n    this.pointerMap[inPointer.pointerId] = {\r\n      target: inPointer.target,\r\n      out: inPointer,\r\n      outTarget: inPointer.target\r\n    };\r\n    this.dispatcher.over(inPointer, browserEvent);\r\n    this.dispatcher.enter(inPointer, browserEvent);\r\n    this.dispatcher.down(inPointer, browserEvent);\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {TouchEvent} browserEvent The event.\r\n   * @param {PointerEvent} inPointer The in pointer.\r\n   */\r\n  moveOverOut_(browserEvent, inPointer) {\r\n    const event = inPointer;\r\n    const pointer = this.pointerMap[event.pointerId];\r\n    // a finger drifted off the screen, ignore it\r\n    if (!pointer) {\r\n      return;\r\n    }\r\n    const outEvent = pointer.out;\r\n    const outTarget = pointer.outTarget;\r\n    this.dispatcher.move(event, browserEvent);\r\n    if (outEvent && outTarget !== event.target) {\r\n      outEvent.relatedTarget = event.target;\r\n      event.relatedTarget = outTarget;\r\n      // recover from retargeting by shadow\r\n      outEvent.target = outTarget;\r\n      if (event.target) {\r\n        this.dispatcher.leaveOut(outEvent, browserEvent);\r\n        this.dispatcher.enterOver(event, browserEvent);\r\n      } else {\r\n        // clean up case when finger leaves the screen\r\n        event.target = outTarget;\r\n        event.relatedTarget = null;\r\n        this.cancelOut_(browserEvent, event);\r\n      }\r\n    }\r\n    pointer.out = event;\r\n    pointer.outTarget = event.target;\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {TouchEvent} browserEvent An event.\r\n   * @param {PointerEvent} inPointer The inPointer object.\r\n   */\r\n  upOut_(browserEvent, inPointer) {\r\n    this.dispatcher.up(inPointer, browserEvent);\r\n    this.dispatcher.out(inPointer, browserEvent);\r\n    this.dispatcher.leave(inPointer, browserEvent);\r\n    this.cleanUpPointer_(inPointer);\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {TouchEvent} browserEvent The event.\r\n   * @param {PointerEvent} inPointer The in pointer.\r\n   */\r\n  cancelOut_(browserEvent, inPointer) {\r\n    this.dispatcher.cancel(inPointer, browserEvent);\r\n    this.dispatcher.out(inPointer, browserEvent);\r\n    this.dispatcher.leave(inPointer, browserEvent);\r\n    this.cleanUpPointer_(inPointer);\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {PointerEvent} inPointer The inPointer object.\r\n   */\r\n  cleanUpPointer_(inPointer) {\r\n    delete this.pointerMap[inPointer.pointerId];\r\n    this.removePrimaryPointer_(inPointer);\r\n  }\r\n\r\n  /**\r\n   * Prevent synth mouse events from creating pointer events.\r\n   *\r\n   * @private\r\n   * @param {TouchEvent} inEvent The in event.\r\n   */\r\n  dedupSynthMouse_(inEvent) {\r\n    const lts = this.mouseSource.lastTouches;\r\n    const t = inEvent.changedTouches[0];\r\n    // only the primary finger will synth mouse events\r\n    if (this.isPrimaryTouch_(t)) {\r\n      // remember x/y of last touch\r\n      const lt = [t.clientX, t.clientY];\r\n      lts.push(lt);\r\n\r\n      setTimeout(function() {\r\n        // remove touch after timeout\r\n        remove(lts, lt);\r\n      }, this.dedupTimeout_);\r\n    }\r\n  }\r\n}\r\n\r\nexport default TouchSource;\r\n"],"names":["const","super","let","this","i"],"mappings":"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"}