{"version":3,"file":"Context.js","sources":["../../../src/ol/webgl/Context.js"],"sourcesContent":["/**\r\n * @module ol/webgl/Context\r\n */\r\nimport {getUid} from '../util.js';\r\nimport {EXTENSIONS as WEBGL_EXTENSIONS} from '../webgl.js';\r\nimport Disposable from '../Disposable.js';\r\nimport {includes} from '../array.js';\r\nimport {listen, unlistenAll} from '../events.js';\r\nimport {clear} from '../obj.js';\r\nimport {ARRAY_BUFFER, ELEMENT_ARRAY_BUFFER, TEXTURE_2D, TEXTURE_WRAP_S, TEXTURE_WRAP_T} from '../webgl.js';\r\nimport ContextEventType from '../webgl/ContextEventType.js';\r\n\r\n\r\n/**\r\n * @typedef {Object} BufferCacheEntry\r\n * @property {module:ol/webgl/Buffer} buf\r\n * @property {WebGLBuffer} buffer\r\n */\r\n\r\n\r\n/**\r\n * @classdesc\r\n * A WebGL context for accessing low-level WebGL capabilities.\r\n */\r\nclass WebGLContext extends Disposable {\r\n\r\n  /**\r\n   * @param {HTMLCanvasElement} canvas Canvas.\r\n   * @param {WebGLRenderingContext} gl GL.\r\n   */\r\n  constructor(canvas, gl) {\r\n    super();\r\n\r\n    /**\r\n     * @private\r\n     * @type {HTMLCanvasElement}\r\n     */\r\n    this.canvas_ = canvas;\r\n\r\n    /**\r\n     * @private\r\n     * @type {WebGLRenderingContext}\r\n     */\r\n    this.gl_ = gl;\r\n\r\n    /**\r\n     * @private\r\n     * @type {!Object.<string, module:ol/webgl/Context~BufferCacheEntry>}\r\n     */\r\n    this.bufferCache_ = {};\r\n\r\n    /**\r\n     * @private\r\n     * @type {!Object.<string, WebGLShader>}\r\n     */\r\n    this.shaderCache_ = {};\r\n\r\n    /**\r\n     * @private\r\n     * @type {!Object.<string, WebGLProgram>}\r\n     */\r\n    this.programCache_ = {};\r\n\r\n    /**\r\n     * @private\r\n     * @type {WebGLProgram}\r\n     */\r\n    this.currentProgram_ = null;\r\n\r\n    /**\r\n     * @private\r\n     * @type {WebGLFramebuffer}\r\n     */\r\n    this.hitDetectionFramebuffer_ = null;\r\n\r\n    /**\r\n     * @private\r\n     * @type {WebGLTexture}\r\n     */\r\n    this.hitDetectionTexture_ = null;\r\n\r\n    /**\r\n     * @private\r\n     * @type {WebGLRenderbuffer}\r\n     */\r\n    this.hitDetectionRenderbuffer_ = null;\r\n\r\n    /**\r\n     * @type {boolean}\r\n     */\r\n    this.hasOESElementIndexUint = includes(WEBGL_EXTENSIONS, 'OES_element_index_uint');\r\n\r\n    // use the OES_element_index_uint extension if available\r\n    if (this.hasOESElementIndexUint) {\r\n      gl.getExtension('OES_element_index_uint');\r\n    }\r\n\r\n    listen(this.canvas_, ContextEventType.LOST,\r\n      this.handleWebGLContextLost, this);\r\n    listen(this.canvas_, ContextEventType.RESTORED,\r\n      this.handleWebGLContextRestored, this);\r\n\r\n  }\r\n\r\n  /**\r\n   * Just bind the buffer if it's in the cache. Otherwise create\r\n   * the WebGL buffer, bind it, populate it, and add an entry to\r\n   * the cache.\r\n   * @param {number} target Target.\r\n   * @param {module:ol/webgl/Buffer} buf Buffer.\r\n   */\r\n  bindBuffer(target, buf) {\r\n    const gl = this.getGL();\r\n    const arr = buf.getArray();\r\n    const bufferKey = String(getUid(buf));\r\n    if (bufferKey in this.bufferCache_) {\r\n      const bufferCacheEntry = this.bufferCache_[bufferKey];\r\n      gl.bindBuffer(target, bufferCacheEntry.buffer);\r\n    } else {\r\n      const buffer = gl.createBuffer();\r\n      gl.bindBuffer(target, buffer);\r\n      let /** @type {ArrayBufferView} */ arrayBuffer;\r\n      if (target == ARRAY_BUFFER) {\r\n        arrayBuffer = new Float32Array(arr);\r\n      } else if (target == ELEMENT_ARRAY_BUFFER) {\r\n        arrayBuffer = this.hasOESElementIndexUint ?\r\n          new Uint32Array(arr) : new Uint16Array(arr);\r\n      }\r\n      gl.bufferData(target, arrayBuffer, buf.getUsage());\r\n      this.bufferCache_[bufferKey] = {\r\n        buf: buf,\r\n        buffer: buffer\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param {module:ol/webgl/Buffer} buf Buffer.\r\n   */\r\n  deleteBuffer(buf) {\r\n    const gl = this.getGL();\r\n    const bufferKey = String(getUid(buf));\r\n    const bufferCacheEntry = this.bufferCache_[bufferKey];\r\n    if (!gl.isContextLost()) {\r\n      gl.deleteBuffer(bufferCacheEntry.buffer);\r\n    }\r\n    delete this.bufferCache_[bufferKey];\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  disposeInternal() {\r\n    unlistenAll(this.canvas_);\r\n    const gl = this.getGL();\r\n    if (!gl.isContextLost()) {\r\n      for (const key in this.bufferCache_) {\r\n        gl.deleteBuffer(this.bufferCache_[key].buffer);\r\n      }\r\n      for (const key in this.programCache_) {\r\n        gl.deleteProgram(this.programCache_[key]);\r\n      }\r\n      for (const key in this.shaderCache_) {\r\n        gl.deleteShader(this.shaderCache_[key]);\r\n      }\r\n      // delete objects for hit-detection\r\n      gl.deleteFramebuffer(this.hitDetectionFramebuffer_);\r\n      gl.deleteRenderbuffer(this.hitDetectionRenderbuffer_);\r\n      gl.deleteTexture(this.hitDetectionTexture_);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @return {HTMLCanvasElement} Canvas.\r\n   */\r\n  getCanvas() {\r\n    return this.canvas_;\r\n  }\r\n\r\n  /**\r\n   * Get the WebGL rendering context\r\n   * @return {WebGLRenderingContext} The rendering context.\r\n   * @api\r\n   */\r\n  getGL() {\r\n    return this.gl_;\r\n  }\r\n\r\n  /**\r\n   * Get the frame buffer for hit detection.\r\n   * @return {WebGLFramebuffer} The hit detection frame buffer.\r\n   */\r\n  getHitDetectionFramebuffer() {\r\n    if (!this.hitDetectionFramebuffer_) {\r\n      this.initHitDetectionFramebuffer_();\r\n    }\r\n    return this.hitDetectionFramebuffer_;\r\n  }\r\n\r\n  /**\r\n   * Get shader from the cache if it's in the cache. Otherwise, create\r\n   * the WebGL shader, compile it, and add entry to cache.\r\n   * @param {module:ol/webgl/Shader} shaderObject Shader object.\r\n   * @return {WebGLShader} Shader.\r\n   */\r\n  getShader(shaderObject) {\r\n    const shaderKey = String(getUid(shaderObject));\r\n    if (shaderKey in this.shaderCache_) {\r\n      return this.shaderCache_[shaderKey];\r\n    } else {\r\n      const gl = this.getGL();\r\n      const shader = gl.createShader(shaderObject.getType());\r\n      gl.shaderSource(shader, shaderObject.getSource());\r\n      gl.compileShader(shader);\r\n      this.shaderCache_[shaderKey] = shader;\r\n      return shader;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the program from the cache if it's in the cache. Otherwise create\r\n   * the WebGL program, attach the shaders to it, and add an entry to the\r\n   * cache.\r\n   * @param {module:ol/webgl/Fragment} fragmentShaderObject Fragment shader.\r\n   * @param {module:ol/webgl/Vertex} vertexShaderObject Vertex shader.\r\n   * @return {WebGLProgram} Program.\r\n   */\r\n  getProgram(fragmentShaderObject, vertexShaderObject) {\r\n    const programKey = getUid(fragmentShaderObject) + '/' + getUid(vertexShaderObject);\r\n    if (programKey in this.programCache_) {\r\n      return this.programCache_[programKey];\r\n    } else {\r\n      const gl = this.getGL();\r\n      const program = gl.createProgram();\r\n      gl.attachShader(program, this.getShader(fragmentShaderObject));\r\n      gl.attachShader(program, this.getShader(vertexShaderObject));\r\n      gl.linkProgram(program);\r\n      this.programCache_[programKey] = program;\r\n      return program;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * FIXME empty description for jsdoc\r\n   */\r\n  handleWebGLContextLost() {\r\n    clear(this.bufferCache_);\r\n    clear(this.shaderCache_);\r\n    clear(this.programCache_);\r\n    this.currentProgram_ = null;\r\n    this.hitDetectionFramebuffer_ = null;\r\n    this.hitDetectionTexture_ = null;\r\n    this.hitDetectionRenderbuffer_ = null;\r\n  }\r\n\r\n  /**\r\n   * FIXME empty description for jsdoc\r\n   */\r\n  handleWebGLContextRestored() {\r\n  }\r\n\r\n  /**\r\n   * Creates a 1x1 pixel framebuffer for the hit-detection.\r\n   * @private\r\n   */\r\n  initHitDetectionFramebuffer_() {\r\n    const gl = this.gl_;\r\n    const framebuffer = gl.createFramebuffer();\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\r\n\r\n    const texture = createEmptyTexture(gl, 1, 1);\r\n    const renderbuffer = gl.createRenderbuffer();\r\n    gl.bindRenderbuffer(gl.RENDERBUFFER, renderbuffer);\r\n    gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, 1, 1);\r\n    gl.framebufferTexture2D(\r\n      gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\r\n    gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT,\r\n      gl.RENDERBUFFER, renderbuffer);\r\n\r\n    gl.bindTexture(gl.TEXTURE_2D, null);\r\n    gl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n\r\n    this.hitDetectionFramebuffer_ = framebuffer;\r\n    this.hitDetectionTexture_ = texture;\r\n    this.hitDetectionRenderbuffer_ = renderbuffer;\r\n  }\r\n\r\n  /**\r\n   * Use a program.  If the program is already in use, this will return `false`.\r\n   * @param {WebGLProgram} program Program.\r\n   * @return {boolean} Changed.\r\n   * @api\r\n   */\r\n  useProgram(program) {\r\n    if (program == this.currentProgram_) {\r\n      return false;\r\n    } else {\r\n      const gl = this.getGL();\r\n      gl.useProgram(program);\r\n      this.currentProgram_ = program;\r\n      return true;\r\n    }\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * @param {WebGLRenderingContext} gl WebGL rendering context.\r\n * @param {number=} opt_wrapS wrapS.\r\n * @param {number=} opt_wrapT wrapT.\r\n * @return {WebGLTexture} The texture.\r\n */\r\nfunction createTextureInternal(gl, opt_wrapS, opt_wrapT) {\r\n  const texture = gl.createTexture();\r\n  gl.bindTexture(gl.TEXTURE_2D, texture);\r\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n\r\n  if (opt_wrapS !== undefined) {\r\n    gl.texParameteri(\r\n      TEXTURE_2D, TEXTURE_WRAP_S, opt_wrapS);\r\n  }\r\n  if (opt_wrapT !== undefined) {\r\n    gl.texParameteri(\r\n      TEXTURE_2D, TEXTURE_WRAP_T, opt_wrapT);\r\n  }\r\n\r\n  return texture;\r\n}\r\n\r\n\r\n/**\r\n * @param {WebGLRenderingContext} gl WebGL rendering context.\r\n * @param {number} width Width.\r\n * @param {number} height Height.\r\n * @param {number=} opt_wrapS wrapS.\r\n * @param {number=} opt_wrapT wrapT.\r\n * @return {WebGLTexture} The texture.\r\n */\r\nexport function createEmptyTexture(gl, width, height, opt_wrapS, opt_wrapT) {\r\n  const texture = createTextureInternal(gl, opt_wrapS, opt_wrapT);\r\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n  return texture;\r\n}\r\n\r\n\r\n/**\r\n * @param {WebGLRenderingContext} gl WebGL rendering context.\r\n * @param {HTMLCanvasElement|HTMLImageElement|HTMLVideoElement} image Image.\r\n * @param {number=} opt_wrapS wrapS.\r\n * @param {number=} opt_wrapT wrapT.\r\n * @return {WebGLTexture} The texture.\r\n */\r\nexport function createTexture(gl, image, opt_wrapS, opt_wrapT) {\r\n  const texture = createTextureInternal(gl, opt_wrapS, opt_wrapT);\r\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\r\n  return texture;\r\n}\r\n\r\nexport default WebGLContext;\r\n"],"names":["super","const","let","key","this"],"mappings":"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"}