{"version":3,"file":"TileLayer.js","sources":["../../../../src/ol/renderer/canvas/TileLayer.js"],"sourcesContent":["/**\r\n * @module ol/renderer/canvas/TileLayer\r\n */\r\nimport {getUid} from '../../util.js';\r\nimport LayerType from '../../LayerType.js';\r\nimport TileRange from '../../TileRange.js';\r\nimport TileState from '../../TileState.js';\r\nimport ViewHint from '../../ViewHint.js';\r\nimport {createCanvasContext2D} from '../../dom.js';\r\nimport {containsExtent, createEmpty, equals, getIntersection, isEmpty} from '../../extent.js';\r\nimport IntermediateCanvasRenderer from '../canvas/IntermediateCanvas.js';\r\nimport {create as createTransform, compose as composeTransform} from '../../transform.js';\r\n\r\n/**\r\n * @classdesc\r\n * Canvas renderer for tile layers.\r\n * @api\r\n */\r\nclass CanvasTileLayerRenderer extends IntermediateCanvasRenderer {\r\n\r\n  /**\r\n   * @param {module:ol/layer/Tile|module:ol/layer/VectorTile} tileLayer Tile layer.\r\n   * @param {boolean=} opt_noContext Skip the context creation.\r\n   */\r\n  constructor(tileLayer, opt_noContext) {\r\n\r\n    super(tileLayer);\r\n\r\n    /**\r\n     * @protected\r\n     * @type {CanvasRenderingContext2D}\r\n     */\r\n    this.context = opt_noContext ? null : createCanvasContext2D();\r\n\r\n    /**\r\n     * @private\r\n     * @type {number}\r\n     */\r\n    this.oversampling_;\r\n\r\n    /**\r\n     * @private\r\n     * @type {module:ol/extent~Extent}\r\n     */\r\n    this.renderedExtent_ = null;\r\n\r\n    /**\r\n     * @protected\r\n     * @type {number}\r\n     */\r\n    this.renderedRevision;\r\n\r\n    /**\r\n     * @protected\r\n     * @type {!Array.<module:ol/Tile>}\r\n     */\r\n    this.renderedTiles = [];\r\n\r\n    /**\r\n     * @private\r\n     * @type {boolean}\r\n     */\r\n    this.newTiles_ = false;\r\n\r\n    /**\r\n     * @protected\r\n     * @type {module:ol/extent~Extent}\r\n     */\r\n    this.tmpExtent = createEmpty();\r\n\r\n    /**\r\n     * @private\r\n     * @type {module:ol/TileRange}\r\n     */\r\n    this.tmpTileRange_ = new TileRange(0, 0, 0, 0);\r\n\r\n    /**\r\n     * @private\r\n     * @type {module:ol/transform~Transform}\r\n     */\r\n    this.imageTransform_ = createTransform();\r\n\r\n    /**\r\n     * @protected\r\n     * @type {number}\r\n     */\r\n    this.zDirection = 0;\r\n\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {module:ol/Tile} tile Tile.\r\n   * @return {boolean} Tile is drawable.\r\n   */\r\n  isDrawableTile_(tile) {\r\n    const tileState = tile.getState();\r\n    const useInterimTilesOnError = this.getLayer().getUseInterimTilesOnError();\r\n    return tileState == TileState.LOADED ||\r\n        tileState == TileState.EMPTY ||\r\n        tileState == TileState.ERROR && !useInterimTilesOnError;\r\n  }\r\n\r\n  /**\r\n   * @param {number} z Tile coordinate z.\r\n   * @param {number} x Tile coordinate x.\r\n   * @param {number} y Tile coordinate y.\r\n   * @param {number} pixelRatio Pixel ratio.\r\n   * @param {module:ol/proj/Projection} projection Projection.\r\n   * @return {!module:ol/Tile} Tile.\r\n   */\r\n  getTile(z, x, y, pixelRatio, projection) {\r\n    const layer = this.getLayer();\r\n    const source = /** @type {module:ol/source/Tile} */ (layer.getSource());\r\n    let tile = source.getTile(z, x, y, pixelRatio, projection);\r\n    if (tile.getState() == TileState.ERROR) {\r\n      if (!layer.getUseInterimTilesOnError()) {\r\n        // When useInterimTilesOnError is false, we consider the error tile as loaded.\r\n        tile.setState(TileState.LOADED);\r\n      } else if (layer.getPreload() > 0) {\r\n        // Preloaded tiles for lower resolutions might have finished loading.\r\n        this.newTiles_ = true;\r\n      }\r\n    }\r\n    if (!this.isDrawableTile_(tile)) {\r\n      tile = tile.getInterimTile();\r\n    }\r\n    return tile;\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  prepareFrame(frameState, layerState) {\r\n\r\n    const pixelRatio = frameState.pixelRatio;\r\n    const size = frameState.size;\r\n    const viewState = frameState.viewState;\r\n    const projection = viewState.projection;\r\n    const viewResolution = viewState.resolution;\r\n    const viewCenter = viewState.center;\r\n\r\n    const tileLayer = this.getLayer();\r\n    const tileSource = /** @type {module:ol/source/Tile} */ (tileLayer.getSource());\r\n    const sourceRevision = tileSource.getRevision();\r\n    const tileGrid = tileSource.getTileGridForProjection(projection);\r\n    const z = tileGrid.getZForResolution(viewResolution, this.zDirection);\r\n    const tileResolution = tileGrid.getResolution(z);\r\n    let oversampling = Math.round(viewResolution / tileResolution) || 1;\r\n    let extent = frameState.extent;\r\n\r\n    if (layerState.extent !== undefined) {\r\n      extent = getIntersection(extent, layerState.extent);\r\n    }\r\n    if (isEmpty(extent)) {\r\n      // Return false to prevent the rendering of the layer.\r\n      return false;\r\n    }\r\n\r\n    const tileRange = tileGrid.getTileRangeForExtentAndZ(extent, z);\r\n    const imageExtent = tileGrid.getTileRangeExtent(z, tileRange);\r\n\r\n    const tilePixelRatio = tileSource.getTilePixelRatio(pixelRatio);\r\n\r\n    /**\r\n     * @type {Object.<number, Object.<string, module:ol/Tile>>}\r\n     */\r\n    const tilesToDrawByZ = {};\r\n    tilesToDrawByZ[z] = {};\r\n\r\n    const findLoadedTiles = this.createLoadedTileFinder(\r\n      tileSource, projection, tilesToDrawByZ);\r\n\r\n    const hints = frameState.viewHints;\r\n    const animatingOrInteracting = hints[ViewHint.ANIMATING] || hints[ViewHint.INTERACTING];\r\n\r\n    const tmpExtent = this.tmpExtent;\r\n    const tmpTileRange = this.tmpTileRange_;\r\n    this.newTiles_ = false;\r\n    let tile, x, y;\r\n    for (x = tileRange.minX; x <= tileRange.maxX; ++x) {\r\n      for (y = tileRange.minY; y <= tileRange.maxY; ++y) {\r\n        if (Date.now() - frameState.time > 16 && animatingOrInteracting) {\r\n          continue;\r\n        }\r\n        tile = this.getTile(z, x, y, pixelRatio, projection);\r\n        if (this.isDrawableTile_(tile)) {\r\n          const uid = getUid(this);\r\n          if (tile.getState() == TileState.LOADED) {\r\n            tilesToDrawByZ[z][tile.tileCoord.toString()] = tile;\r\n            const inTransition = tile.inTransition(uid);\r\n            if (!this.newTiles_ && (inTransition || this.renderedTiles.indexOf(tile) === -1)) {\r\n              this.newTiles_ = true;\r\n            }\r\n          }\r\n          if (tile.getAlpha(uid, frameState.time) === 1) {\r\n            // don't look for alt tiles if alpha is 1\r\n            continue;\r\n          }\r\n        }\r\n\r\n        const childTileRange = tileGrid.getTileCoordChildTileRange(\r\n          tile.tileCoord, tmpTileRange, tmpExtent);\r\n        let covered = false;\r\n        if (childTileRange) {\r\n          covered = findLoadedTiles(z + 1, childTileRange);\r\n        }\r\n        if (!covered) {\r\n          tileGrid.forEachTileCoordParentTileRange(\r\n            tile.tileCoord, findLoadedTiles, null, tmpTileRange, tmpExtent);\r\n        }\r\n\r\n      }\r\n    }\r\n\r\n    const renderedResolution = tileResolution * pixelRatio / tilePixelRatio * oversampling;\r\n    if (!(this.renderedResolution && Date.now() - frameState.time > 16 && animatingOrInteracting) && (\r\n      this.newTiles_ ||\r\n          !(this.renderedExtent_ && containsExtent(this.renderedExtent_, extent)) ||\r\n          this.renderedRevision != sourceRevision ||\r\n          oversampling != this.oversampling_ ||\r\n          !animatingOrInteracting && renderedResolution != this.renderedResolution\r\n    )) {\r\n\r\n      const context = this.context;\r\n      if (context) {\r\n        const tilePixelSize = tileSource.getTilePixelSize(z, pixelRatio, projection);\r\n        const width = Math.round(tileRange.getWidth() * tilePixelSize[0] / oversampling);\r\n        const height = Math.round(tileRange.getHeight() * tilePixelSize[1] / oversampling);\r\n        const canvas = context.canvas;\r\n        if (canvas.width != width || canvas.height != height) {\r\n          this.oversampling_ = oversampling;\r\n          canvas.width = width;\r\n          canvas.height = height;\r\n        } else {\r\n          if (this.renderedExtent_ && !equals(imageExtent, this.renderedExtent_)) {\r\n            context.clearRect(0, 0, width, height);\r\n          }\r\n          oversampling = this.oversampling_;\r\n        }\r\n      }\r\n\r\n      this.renderedTiles.length = 0;\r\n      /** @type {Array.<number>} */\r\n      const zs = Object.keys(tilesToDrawByZ).map(Number);\r\n      zs.sort(function(a, b) {\r\n        if (a === z) {\r\n          return 1;\r\n        } else if (b === z) {\r\n          return -1;\r\n        } else {\r\n          return a > b ? 1 : a < b ? -1 : 0;\r\n        }\r\n      });\r\n      let currentResolution, currentScale, currentTilePixelSize, currentZ, i, ii;\r\n      let tileExtent, tileGutter, tilesToDraw, w, h;\r\n      for (i = 0, ii = zs.length; i < ii; ++i) {\r\n        currentZ = zs[i];\r\n        currentTilePixelSize = tileSource.getTilePixelSize(currentZ, pixelRatio, projection);\r\n        currentResolution = tileGrid.getResolution(currentZ);\r\n        currentScale = currentResolution / tileResolution;\r\n        tileGutter = tilePixelRatio * tileSource.getGutter(projection);\r\n        tilesToDraw = tilesToDrawByZ[currentZ];\r\n        for (const tileCoordKey in tilesToDraw) {\r\n          tile = tilesToDraw[tileCoordKey];\r\n          tileExtent = tileGrid.getTileCoordExtent(tile.getTileCoord(), tmpExtent);\r\n          x = (tileExtent[0] - imageExtent[0]) / tileResolution * tilePixelRatio / oversampling;\r\n          y = (imageExtent[3] - tileExtent[3]) / tileResolution * tilePixelRatio / oversampling;\r\n          w = currentTilePixelSize[0] * currentScale / oversampling;\r\n          h = currentTilePixelSize[1] * currentScale / oversampling;\r\n          this.drawTileImage(tile, frameState, layerState, x, y, w, h, tileGutter, z === currentZ);\r\n          this.renderedTiles.push(tile);\r\n        }\r\n      }\r\n\r\n      this.renderedRevision = sourceRevision;\r\n      this.renderedResolution = tileResolution * pixelRatio / tilePixelRatio * oversampling;\r\n      this.renderedExtent_ = imageExtent;\r\n    }\r\n\r\n    const scale = this.renderedResolution / viewResolution;\r\n    const transform = composeTransform(this.imageTransform_,\r\n      pixelRatio * size[0] / 2, pixelRatio * size[1] / 2,\r\n      scale, scale,\r\n      0,\r\n      (this.renderedExtent_[0] - viewCenter[0]) / this.renderedResolution * pixelRatio,\r\n      (viewCenter[1] - this.renderedExtent_[3]) / this.renderedResolution * pixelRatio);\r\n    composeTransform(this.coordinateToCanvasPixelTransform,\r\n      pixelRatio * size[0] / 2 - transform[4], pixelRatio * size[1] / 2 - transform[5],\r\n      pixelRatio / viewResolution, -pixelRatio / viewResolution,\r\n      0,\r\n      -viewCenter[0], -viewCenter[1]);\r\n\r\n\r\n    this.updateUsedTiles(frameState.usedTiles, tileSource, z, tileRange);\r\n    this.manageTilePyramid(frameState, tileSource, tileGrid, pixelRatio,\r\n      projection, extent, z, tileLayer.getPreload());\r\n    this.scheduleExpireCache(frameState, tileSource);\r\n\r\n    return this.renderedTiles.length > 0;\r\n  }\r\n\r\n  /**\r\n   * @param {module:ol/Tile} tile Tile.\r\n   * @param {module:ol/PluggableMap~FrameState} frameState Frame state.\r\n   * @param {module:ol/layer/Layer~State} layerState Layer state.\r\n   * @param {number} x Left of the tile.\r\n   * @param {number} y Top of the tile.\r\n   * @param {number} w Width of the tile.\r\n   * @param {number} h Height of the tile.\r\n   * @param {number} gutter Tile gutter.\r\n   * @param {boolean} transition Apply an alpha transition.\r\n   */\r\n  drawTileImage(tile, frameState, layerState, x, y, w, h, gutter, transition) {\r\n    const image = tile.getImage(this.getLayer());\r\n    if (!image) {\r\n      return;\r\n    }\r\n    const uid = getUid(this);\r\n    const alpha = transition ? tile.getAlpha(uid, frameState.time) : 1;\r\n    if (alpha === 1 && !this.getLayer().getSource().getOpaque(frameState.viewState.projection)) {\r\n      this.context.clearRect(x, y, w, h);\r\n    }\r\n    const alphaChanged = alpha !== this.context.globalAlpha;\r\n    if (alphaChanged) {\r\n      this.context.save();\r\n      this.context.globalAlpha = alpha;\r\n    }\r\n    this.context.drawImage(image, gutter, gutter,\r\n      image.width - 2 * gutter, image.height - 2 * gutter, x, y, w, h);\r\n\r\n    if (alphaChanged) {\r\n      this.context.restore();\r\n    }\r\n    if (alpha !== 1) {\r\n      frameState.animate = true;\r\n    } else if (transition) {\r\n      tile.endTransition(uid);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  getImage() {\r\n    const context = this.context;\r\n    return context ? context.canvas : null;\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  getImageTransform() {\r\n    return this.imageTransform_;\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * Determine if this renderer handles the provided layer.\r\n * @param {module:ol/layer/Layer} layer The candidate layer.\r\n * @return {boolean} The renderer can render the layer.\r\n */\r\nCanvasTileLayerRenderer['handles'] = function(layer) {\r\n  return layer.getType() === LayerType.TILE;\r\n};\r\n\r\n\r\n/**\r\n * Create a layer renderer.\r\n * @param {module:ol/renderer/Map} mapRenderer The map renderer.\r\n * @param {module:ol/layer/Layer} layer The layer to be rendererd.\r\n * @return {module:ol/renderer/canvas/TileLayer} The layer renderer.\r\n */\r\nCanvasTileLayerRenderer['create'] = function(mapRenderer, layer) {\r\n  return new CanvasTileLayerRenderer(/** @type {module:ol/layer/Tile} */ (layer));\r\n};\r\n\r\n\r\n/**\r\n * @function\r\n * @return {module:ol/layer/Tile|module:ol/layer/VectorTile}\r\n */\r\nCanvasTileLayerRenderer.prototype.getLayer;\r\n\r\n\r\nexport default CanvasTileLayerRenderer;\r\n"],"names":["super","const","let","this"],"mappings":"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"}