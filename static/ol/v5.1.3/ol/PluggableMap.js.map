{"version":3,"file":"PluggableMap.js","sources":["../../src/ol/PluggableMap.js"],"sourcesContent":["/**\r\n * @module ol/PluggableMap\r\n */\r\nimport {getUid} from './util.js';\r\nimport Collection from './Collection.js';\r\nimport CollectionEventType from './CollectionEventType.js';\r\nimport MapBrowserEvent from './MapBrowserEvent.js';\r\nimport MapBrowserEventHandler from './MapBrowserEventHandler.js';\r\nimport MapBrowserEventType from './MapBrowserEventType.js';\r\nimport MapEvent from './MapEvent.js';\r\nimport MapEventType from './MapEventType.js';\r\nimport MapProperty from './MapProperty.js';\r\nimport BaseObject, {getChangeEventType} from './Object.js';\r\nimport ObjectEventType from './ObjectEventType.js';\r\nimport TileQueue from './TileQueue.js';\r\nimport View from './View.js';\r\nimport ViewHint from './ViewHint.js';\r\nimport {assert} from './asserts.js';\r\nimport {removeNode} from './dom.js';\r\nimport {listen, unlistenByKey, unlisten} from './events.js';\r\nimport {stopPropagation} from './events/Event.js';\r\nimport EventType from './events/EventType.js';\r\nimport {createEmpty, clone, createOrUpdateEmpty, equals, getForViewAndSize, isEmpty} from './extent.js';\r\nimport {TRUE} from './functions.js';\r\nimport {DEVICE_PIXEL_RATIO, TOUCH} from './has.js';\r\nimport LayerGroup from './layer/Group.js';\r\nimport {hasArea} from './size.js';\r\nimport {DROP} from './structs/PriorityQueue.js';\r\nimport {create as createTransform, apply as applyTransform} from './transform.js';\r\n\r\n\r\n/**\r\n * State of the current frame. Only `pixelRatio`, `time` and `viewState` should\r\n * be used in applications.\r\n * @typedef {Object} FrameState\r\n * @property {number} pixelRatio The pixel ratio of the frame.\r\n * @property {number} time The time when rendering of the frame was requested.\r\n * @property {module:ol/View~State} viewState The state of the current view.\r\n * @property {boolean} animate\r\n * @property {module:ol/transform~Transform} coordinateToPixelTransform\r\n * @property {null|module:ol/extent~Extent} extent\r\n * @property {module:ol/coordinate~Coordinate} focus\r\n * @property {number} index\r\n * @property {Object.<number, module:ol/layer/Layer~State>} layerStates\r\n * @property {Array.<module:ol/layer/Layer~State>} layerStatesArray\r\n * @property {module:ol/transform~Transform} pixelToCoordinateTransform\r\n * @property {Array.<module:ol/PluggableMap~PostRenderFunction>} postRenderFunctions\r\n * @property {module:ol/size~Size} size\r\n * @property {!Object.<string, boolean>} skippedFeatureUids\r\n * @property {module:ol/TileQueue} tileQueue\r\n * @property {Object.<string, Object.<string, module:ol/TileRange>>} usedTiles\r\n * @property {Array.<number>} viewHints\r\n * @property {!Object.<string, Object.<string, boolean>>} wantedTiles\r\n */\r\n\r\n\r\n/**\r\n * @typedef {function(module:ol/PluggableMap, ?module:ol/PluggableMap~FrameState): boolean} PostRenderFunction\r\n */\r\n\r\n\r\n/**\r\n * @typedef {Object} AtPixelOptions\r\n * @property {((function(module:ol/layer/Layer): boolean)|undefined)} layerFilter Layer filter\r\n * function. The filter function will receive one argument, the\r\n * {@link module:ol/layer/Layer layer-candidate} and it should return a boolean value.\r\n * Only layers which are visible and for which this function returns `true`\r\n * will be tested for features. By default, all visible layers will be tested.\r\n * @property {number} [hitTolerance=0] Hit-detection tolerance in pixels. Pixels\r\n * inside the radius around the given position will be checked for features. This only\r\n * works for the canvas renderer and not for WebGL.\r\n */\r\n\r\n\r\n/**\r\n * @typedef {Object} MapOptionsInternal\r\n * @property {module:ol/Collection.<module:ol/control/Control>} [controls]\r\n * @property {module:ol/Collection.<module:ol/interaction/Interaction>} [interactions]\r\n * @property {HTMLElement|Document} keyboardEventTarget\r\n * @property {module:ol/Collection.<module:ol/Overlay>} overlays\r\n * @property {Object.<string, *>} values\r\n */\r\n\r\n\r\n/**\r\n * Object literal with config options for the map.\r\n * @typedef {Object} MapOptions\r\n * @property {module:ol/Collection.<module:ol/control/Control>|Array.<module:ol/control/Control>} [controls]\r\n * Controls initially added to the map. If not specified,\r\n * {@link module:ol/control/util~defaults} is used.\r\n * @property {number} [pixelRatio=window.devicePixelRatio] The ratio between\r\n * physical pixels and device-independent pixels (dips) on the device.\r\n * @property {module:ol/Collection.<module:ol/interaction/Interaction>|Array.<module:ol/interaction/Interaction>} [interactions]\r\n * Interactions that are initially added to the map. If not specified,\r\n * {@link module:ol/interaction~defaults} is used.\r\n * @property {HTMLElement|Document|string} [keyboardEventTarget] The element to\r\n * listen to keyboard events on. This determines when the `KeyboardPan` and\r\n * `KeyboardZoom` interactions trigger. For example, if this option is set to\r\n * `document` the keyboard interactions will always trigger. If this option is\r\n * not specified, the element the library listens to keyboard events on is the\r\n * map target (i.e. the user-provided div for the map). If this is not\r\n * `document`, the target element needs to be focused for key events to be\r\n * emitted, requiring that the target element has a `tabindex` attribute.\r\n * @property {Array.<module:ol/layer/Base>|module:ol/Collection.<module:ol/layer/Base>} [layers]\r\n * Layers. If this is not defined, a map with no layers will be rendered. Note\r\n * that layers are rendered in the order supplied, so if you want, for example,\r\n * a vector layer to appear on top of a tile layer, it must come after the tile\r\n * layer.\r\n * @property {number} [maxTilesLoading=16] Maximum number tiles to load\r\n * simultaneously.\r\n * @property {boolean} [loadTilesWhileAnimating=false] When set to `true`, tiles\r\n * will be loaded during animations. This may improve the user experience, but\r\n * can also make animations stutter on devices with slow memory.\r\n * @property {boolean} [loadTilesWhileInteracting=false] When set to `true`,\r\n * tiles will be loaded while interacting with the map. This may improve the\r\n * user experience, but can also make map panning and zooming choppy on devices\r\n * with slow memory.\r\n * @property {number} [moveTolerance=1] The minimum distance in pixels the\r\n * cursor must move to be detected as a map move event instead of a click.\r\n * Increasing this value can make it easier to click on the map.\r\n * @property {module:ol/Collection.<module:ol/Overlay>|Array.<module:ol/Overlay>} [overlays]\r\n * Overlays initially added to the map. By default, no overlays are added.\r\n * @property {HTMLElement|string} [target] The container for the map, either the\r\n * element itself or the `id` of the element. If not specified at construction\r\n * time, {@link module:ol/Map~Map#setTarget} must be called for the map to be\r\n * rendered.\r\n * @property {module:ol/View} [view] The map's view.  No layer sources will be\r\n * fetched unless this is specified at construction time or through\r\n * {@link module:ol/Map~Map#setView}.\r\n */\r\n\r\n\r\n/**\r\n * @fires module:ol/MapBrowserEvent~MapBrowserEvent\r\n * @fires module:ol/MapEvent~MapEvent\r\n * @fires module:ol/render/Event~RenderEvent#postcompose\r\n * @fires module:ol/render/Event~RenderEvent#precompose\r\n * @api\r\n */\r\nclass PluggableMap extends BaseObject {\r\n\r\n  /**\r\n   * @param {module:ol/PluggableMap~MapOptions} options Map options.\r\n   */\r\n  constructor(options) {\r\n\r\n    super();\r\n\r\n    const optionsInternal = createOptionsInternal(options);\r\n\r\n    /**\r\n     * @type {number}\r\n     * @private\r\n     */\r\n    this.maxTilesLoading_ = options.maxTilesLoading !== undefined ? options.maxTilesLoading : 16;\r\n\r\n    /**\r\n     * @type {boolean}\r\n     * @private\r\n     */\r\n    this.loadTilesWhileAnimating_ =\r\n        options.loadTilesWhileAnimating !== undefined ?\r\n          options.loadTilesWhileAnimating : false;\r\n\r\n    /**\r\n     * @type {boolean}\r\n     * @private\r\n     */\r\n    this.loadTilesWhileInteracting_ =\r\n        options.loadTilesWhileInteracting !== undefined ?\r\n          options.loadTilesWhileInteracting : false;\r\n\r\n    /**\r\n     * @private\r\n     * @type {number}\r\n     */\r\n    this.pixelRatio_ = options.pixelRatio !== undefined ?\r\n      options.pixelRatio : DEVICE_PIXEL_RATIO;\r\n\r\n    /**\r\n     * @private\r\n     * @type {number|undefined}\r\n     */\r\n    this.animationDelayKey_;\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    this.animationDelay_ = function() {\r\n      this.animationDelayKey_ = undefined;\r\n      this.renderFrame_.call(this, Date.now());\r\n    }.bind(this);\r\n\r\n    /**\r\n     * @private\r\n     * @type {module:ol/transform~Transform}\r\n     */\r\n    this.coordinateToPixelTransform_ = createTransform();\r\n\r\n    /**\r\n     * @private\r\n     * @type {module:ol/transform~Transform}\r\n     */\r\n    this.pixelToCoordinateTransform_ = createTransform();\r\n\r\n    /**\r\n     * @private\r\n     * @type {number}\r\n     */\r\n    this.frameIndex_ = 0;\r\n\r\n    /**\r\n     * @private\r\n     * @type {?module:ol/PluggableMap~FrameState}\r\n     */\r\n    this.frameState_ = null;\r\n\r\n    /**\r\n     * The extent at the previous 'moveend' event.\r\n     * @private\r\n     * @type {module:ol/extent~Extent}\r\n     */\r\n    this.previousExtent_ = null;\r\n\r\n    /**\r\n     * @private\r\n     * @type {?module:ol/events~EventsKey}\r\n     */\r\n    this.viewPropertyListenerKey_ = null;\r\n\r\n    /**\r\n     * @private\r\n     * @type {?module:ol/events~EventsKey}\r\n     */\r\n    this.viewChangeListenerKey_ = null;\r\n\r\n    /**\r\n     * @private\r\n     * @type {Array.<module:ol/events~EventsKey>}\r\n     */\r\n    this.layerGroupPropertyListenerKeys_ = null;\r\n\r\n    /**\r\n     * @private\r\n     * @type {!HTMLElement}\r\n     */\r\n    this.viewport_ = document.createElement('DIV');\r\n    this.viewport_.className = 'ol-viewport' + (TOUCH ? ' ol-touch' : '');\r\n    this.viewport_.style.position = 'relative';\r\n    this.viewport_.style.overflow = 'hidden';\r\n    this.viewport_.style.width = '100%';\r\n    this.viewport_.style.height = '100%';\r\n    // prevent page zoom on IE >= 10 browsers\r\n    this.viewport_.style.msTouchAction = 'none';\r\n    this.viewport_.style.touchAction = 'none';\r\n\r\n    /**\r\n     * @private\r\n     * @type {!HTMLElement}\r\n     */\r\n    this.overlayContainer_ = document.createElement('DIV');\r\n    this.overlayContainer_.className = 'ol-overlaycontainer';\r\n    this.viewport_.appendChild(this.overlayContainer_);\r\n\r\n    /**\r\n     * @private\r\n     * @type {!HTMLElement}\r\n     */\r\n    this.overlayContainerStopEvent_ = document.createElement('DIV');\r\n    this.overlayContainerStopEvent_.className = 'ol-overlaycontainer-stopevent';\r\n    const overlayEvents = [\r\n      EventType.CLICK,\r\n      EventType.DBLCLICK,\r\n      EventType.MOUSEDOWN,\r\n      EventType.TOUCHSTART,\r\n      EventType.MSPOINTERDOWN,\r\n      MapBrowserEventType.POINTERDOWN,\r\n      EventType.MOUSEWHEEL,\r\n      EventType.WHEEL\r\n    ];\r\n    for (let i = 0, ii = overlayEvents.length; i < ii; ++i) {\r\n      listen(this.overlayContainerStopEvent_, overlayEvents[i], stopPropagation);\r\n    }\r\n    this.viewport_.appendChild(this.overlayContainerStopEvent_);\r\n\r\n    /**\r\n     * @private\r\n     * @type {module:ol/MapBrowserEventHandler}\r\n     */\r\n    this.mapBrowserEventHandler_ = new MapBrowserEventHandler(this, options.moveTolerance);\r\n    for (const key in MapBrowserEventType) {\r\n      listen(this.mapBrowserEventHandler_, MapBrowserEventType[key],\r\n        this.handleMapBrowserEvent, this);\r\n    }\r\n\r\n    /**\r\n     * @private\r\n     * @type {HTMLElement|Document}\r\n     */\r\n    this.keyboardEventTarget_ = optionsInternal.keyboardEventTarget;\r\n\r\n    /**\r\n     * @private\r\n     * @type {Array.<module:ol/events~EventsKey>}\r\n     */\r\n    this.keyHandlerKeys_ = null;\r\n\r\n    listen(this.viewport_, EventType.CONTEXTMENU, this.handleBrowserEvent, this);\r\n    listen(this.viewport_, EventType.WHEEL, this.handleBrowserEvent, this);\r\n    listen(this.viewport_, EventType.MOUSEWHEEL, this.handleBrowserEvent, this);\r\n\r\n    /**\r\n     * @type {module:ol/Collection.<module:ol/control/Control>}\r\n     * @protected\r\n     */\r\n    this.controls = optionsInternal.controls || new Collection();\r\n\r\n    /**\r\n     * @type {module:ol/Collection.<module:ol/interaction/Interaction>}\r\n     * @protected\r\n     */\r\n    this.interactions = optionsInternal.interactions || new Collection();\r\n\r\n    /**\r\n     * @type {module:ol/Collection.<module:ol/Overlay>}\r\n     * @private\r\n     */\r\n    this.overlays_ = optionsInternal.overlays;\r\n\r\n    /**\r\n     * A lookup of overlays by id.\r\n     * @private\r\n     * @type {Object.<string, module:ol/Overlay>}\r\n     */\r\n    this.overlayIdIndex_ = {};\r\n\r\n    /**\r\n     * @type {module:ol/renderer/Map}\r\n     * @private\r\n     */\r\n    this.renderer_ = this.createRenderer();\r\n\r\n    /**\r\n     * @type {function(Event)|undefined}\r\n     * @private\r\n     */\r\n    this.handleResize_;\r\n\r\n    /**\r\n     * @private\r\n     * @type {module:ol/coordinate~Coordinate}\r\n     */\r\n    this.focus_ = null;\r\n\r\n    /**\r\n     * @private\r\n     * @type {!Array.<module:ol/PluggableMap~PostRenderFunction>}\r\n     */\r\n    this.postRenderFunctions_ = [];\r\n\r\n    /**\r\n     * @private\r\n     * @type {module:ol/TileQueue}\r\n     */\r\n    this.tileQueue_ = new TileQueue(\r\n      this.getTilePriority.bind(this),\r\n      this.handleTileChange_.bind(this));\r\n\r\n    /**\r\n     * Uids of features to skip at rendering time.\r\n     * @type {Object.<string, boolean>}\r\n     * @private\r\n     */\r\n    this.skippedFeatureUids_ = {};\r\n\r\n    listen(\r\n      this, getChangeEventType(MapProperty.LAYERGROUP),\r\n      this.handleLayerGroupChanged_, this);\r\n    listen(this, getChangeEventType(MapProperty.VIEW),\r\n      this.handleViewChanged_, this);\r\n    listen(this, getChangeEventType(MapProperty.SIZE),\r\n      this.handleSizeChanged_, this);\r\n    listen(this, getChangeEventType(MapProperty.TARGET),\r\n      this.handleTargetChanged_, this);\r\n\r\n    // setProperties will trigger the rendering of the map if the map\r\n    // is \"defined\" already.\r\n    this.setProperties(optionsInternal.values);\r\n\r\n    this.controls.forEach(\r\n      /**\r\n       * @param {module:ol/control/Control} control Control.\r\n       * @this {module:ol/PluggableMap}\r\n       */\r\n      (function(control) {\r\n        control.setMap(this);\r\n      }).bind(this));\r\n\r\n    listen(this.controls, CollectionEventType.ADD,\r\n      /**\r\n       * @param {module:ol/Collection~CollectionEvent} event CollectionEvent.\r\n       */\r\n      function(event) {\r\n        event.element.setMap(this);\r\n      }, this);\r\n\r\n    listen(this.controls, CollectionEventType.REMOVE,\r\n      /**\r\n       * @param {module:ol/Collection~CollectionEvent} event CollectionEvent.\r\n       */\r\n      function(event) {\r\n        event.element.setMap(null);\r\n      }, this);\r\n\r\n    this.interactions.forEach(\r\n      /**\r\n       * @param {module:ol/interaction/Interaction} interaction Interaction.\r\n       * @this {module:ol/PluggableMap}\r\n       */\r\n      (function(interaction) {\r\n        interaction.setMap(this);\r\n      }).bind(this));\r\n\r\n    listen(this.interactions, CollectionEventType.ADD,\r\n      /**\r\n       * @param {module:ol/Collection~CollectionEvent} event CollectionEvent.\r\n       */\r\n      function(event) {\r\n        event.element.setMap(this);\r\n      }, this);\r\n\r\n    listen(this.interactions, CollectionEventType.REMOVE,\r\n      /**\r\n       * @param {module:ol/Collection~CollectionEvent} event CollectionEvent.\r\n       */\r\n      function(event) {\r\n        event.element.setMap(null);\r\n      }, this);\r\n\r\n    this.overlays_.forEach(this.addOverlayInternal_.bind(this));\r\n\r\n    listen(this.overlays_, CollectionEventType.ADD,\r\n      /**\r\n       * @param {module:ol/Collection~CollectionEvent} event CollectionEvent.\r\n       */\r\n      function(event) {\r\n        this.addOverlayInternal_(/** @type {module:ol/Overlay} */ (event.element));\r\n      }, this);\r\n\r\n    listen(this.overlays_, CollectionEventType.REMOVE,\r\n      /**\r\n       * @param {module:ol/Collection~CollectionEvent} event CollectionEvent.\r\n       */\r\n      function(event) {\r\n        const overlay = /** @type {module:ol/Overlay} */ (event.element);\r\n        const id = overlay.getId();\r\n        if (id !== undefined) {\r\n          delete this.overlayIdIndex_[id.toString()];\r\n        }\r\n        event.element.setMap(null);\r\n      }, this);\r\n\r\n  }\r\n\r\n  createRenderer() {\r\n    throw new Error('Use a map type that has a createRenderer method');\r\n  }\r\n\r\n  /**\r\n   * Add the given control to the map.\r\n   * @param {module:ol/control/Control} control Control.\r\n   * @api\r\n   */\r\n  addControl(control) {\r\n    this.getControls().push(control);\r\n  }\r\n\r\n  /**\r\n   * Add the given interaction to the map.\r\n   * @param {module:ol/interaction/Interaction} interaction Interaction to add.\r\n   * @api\r\n   */\r\n  addInteraction(interaction) {\r\n    this.getInteractions().push(interaction);\r\n  }\r\n\r\n  /**\r\n   * Adds the given layer to the top of this map. If you want to add a layer\r\n   * elsewhere in the stack, use `getLayers()` and the methods available on\r\n   * {@link module:ol/Collection~Collection}.\r\n   * @param {module:ol/layer/Base} layer Layer.\r\n   * @api\r\n   */\r\n  addLayer(layer) {\r\n    const layers = this.getLayerGroup().getLayers();\r\n    layers.push(layer);\r\n  }\r\n\r\n  /**\r\n   * Add the given overlay to the map.\r\n   * @param {module:ol/Overlay} overlay Overlay.\r\n   * @api\r\n   */\r\n  addOverlay(overlay) {\r\n    this.getOverlays().push(overlay);\r\n  }\r\n\r\n  /**\r\n   * This deals with map's overlay collection changes.\r\n   * @param {module:ol/Overlay} overlay Overlay.\r\n   * @private\r\n   */\r\n  addOverlayInternal_(overlay) {\r\n    const id = overlay.getId();\r\n    if (id !== undefined) {\r\n      this.overlayIdIndex_[id.toString()] = overlay;\r\n    }\r\n    overlay.setMap(this);\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @inheritDoc\r\n   */\r\n  disposeInternal() {\r\n    this.mapBrowserEventHandler_.dispose();\r\n    unlisten(this.viewport_, EventType.CONTEXTMENU, this.handleBrowserEvent, this);\r\n    unlisten(this.viewport_, EventType.WHEEL, this.handleBrowserEvent, this);\r\n    unlisten(this.viewport_, EventType.MOUSEWHEEL, this.handleBrowserEvent, this);\r\n    if (this.handleResize_ !== undefined) {\r\n      removeEventListener(EventType.RESIZE, this.handleResize_, false);\r\n      this.handleResize_ = undefined;\r\n    }\r\n    if (this.animationDelayKey_) {\r\n      cancelAnimationFrame(this.animationDelayKey_);\r\n      this.animationDelayKey_ = undefined;\r\n    }\r\n    this.setTarget(null);\r\n    super.disposeInternal();\r\n  }\r\n\r\n  /**\r\n   * Detect features that intersect a pixel on the viewport, and execute a\r\n   * callback with each intersecting feature. Layers included in the detection can\r\n   * be configured through the `layerFilter` option in `opt_options`.\r\n   * @param {module:ol/pixel~Pixel} pixel Pixel.\r\n   * @param {function(this: S, (module:ol/Feature|module:ol/render/Feature),\r\n   *     module:ol/layer/Layer): T} callback Feature callback. The callback will be\r\n   *     called with two arguments. The first argument is one\r\n   *     {@link module:ol/Feature feature} or\r\n   *     {@link module:ol/render/Feature render feature} at the pixel, the second is\r\n   *     the {@link module:ol/layer/Layer layer} of the feature and will be null for\r\n   *     unmanaged layers. To stop detection, callback functions can return a\r\n   *     truthy value.\r\n   * @param {module:ol/PluggableMap~AtPixelOptions=} opt_options Optional options.\r\n   * @return {T|undefined} Callback result, i.e. the return value of last\r\n   * callback execution, or the first truthy callback return value.\r\n   * @template S,T\r\n   * @api\r\n   */\r\n  forEachFeatureAtPixel(pixel, callback, opt_options) {\r\n    if (!this.frameState_) {\r\n      return;\r\n    }\r\n    const coordinate = this.getCoordinateFromPixel(pixel);\r\n    opt_options = opt_options !== undefined ? opt_options : {};\r\n    const hitTolerance = opt_options.hitTolerance !== undefined ?\r\n      opt_options.hitTolerance * this.frameState_.pixelRatio : 0;\r\n    const layerFilter = opt_options.layerFilter !== undefined ?\r\n      opt_options.layerFilter : TRUE;\r\n    return this.renderer_.forEachFeatureAtCoordinate(\r\n      coordinate, this.frameState_, hitTolerance, callback, null,\r\n      layerFilter, null);\r\n  }\r\n\r\n  /**\r\n   * Get all features that intersect a pixel on the viewport.\r\n   * @param {module:ol/pixel~Pixel} pixel Pixel.\r\n   * @param {module:ol/PluggableMap~AtPixelOptions=} opt_options Optional options.\r\n   * @return {Array.<module:ol/Feature|module:ol/render/Feature>} The detected features or\r\n   * `null` if none were found.\r\n   * @api\r\n   */\r\n  getFeaturesAtPixel(pixel, opt_options) {\r\n    let features = null;\r\n    this.forEachFeatureAtPixel(pixel, function(feature) {\r\n      if (!features) {\r\n        features = [];\r\n      }\r\n      features.push(feature);\r\n    }, opt_options);\r\n    return features;\r\n  }\r\n\r\n  /**\r\n   * Detect layers that have a color value at a pixel on the viewport, and\r\n   * execute a callback with each matching layer. Layers included in the\r\n   * detection can be configured through `opt_layerFilter`.\r\n   * @param {module:ol/pixel~Pixel} pixel Pixel.\r\n   * @param {function(this: S, module:ol/layer/Layer, (Uint8ClampedArray|Uint8Array)): T} callback\r\n   *     Layer callback. This callback will receive two arguments: first is the\r\n   *     {@link module:ol/layer/Layer layer}, second argument is an array representing\r\n   *     [R, G, B, A] pixel values (0 - 255) and will be `null` for layer types\r\n   *     that do not currently support this argument. To stop detection, callback\r\n   *     functions can return a truthy value.\r\n   * @param {module:ol/PluggableMap~AtPixelOptions=} opt_options Configuration options.\r\n   * @return {T|undefined} Callback result, i.e. the return value of last\r\n   * callback execution, or the first truthy callback return value.\r\n   * @template S,T\r\n   * @api\r\n   */\r\n  forEachLayerAtPixel(pixel, callback, opt_options) {\r\n    if (!this.frameState_) {\r\n      return;\r\n    }\r\n    const options = opt_options || {};\r\n    const hitTolerance = options.hitTolerance !== undefined ?\r\n      opt_options.hitTolerance * this.frameState_.pixelRatio : 0;\r\n    const layerFilter = options.layerFilter || TRUE;\r\n    return this.renderer_.forEachLayerAtPixel(\r\n      pixel, this.frameState_, hitTolerance, callback, null, layerFilter, null);\r\n  }\r\n\r\n  /**\r\n   * Detect if features intersect a pixel on the viewport. Layers included in the\r\n   * detection can be configured through `opt_layerFilter`.\r\n   * @param {module:ol/pixel~Pixel} pixel Pixel.\r\n   * @param {module:ol/PluggableMap~AtPixelOptions=} opt_options Optional options.\r\n   * @return {boolean} Is there a feature at the given pixel?\r\n   * @template U\r\n   * @api\r\n   */\r\n  hasFeatureAtPixel(pixel, opt_options) {\r\n    if (!this.frameState_) {\r\n      return false;\r\n    }\r\n    const coordinate = this.getCoordinateFromPixel(pixel);\r\n    opt_options = opt_options !== undefined ? opt_options : {};\r\n    const layerFilter = opt_options.layerFilter !== undefined ? opt_options.layerFilter : TRUE;\r\n    const hitTolerance = opt_options.hitTolerance !== undefined ?\r\n      opt_options.hitTolerance * this.frameState_.pixelRatio : 0;\r\n    return this.renderer_.hasFeatureAtCoordinate(\r\n      coordinate, this.frameState_, hitTolerance, layerFilter, null);\r\n  }\r\n\r\n  /**\r\n   * Returns the coordinate in view projection for a browser event.\r\n   * @param {Event} event Event.\r\n   * @return {module:ol/coordinate~Coordinate} Coordinate.\r\n   * @api\r\n   */\r\n  getEventCoordinate(event) {\r\n    return this.getCoordinateFromPixel(this.getEventPixel(event));\r\n  }\r\n\r\n  /**\r\n   * Returns the map pixel position for a browser event relative to the viewport.\r\n   * @param {Event} event Event.\r\n   * @return {module:ol/pixel~Pixel} Pixel.\r\n   * @api\r\n   */\r\n  getEventPixel(event) {\r\n    const viewportPosition = this.viewport_.getBoundingClientRect();\r\n    const eventPosition = event.changedTouches ? event.changedTouches[0] : event;\r\n    return [\r\n      eventPosition.clientX - viewportPosition.left,\r\n      eventPosition.clientY - viewportPosition.top\r\n    ];\r\n  }\r\n\r\n  /**\r\n   * Get the target in which this map is rendered.\r\n   * Note that this returns what is entered as an option or in setTarget:\r\n   * if that was an element, it returns an element; if a string, it returns that.\r\n   * @return {HTMLElement|string|undefined} The Element or id of the Element that the\r\n   *     map is rendered in.\r\n   * @observable\r\n   * @api\r\n   */\r\n  getTarget() {\r\n    return /** @type {HTMLElement|string|undefined} */ (this.get(MapProperty.TARGET));\r\n  }\r\n\r\n  /**\r\n   * Get the DOM element into which this map is rendered. In contrast to\r\n   * `getTarget` this method always return an `Element`, or `null` if the\r\n   * map has no target.\r\n   * @return {HTMLElement} The element that the map is rendered in.\r\n   * @api\r\n   */\r\n  getTargetElement() {\r\n    const target = this.getTarget();\r\n    if (target !== undefined) {\r\n      return typeof target === 'string' ? document.getElementById(target) : target;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the coordinate for a given pixel.  This returns a coordinate in the\r\n   * map view projection.\r\n   * @param {module:ol/pixel~Pixel} pixel Pixel position in the map viewport.\r\n   * @return {module:ol/coordinate~Coordinate} The coordinate for the pixel position.\r\n   * @api\r\n   */\r\n  getCoordinateFromPixel(pixel) {\r\n    const frameState = this.frameState_;\r\n    if (!frameState) {\r\n      return null;\r\n    } else {\r\n      return applyTransform(frameState.pixelToCoordinateTransform, pixel.slice());\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the map controls. Modifying this collection changes the controls\r\n   * associated with the map.\r\n   * @return {module:ol/Collection.<module:ol/control/Control>} Controls.\r\n   * @api\r\n   */\r\n  getControls() {\r\n    return this.controls;\r\n  }\r\n\r\n  /**\r\n   * Get the map overlays. Modifying this collection changes the overlays\r\n   * associated with the map.\r\n   * @return {module:ol/Collection.<module:ol/Overlay>} Overlays.\r\n   * @api\r\n   */\r\n  getOverlays() {\r\n    return this.overlays_;\r\n  }\r\n\r\n  /**\r\n   * Get an overlay by its identifier (the value returned by overlay.getId()).\r\n   * Note that the index treats string and numeric identifiers as the same. So\r\n   * `map.getOverlayById(2)` will return an overlay with id `'2'` or `2`.\r\n   * @param {string|number} id Overlay identifier.\r\n   * @return {module:ol/Overlay} Overlay.\r\n   * @api\r\n   */\r\n  getOverlayById(id) {\r\n    const overlay = this.overlayIdIndex_[id.toString()];\r\n    return overlay !== undefined ? overlay : null;\r\n  }\r\n\r\n  /**\r\n   * Get the map interactions. Modifying this collection changes the interactions\r\n   * associated with the map.\r\n   *\r\n   * Interactions are used for e.g. pan, zoom and rotate.\r\n   * @return {module:ol/Collection.<module:ol/interaction/Interaction>} Interactions.\r\n   * @api\r\n   */\r\n  getInteractions() {\r\n    return this.interactions;\r\n  }\r\n\r\n  /**\r\n   * Get the layergroup associated with this map.\r\n   * @return {module:ol/layer/Group} A layer group containing the layers in this map.\r\n   * @observable\r\n   * @api\r\n   */\r\n  getLayerGroup() {\r\n    return (\r\n      /** @type {module:ol/layer/Group} */ (this.get(MapProperty.LAYERGROUP))\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the collection of layers associated with this map.\r\n   * @return {!module:ol/Collection.<module:ol/layer/Base>} Layers.\r\n   * @api\r\n   */\r\n  getLayers() {\r\n    const layers = this.getLayerGroup().getLayers();\r\n    return layers;\r\n  }\r\n\r\n  /**\r\n   * Get the pixel for a coordinate.  This takes a coordinate in the map view\r\n   * projection and returns the corresponding pixel.\r\n   * @param {module:ol/coordinate~Coordinate} coordinate A map coordinate.\r\n   * @return {module:ol/pixel~Pixel} A pixel position in the map viewport.\r\n   * @api\r\n   */\r\n  getPixelFromCoordinate(coordinate) {\r\n    const frameState = this.frameState_;\r\n    if (!frameState) {\r\n      return null;\r\n    } else {\r\n      return applyTransform(frameState.coordinateToPixelTransform, coordinate.slice(0, 2));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the map renderer.\r\n   * @return {module:ol/renderer/Map} Renderer\r\n   */\r\n  getRenderer() {\r\n    return this.renderer_;\r\n  }\r\n\r\n  /**\r\n   * Get the size of this map.\r\n   * @return {module:ol/size~Size|undefined} The size in pixels of the map in the DOM.\r\n   * @observable\r\n   * @api\r\n   */\r\n  getSize() {\r\n    return (\r\n      /** @type {module:ol/size~Size|undefined} */ (this.get(MapProperty.SIZE))\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the view associated with this map. A view manages properties such as\r\n   * center and resolution.\r\n   * @return {module:ol/View} The view that controls this map.\r\n   * @observable\r\n   * @api\r\n   */\r\n  getView() {\r\n    return (\r\n      /** @type {module:ol/View} */ (this.get(MapProperty.VIEW))\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get the element that serves as the map viewport.\r\n   * @return {HTMLElement} Viewport.\r\n   * @api\r\n   */\r\n  getViewport() {\r\n    return this.viewport_;\r\n  }\r\n\r\n  /**\r\n   * Get the element that serves as the container for overlays.  Elements added to\r\n   * this container will let mousedown and touchstart events through to the map,\r\n   * so clicks and gestures on an overlay will trigger {@link module:ol/MapBrowserEvent~MapBrowserEvent}\r\n   * events.\r\n   * @return {!HTMLElement} The map's overlay container.\r\n   */\r\n  getOverlayContainer() {\r\n    return this.overlayContainer_;\r\n  }\r\n\r\n  /**\r\n   * Get the element that serves as a container for overlays that don't allow\r\n   * event propagation. Elements added to this container won't let mousedown and\r\n   * touchstart events through to the map, so clicks and gestures on an overlay\r\n   * don't trigger any {@link module:ol/MapBrowserEvent~MapBrowserEvent}.\r\n   * @return {!HTMLElement} The map's overlay container that stops events.\r\n   */\r\n  getOverlayContainerStopEvent() {\r\n    return this.overlayContainerStopEvent_;\r\n  }\r\n\r\n  /**\r\n   * @param {module:ol/Tile} tile Tile.\r\n   * @param {string} tileSourceKey Tile source key.\r\n   * @param {module:ol/coordinate~Coordinate} tileCenter Tile center.\r\n   * @param {number} tileResolution Tile resolution.\r\n   * @return {number} Tile priority.\r\n   */\r\n  getTilePriority(tile, tileSourceKey, tileCenter, tileResolution) {\r\n    // Filter out tiles at higher zoom levels than the current zoom level, or that\r\n    // are outside the visible extent.\r\n    const frameState = this.frameState_;\r\n    if (!frameState || !(tileSourceKey in frameState.wantedTiles)) {\r\n      return DROP;\r\n    }\r\n    if (!frameState.wantedTiles[tileSourceKey][tile.getKey()]) {\r\n      return DROP;\r\n    }\r\n    // Prioritize the highest zoom level tiles closest to the focus.\r\n    // Tiles at higher zoom levels are prioritized using Math.log(tileResolution).\r\n    // Within a zoom level, tiles are prioritized by the distance in pixels\r\n    // between the center of the tile and the focus.  The factor of 65536 means\r\n    // that the prioritization should behave as desired for tiles up to\r\n    // 65536 * Math.log(2) = 45426 pixels from the focus.\r\n    const deltaX = tileCenter[0] - frameState.focus[0];\r\n    const deltaY = tileCenter[1] - frameState.focus[1];\r\n    return 65536 * Math.log(tileResolution) +\r\n        Math.sqrt(deltaX * deltaX + deltaY * deltaY) / tileResolution;\r\n  }\r\n\r\n  /**\r\n   * @param {Event} browserEvent Browser event.\r\n   * @param {string=} opt_type Type.\r\n   */\r\n  handleBrowserEvent(browserEvent, opt_type) {\r\n    const type = opt_type || browserEvent.type;\r\n    const mapBrowserEvent = new MapBrowserEvent(type, this, browserEvent);\r\n    this.handleMapBrowserEvent(mapBrowserEvent);\r\n  }\r\n\r\n  /**\r\n   * @param {module:ol/MapBrowserEvent} mapBrowserEvent The event to handle.\r\n   */\r\n  handleMapBrowserEvent(mapBrowserEvent) {\r\n    if (!this.frameState_) {\r\n      // With no view defined, we cannot translate pixels into geographical\r\n      // coordinates so interactions cannot be used.\r\n      return;\r\n    }\r\n    this.focus_ = mapBrowserEvent.coordinate;\r\n    mapBrowserEvent.frameState = this.frameState_;\r\n    const interactionsArray = this.getInteractions().getArray();\r\n    if (this.dispatchEvent(mapBrowserEvent) !== false) {\r\n      for (let i = interactionsArray.length - 1; i >= 0; i--) {\r\n        const interaction = interactionsArray[i];\r\n        if (!interaction.getActive()) {\r\n          continue;\r\n        }\r\n        const cont = interaction.handleEvent(mapBrowserEvent);\r\n        if (!cont) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @protected\r\n   */\r\n  handlePostRender() {\r\n\r\n    const frameState = this.frameState_;\r\n\r\n    // Manage the tile queue\r\n    // Image loads are expensive and a limited resource, so try to use them\r\n    // efficiently:\r\n    // * When the view is static we allow a large number of parallel tile loads\r\n    //   to complete the frame as quickly as possible.\r\n    // * When animating or interacting, image loads can cause janks, so we reduce\r\n    //   the maximum number of loads per frame and limit the number of parallel\r\n    //   tile loads to remain reactive to view changes and to reduce the chance of\r\n    //   loading tiles that will quickly disappear from view.\r\n    const tileQueue = this.tileQueue_;\r\n    if (!tileQueue.isEmpty()) {\r\n      let maxTotalLoading = this.maxTilesLoading_;\r\n      let maxNewLoads = maxTotalLoading;\r\n      if (frameState) {\r\n        const hints = frameState.viewHints;\r\n        if (hints[ViewHint.ANIMATING]) {\r\n          maxTotalLoading = this.loadTilesWhileAnimating_ ? 8 : 0;\r\n          maxNewLoads = 2;\r\n        }\r\n        if (hints[ViewHint.INTERACTING]) {\r\n          maxTotalLoading = this.loadTilesWhileInteracting_ ? 8 : 0;\r\n          maxNewLoads = 2;\r\n        }\r\n      }\r\n      if (tileQueue.getTilesLoading() < maxTotalLoading) {\r\n        tileQueue.reprioritize(); // FIXME only call if view has changed\r\n        tileQueue.loadMoreTiles(maxTotalLoading, maxNewLoads);\r\n      }\r\n    }\r\n\r\n    const postRenderFunctions = this.postRenderFunctions_;\r\n    for (let i = 0, ii = postRenderFunctions.length; i < ii; ++i) {\r\n      postRenderFunctions[i](this, frameState);\r\n    }\r\n    postRenderFunctions.length = 0;\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  handleSizeChanged_() {\r\n    this.render();\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  handleTargetChanged_() {\r\n    // target may be undefined, null, a string or an Element.\r\n    // If it's a string we convert it to an Element before proceeding.\r\n    // If it's not now an Element we remove the viewport from the DOM.\r\n    // If it's an Element we append the viewport element to it.\r\n\r\n    let targetElement;\r\n    if (this.getTarget()) {\r\n      targetElement = this.getTargetElement();\r\n    }\r\n\r\n    if (this.keyHandlerKeys_) {\r\n      for (let i = 0, ii = this.keyHandlerKeys_.length; i < ii; ++i) {\r\n        unlistenByKey(this.keyHandlerKeys_[i]);\r\n      }\r\n      this.keyHandlerKeys_ = null;\r\n    }\r\n\r\n    if (!targetElement) {\r\n      this.renderer_.removeLayerRenderers();\r\n      removeNode(this.viewport_);\r\n      if (this.handleResize_ !== undefined) {\r\n        removeEventListener(EventType.RESIZE, this.handleResize_, false);\r\n        this.handleResize_ = undefined;\r\n      }\r\n    } else {\r\n      targetElement.appendChild(this.viewport_);\r\n\r\n      const keyboardEventTarget = !this.keyboardEventTarget_ ?\r\n        targetElement : this.keyboardEventTarget_;\r\n      this.keyHandlerKeys_ = [\r\n        listen(keyboardEventTarget, EventType.KEYDOWN, this.handleBrowserEvent, this),\r\n        listen(keyboardEventTarget, EventType.KEYPRESS, this.handleBrowserEvent, this)\r\n      ];\r\n\r\n      if (!this.handleResize_) {\r\n        this.handleResize_ = this.updateSize.bind(this);\r\n        addEventListener(EventType.RESIZE, this.handleResize_, false);\r\n      }\r\n    }\r\n\r\n    this.updateSize();\r\n    // updateSize calls setSize, so no need to call this.render\r\n    // ourselves here.\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  handleTileChange_() {\r\n    this.render();\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  handleViewPropertyChanged_() {\r\n    this.render();\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  handleViewChanged_() {\r\n    if (this.viewPropertyListenerKey_) {\r\n      unlistenByKey(this.viewPropertyListenerKey_);\r\n      this.viewPropertyListenerKey_ = null;\r\n    }\r\n    if (this.viewChangeListenerKey_) {\r\n      unlistenByKey(this.viewChangeListenerKey_);\r\n      this.viewChangeListenerKey_ = null;\r\n    }\r\n    const view = this.getView();\r\n    if (view) {\r\n      this.viewport_.setAttribute('data-view', getUid(view));\r\n      this.viewPropertyListenerKey_ = listen(\r\n        view, ObjectEventType.PROPERTYCHANGE,\r\n        this.handleViewPropertyChanged_, this);\r\n      this.viewChangeListenerKey_ = listen(\r\n        view, EventType.CHANGE,\r\n        this.handleViewPropertyChanged_, this);\r\n    }\r\n    this.render();\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  handleLayerGroupChanged_() {\r\n    if (this.layerGroupPropertyListenerKeys_) {\r\n      this.layerGroupPropertyListenerKeys_.forEach(unlistenByKey);\r\n      this.layerGroupPropertyListenerKeys_ = null;\r\n    }\r\n    const layerGroup = this.getLayerGroup();\r\n    if (layerGroup) {\r\n      this.layerGroupPropertyListenerKeys_ = [\r\n        listen(\r\n          layerGroup, ObjectEventType.PROPERTYCHANGE,\r\n          this.render, this),\r\n        listen(\r\n          layerGroup, EventType.CHANGE,\r\n          this.render, this)\r\n      ];\r\n    }\r\n    this.render();\r\n  }\r\n\r\n  /**\r\n   * @return {boolean} Is rendered.\r\n   */\r\n  isRendered() {\r\n    return !!this.frameState_;\r\n  }\r\n\r\n  /**\r\n   * Requests an immediate render in a synchronous manner.\r\n   * @api\r\n   */\r\n  renderSync() {\r\n    if (this.animationDelayKey_) {\r\n      cancelAnimationFrame(this.animationDelayKey_);\r\n    }\r\n    this.animationDelay_();\r\n  }\r\n\r\n  /**\r\n   * Request a map rendering (at the next animation frame).\r\n   * @api\r\n   */\r\n  render() {\r\n    if (this.animationDelayKey_ === undefined) {\r\n      this.animationDelayKey_ = requestAnimationFrame(this.animationDelay_);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove the given control from the map.\r\n   * @param {module:ol/control/Control} control Control.\r\n   * @return {module:ol/control/Control|undefined} The removed control (or undefined\r\n   *     if the control was not found).\r\n   * @api\r\n   */\r\n  removeControl(control) {\r\n    return this.getControls().remove(control);\r\n  }\r\n\r\n  /**\r\n   * Remove the given interaction from the map.\r\n   * @param {module:ol/interaction/Interaction} interaction Interaction to remove.\r\n   * @return {module:ol/interaction/Interaction|undefined} The removed interaction (or\r\n   *     undefined if the interaction was not found).\r\n   * @api\r\n   */\r\n  removeInteraction(interaction) {\r\n    return this.getInteractions().remove(interaction);\r\n  }\r\n\r\n  /**\r\n   * Removes the given layer from the map.\r\n   * @param {module:ol/layer/Base} layer Layer.\r\n   * @return {module:ol/layer/Base|undefined} The removed layer (or undefined if the\r\n   *     layer was not found).\r\n   * @api\r\n   */\r\n  removeLayer(layer) {\r\n    const layers = this.getLayerGroup().getLayers();\r\n    return layers.remove(layer);\r\n  }\r\n\r\n  /**\r\n   * Remove the given overlay from the map.\r\n   * @param {module:ol/Overlay} overlay Overlay.\r\n   * @return {module:ol/Overlay|undefined} The removed overlay (or undefined\r\n   *     if the overlay was not found).\r\n   * @api\r\n   */\r\n  removeOverlay(overlay) {\r\n    return this.getOverlays().remove(overlay);\r\n  }\r\n\r\n  /**\r\n   * @param {number} time Time.\r\n   * @private\r\n   */\r\n  renderFrame_(time) {\r\n    let viewState;\r\n\r\n    const size = this.getSize();\r\n    const view = this.getView();\r\n    const extent = createEmpty();\r\n    const previousFrameState = this.frameState_;\r\n    /** @type {?module:ol/PluggableMap~FrameState} */\r\n    let frameState = null;\r\n    if (size !== undefined && hasArea(size) && view && view.isDef()) {\r\n      const viewHints = view.getHints(this.frameState_ ? this.frameState_.viewHints : undefined);\r\n      const layerStatesArray = this.getLayerGroup().getLayerStatesArray();\r\n      const layerStates = {};\r\n      for (let i = 0, ii = layerStatesArray.length; i < ii; ++i) {\r\n        layerStates[getUid(layerStatesArray[i].layer)] = layerStatesArray[i];\r\n      }\r\n      viewState = view.getState();\r\n      let focus = this.focus_;\r\n      if (!focus) {\r\n        focus = viewState.center;\r\n        const pixelResolution = viewState.resolution / this.pixelRatio_;\r\n        focus[0] = Math.round(focus[0] / pixelResolution) * pixelResolution;\r\n        focus[1] = Math.round(focus[1] / pixelResolution) * pixelResolution;\r\n      }\r\n      frameState = /** @type {module:ol/PluggableMap~FrameState} */ ({\r\n        animate: false,\r\n        coordinateToPixelTransform: this.coordinateToPixelTransform_,\r\n        extent: extent,\r\n        focus: focus,\r\n        index: this.frameIndex_++,\r\n        layerStates: layerStates,\r\n        layerStatesArray: layerStatesArray,\r\n        pixelRatio: this.pixelRatio_,\r\n        pixelToCoordinateTransform: this.pixelToCoordinateTransform_,\r\n        postRenderFunctions: [],\r\n        size: size,\r\n        skippedFeatureUids: this.skippedFeatureUids_,\r\n        tileQueue: this.tileQueue_,\r\n        time: time,\r\n        usedTiles: {},\r\n        viewState: viewState,\r\n        viewHints: viewHints,\r\n        wantedTiles: {}\r\n      });\r\n    }\r\n\r\n    if (frameState) {\r\n      frameState.extent = getForViewAndSize(viewState.center,\r\n        viewState.resolution, viewState.rotation, frameState.size, extent);\r\n    }\r\n\r\n    this.frameState_ = frameState;\r\n    this.renderer_.renderFrame(frameState);\r\n\r\n    if (frameState) {\r\n      if (frameState.animate) {\r\n        this.render();\r\n      }\r\n      Array.prototype.push.apply(this.postRenderFunctions_, frameState.postRenderFunctions);\r\n\r\n      if (previousFrameState) {\r\n        const moveStart = !this.previousExtent_ ||\r\n                    (!isEmpty(this.previousExtent_) &&\r\n                    !equals(frameState.extent, this.previousExtent_));\r\n        if (moveStart) {\r\n          this.dispatchEvent(\r\n            new MapEvent(MapEventType.MOVESTART, this, previousFrameState));\r\n          this.previousExtent_ = createOrUpdateEmpty(this.previousExtent_);\r\n        }\r\n      }\r\n\r\n      const idle = this.previousExtent_ &&\r\n          !frameState.viewHints[ViewHint.ANIMATING] &&\r\n          !frameState.viewHints[ViewHint.INTERACTING] &&\r\n          !equals(frameState.extent, this.previousExtent_);\r\n\r\n      if (idle) {\r\n        this.dispatchEvent(new MapEvent(MapEventType.MOVEEND, this, frameState));\r\n        clone(frameState.extent, this.previousExtent_);\r\n      }\r\n    }\r\n\r\n    this.dispatchEvent(new MapEvent(MapEventType.POSTRENDER, this, frameState));\r\n\r\n    setTimeout(this.handlePostRender.bind(this), 0);\r\n\r\n  }\r\n\r\n  /**\r\n   * Sets the layergroup of this map.\r\n   * @param {module:ol/layer/Group} layerGroup A layer group containing the layers in this map.\r\n   * @observable\r\n   * @api\r\n   */\r\n  setLayerGroup(layerGroup) {\r\n    this.set(MapProperty.LAYERGROUP, layerGroup);\r\n  }\r\n\r\n  /**\r\n   * Set the size of this map.\r\n   * @param {module:ol/size~Size|undefined} size The size in pixels of the map in the DOM.\r\n   * @observable\r\n   * @api\r\n   */\r\n  setSize(size) {\r\n    this.set(MapProperty.SIZE, size);\r\n  }\r\n\r\n  /**\r\n   * Set the target element to render this map into.\r\n   * @param {HTMLElement|string|undefined} target The Element or id of the Element\r\n   *     that the map is rendered in.\r\n   * @observable\r\n   * @api\r\n   */\r\n  setTarget(target) {\r\n    this.set(MapProperty.TARGET, target);\r\n  }\r\n\r\n  /**\r\n   * Set the view for this map.\r\n   * @param {module:ol/View} view The view that controls this map.\r\n   * @observable\r\n   * @api\r\n   */\r\n  setView(view) {\r\n    this.set(MapProperty.VIEW, view);\r\n  }\r\n\r\n  /**\r\n   * @param {module:ol/Feature} feature Feature.\r\n   */\r\n  skipFeature(feature) {\r\n    const featureUid = getUid(feature).toString();\r\n    this.skippedFeatureUids_[featureUid] = true;\r\n    this.render();\r\n  }\r\n\r\n  /**\r\n   * Force a recalculation of the map viewport size.  This should be called when\r\n   * third-party code changes the size of the map viewport.\r\n   * @api\r\n   */\r\n  updateSize() {\r\n    const targetElement = this.getTargetElement();\r\n\r\n    if (!targetElement) {\r\n      this.setSize(undefined);\r\n    } else {\r\n      const computedStyle = getComputedStyle(targetElement);\r\n      this.setSize([\r\n        targetElement.offsetWidth -\r\n            parseFloat(computedStyle['borderLeftWidth']) -\r\n            parseFloat(computedStyle['paddingLeft']) -\r\n            parseFloat(computedStyle['paddingRight']) -\r\n            parseFloat(computedStyle['borderRightWidth']),\r\n        targetElement.offsetHeight -\r\n            parseFloat(computedStyle['borderTopWidth']) -\r\n            parseFloat(computedStyle['paddingTop']) -\r\n            parseFloat(computedStyle['paddingBottom']) -\r\n            parseFloat(computedStyle['borderBottomWidth'])\r\n      ]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param {module:ol/Feature} feature Feature.\r\n   */\r\n  unskipFeature(feature) {\r\n    const featureUid = getUid(feature).toString();\r\n    delete this.skippedFeatureUids_[featureUid];\r\n    this.render();\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * @param {MapOptions} options Map options.\r\n * @return {module:ol/PluggableMap~MapOptionsInternal} Internal map options.\r\n */\r\nfunction createOptionsInternal(options) {\r\n\r\n  /**\r\n   * @type {HTMLElement|Document}\r\n   */\r\n  let keyboardEventTarget = null;\r\n  if (options.keyboardEventTarget !== undefined) {\r\n    keyboardEventTarget = typeof options.keyboardEventTarget === 'string' ?\r\n      document.getElementById(options.keyboardEventTarget) :\r\n      options.keyboardEventTarget;\r\n  }\r\n\r\n  /**\r\n   * @type {Object.<string, *>}\r\n   */\r\n  const values = {};\r\n\r\n  const layerGroup = (options.layers instanceof LayerGroup) ?\r\n    options.layers : new LayerGroup({layers: options.layers});\r\n  values[MapProperty.LAYERGROUP] = layerGroup;\r\n\r\n  values[MapProperty.TARGET] = options.target;\r\n\r\n  values[MapProperty.VIEW] = options.view !== undefined ?\r\n    options.view : new View();\r\n\r\n  let controls;\r\n  if (options.controls !== undefined) {\r\n    if (Array.isArray(options.controls)) {\r\n      controls = new Collection(options.controls.slice());\r\n    } else {\r\n      assert(options.controls instanceof Collection,\r\n        47); // Expected `controls` to be an array or an `module:ol/Collection~Collection`\r\n      controls = options.controls;\r\n    }\r\n  }\r\n\r\n  let interactions;\r\n  if (options.interactions !== undefined) {\r\n    if (Array.isArray(options.interactions)) {\r\n      interactions = new Collection(options.interactions.slice());\r\n    } else {\r\n      assert(options.interactions instanceof Collection,\r\n        48); // Expected `interactions` to be an array or an `module:ol/Collection~Collection`\r\n      interactions = options.interactions;\r\n    }\r\n  }\r\n\r\n  let overlays;\r\n  if (options.overlays !== undefined) {\r\n    if (Array.isArray(options.overlays)) {\r\n      overlays = new Collection(options.overlays.slice());\r\n    } else {\r\n      assert(options.overlays instanceof Collection,\r\n        49); // Expected `overlays` to be an array or an `module:ol/Collection~Collection`\r\n      overlays = options.overlays;\r\n    }\r\n  } else {\r\n    overlays = new Collection();\r\n  }\r\n\r\n  return {\r\n    controls: controls,\r\n    interactions: interactions,\r\n    keyboardEventTarget: keyboardEventTarget,\r\n    overlays: overlays,\r\n    values: values\r\n  };\r\n\r\n}\r\nexport default PluggableMap;\r\n"],"names":["super","const","let","this"],"mappings":"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"}