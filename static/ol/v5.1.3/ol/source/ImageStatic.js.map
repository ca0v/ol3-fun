{"version":3,"file":"ImageStatic.js","sources":["../../../src/ol/source/ImageStatic.js"],"sourcesContent":["/**\r\n * @module ol/source/ImageStatic\r\n */\r\n\r\nimport ImageWrapper from '../Image.js';\r\nimport ImageState from '../ImageState.js';\r\nimport {createCanvasContext2D} from '../dom.js';\r\nimport {listen} from '../events.js';\r\nimport EventType from '../events/EventType.js';\r\nimport {intersects, getHeight, getWidth} from '../extent.js';\r\nimport {get as getProjection} from '../proj.js';\r\nimport ImageSource, {defaultImageLoadFunction} from '../source/Image.js';\r\n\r\n/**\r\n * @typedef {Object} Options\r\n * @property {module:ol/source/Source~AttributionLike} [attributions] Attributions.\r\n * @property {null|string} [crossOrigin] The `crossOrigin` attribute for loaded images.  Note that\r\n * you must provide a `crossOrigin` value if you are using the WebGL renderer or if you want to\r\n * access pixel data with the Canvas renderer.  See\r\n * https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image for more detail.\r\n * @property {module:ol/extent~Extent} [imageExtent] Extent of the image in map coordinates.\r\n * This is the [left, bottom, right, top] map coordinates of your image.\r\n * @property {module:ol/Image~LoadFunction} [imageLoadFunction] Optional function to load an image given a URL.\r\n * @property {module:ol/proj~ProjectionLike} projection Projection.\r\n * @property {module:ol/size~Size} [imageSize] Size of the image in pixels. Usually the image size is auto-detected, so this\r\n * only needs to be set if auto-detection fails for some reason.\r\n * @property {string} url Image URL.\r\n */\r\n\r\n\r\n/**\r\n * @classdesc\r\n * A layer source for displaying a single, static image.\r\n * @api\r\n */\r\nclass Static extends ImageSource {\r\n  /**\r\n   * @param {module:ol/source/ImageStatic~Options=} options ImageStatic options.\r\n   */\r\n  constructor(options) {\r\n    const imageExtent = options.imageExtent;\r\n\r\n    const crossOrigin = options.crossOrigin !== undefined ?\r\n      options.crossOrigin : null;\r\n\r\n    const /** @type {module:ol/Image~LoadFunction} */ imageLoadFunction =\r\n        options.imageLoadFunction !== undefined ?\r\n          options.imageLoadFunction : defaultImageLoadFunction;\r\n\r\n    super({\r\n      attributions: options.attributions,\r\n      projection: getProjection(options.projection)\r\n    });\r\n\r\n    /**\r\n     * @private\r\n     * @type {module:ol/Image}\r\n     */\r\n    this.image_ = new ImageWrapper(imageExtent, undefined, 1, options.url, crossOrigin, imageLoadFunction);\r\n\r\n    /**\r\n     * @private\r\n     * @type {module:ol/size~Size}\r\n     */\r\n    this.imageSize_ = options.imageSize ? options.imageSize : null;\r\n\r\n    listen(this.image_, EventType.CHANGE,\r\n      this.handleImageChange, this);\r\n\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  getImageInternal(extent, resolution, pixelRatio, projection) {\r\n    if (intersects(extent, this.image_.getExtent())) {\r\n      return this.image_;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  handleImageChange(evt) {\r\n    if (this.image_.getState() == ImageState.LOADED) {\r\n      const imageExtent = this.image_.getExtent();\r\n      const image = this.image_.getImage();\r\n      let imageWidth, imageHeight;\r\n      if (this.imageSize_) {\r\n        imageWidth = this.imageSize_[0];\r\n        imageHeight = this.imageSize_[1];\r\n      } else {\r\n        imageWidth = image.width;\r\n        imageHeight = image.height;\r\n      }\r\n      const resolution = getHeight(imageExtent) / imageHeight;\r\n      const targetWidth = Math.ceil(getWidth(imageExtent) / resolution);\r\n      if (targetWidth != imageWidth) {\r\n        const context = createCanvasContext2D(targetWidth, imageHeight);\r\n        const canvas = context.canvas;\r\n        context.drawImage(image, 0, 0, imageWidth, imageHeight,\r\n          0, 0, canvas.width, canvas.height);\r\n        this.image_.setImage(canvas);\r\n      }\r\n    }\r\n    ImageSource.prototype.handleImageChange.call(this, evt);\r\n  }\r\n}\r\n\r\n\r\nexport default Static;\r\n"],"names":["const","super","let"],"mappings":"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"}