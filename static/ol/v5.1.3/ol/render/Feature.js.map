{"version":3,"file":"Feature.js","sources":["../../../src/ol/render/Feature.js"],"sourcesContent":["/**\r\n * @module ol/render/Feature\r\n */\r\nimport {UNDEFINED} from '../functions.js';\r\nimport {extend} from '../array.js';\r\nimport {createOrUpdateFromCoordinate, createOrUpdateFromFlatCoordinates, getCenter, getHeight} from '../extent.js';\r\nimport GeometryType from '../geom/GeometryType.js';\r\nimport {linearRingss as linearRingssCenter} from '../geom/flat/center.js';\r\nimport {getInteriorPointOfArray, getInteriorPointsOfMultiArray} from '../geom/flat/interiorpoint.js';\r\nimport {interpolatePoint} from '../geom/flat/interpolate.js';\r\nimport {get as getProjection} from '../proj.js';\r\nimport {transform2D} from '../geom/flat/transform.js';\r\nimport {create as createTransform, compose as composeTransform} from '../transform.js';\r\n\r\n\r\n/**\r\n * @type {module:ol/transform~Transform}\r\n */\r\nconst tmpTransform = createTransform();\r\n\r\n\r\n/**\r\n * Lightweight, read-only, {@link module:ol/Feature~Feature} and {@link module:ol/geom/Geometry~Geometry} like\r\n * structure, optimized for vector tile rendering and styling. Geometry access\r\n * through the API is limited to getting the type and extent of the geometry.\r\n *\r\n * @param {module:ol/geom/GeometryType} type Geometry type.\r\n * @param {Array.<number>} flatCoordinates Flat coordinates. These always need\r\n *     to be right-handed for polygons.\r\n * @param {Array.<number>|Array.<Array.<number>>} ends Ends or Endss.\r\n * @param {Object.<string, *>} properties Properties.\r\n * @param {number|string|undefined} id Feature id.\r\n */\r\nclass RenderFeature {\r\n  constructor(type, flatCoordinates, ends, properties, id) {\r\n    /**\r\n    * @private\r\n    * @type {module:ol/extent~Extent|undefined}\r\n    */\r\n    this.extent_;\r\n\r\n    /**\r\n    * @private\r\n    * @type {number|string|undefined}\r\n    */\r\n    this.id_ = id;\r\n\r\n    /**\r\n    * @private\r\n    * @type {module:ol/geom/GeometryType}\r\n    */\r\n    this.type_ = type;\r\n\r\n    /**\r\n    * @private\r\n    * @type {Array.<number>}\r\n    */\r\n    this.flatCoordinates_ = flatCoordinates;\r\n\r\n    /**\r\n    * @private\r\n    * @type {Array.<number>}\r\n    */\r\n    this.flatInteriorPoints_ = null;\r\n\r\n    /**\r\n    * @private\r\n    * @type {Array.<number>}\r\n    */\r\n    this.flatMidpoints_ = null;\r\n\r\n    /**\r\n    * @private\r\n    * @type {Array.<number>|Array.<Array.<number>>}\r\n    */\r\n    this.ends_ = ends;\r\n\r\n    /**\r\n    * @private\r\n    * @type {Object.<string, *>}\r\n    */\r\n    this.properties_ = properties;\r\n\r\n  }\r\n\r\n  /**\r\n  * Get a feature property by its key.\r\n  * @param {string} key Key\r\n  * @return {*} Value for the requested key.\r\n  * @api\r\n  */\r\n  get(key) {\r\n    return this.properties_[key];\r\n  }\r\n\r\n  /**\r\n  * Get the extent of this feature's geometry.\r\n  * @return {module:ol/extent~Extent} Extent.\r\n  * @api\r\n  */\r\n  getExtent() {\r\n    if (!this.extent_) {\r\n      this.extent_ = this.type_ === GeometryType.POINT ?\r\n        createOrUpdateFromCoordinate(this.flatCoordinates_) :\r\n        createOrUpdateFromFlatCoordinates(\r\n          this.flatCoordinates_, 0, this.flatCoordinates_.length, 2);\r\n\r\n    }\r\n    return this.extent_;\r\n  }\r\n\r\n  /**\r\n  * @return {Array.<number>} Flat interior points.\r\n  */\r\n  getFlatInteriorPoint() {\r\n    if (!this.flatInteriorPoints_) {\r\n      const flatCenter = getCenter(this.getExtent());\r\n      this.flatInteriorPoints_ = getInteriorPointOfArray(\r\n        this.flatCoordinates_, 0, this.ends_, 2, flatCenter, 0);\r\n    }\r\n    return this.flatInteriorPoints_;\r\n  }\r\n\r\n  /**\r\n  * @return {Array.<number>} Flat interior points.\r\n  */\r\n  getFlatInteriorPoints() {\r\n    if (!this.flatInteriorPoints_) {\r\n      const flatCenters = linearRingssCenter(\r\n        this.flatCoordinates_, 0, this.ends_, 2);\r\n      this.flatInteriorPoints_ = getInteriorPointsOfMultiArray(\r\n        this.flatCoordinates_, 0, this.ends_, 2, flatCenters);\r\n    }\r\n    return this.flatInteriorPoints_;\r\n  }\r\n\r\n  /**\r\n  * @return {Array.<number>} Flat midpoint.\r\n  */\r\n  getFlatMidpoint() {\r\n    if (!this.flatMidpoints_) {\r\n      this.flatMidpoints_ = interpolatePoint(\r\n        this.flatCoordinates_, 0, this.flatCoordinates_.length, 2, 0.5);\r\n    }\r\n    return this.flatMidpoints_;\r\n  }\r\n\r\n  /**\r\n  * @return {Array.<number>} Flat midpoints.\r\n  */\r\n  getFlatMidpoints() {\r\n    if (!this.flatMidpoints_) {\r\n      this.flatMidpoints_ = [];\r\n      const flatCoordinates = this.flatCoordinates_;\r\n      let offset = 0;\r\n      const ends = this.ends_;\r\n      for (let i = 0, ii = ends.length; i < ii; ++i) {\r\n        const end = ends[i];\r\n        const midpoint = interpolatePoint(\r\n          flatCoordinates, offset, end, 2, 0.5);\r\n        extend(this.flatMidpoints_, midpoint);\r\n        offset = end;\r\n      }\r\n    }\r\n    return this.flatMidpoints_;\r\n  }\r\n\r\n  /**\r\n  * Get the feature identifier.  This is a stable identifier for the feature and\r\n  * is set when reading data from a remote source.\r\n  * @return {number|string|undefined} Id.\r\n  * @api\r\n  */\r\n  getId() {\r\n    return this.id_;\r\n  }\r\n\r\n  /**\r\n  * @return {Array.<number>} Flat coordinates.\r\n  */\r\n  getOrientedFlatCoordinates() {\r\n    return this.flatCoordinates_;\r\n  }\r\n\r\n  /**\r\n  * For API compatibility with {@link module:ol/Feature~Feature}, this method is useful when\r\n  * determining the geometry type in style function (see {@link #getType}).\r\n  * @return {module:ol/render/Feature} Feature.\r\n  * @api\r\n  */\r\n  getGeometry() {\r\n    return this;\r\n  }\r\n\r\n  /**\r\n  * Get the feature properties.\r\n  * @return {Object.<string, *>} Feature properties.\r\n  * @api\r\n  */\r\n  getProperties() {\r\n    return this.properties_;\r\n  }\r\n\r\n  /**\r\n  * @return {number} Stride.\r\n  */\r\n  getStride() {\r\n    return 2;\r\n  }\r\n\r\n  /**\r\n  * Get the type of this feature's geometry.\r\n  * @return {module:ol/geom/GeometryType} Geometry type.\r\n  * @api\r\n  */\r\n  getType() {\r\n    return this.type_;\r\n  }\r\n\r\n  /**\r\n  * Transform geometry coordinates from tile pixel space to projected.\r\n  * The SRS of the source and destination are expected to be the same.\r\n  *\r\n  * @param {module:ol/proj~ProjectionLike} source The current projection\r\n  * @param {module:ol/proj~ProjectionLike} destination The desired projection.\r\n  */\r\n  transform(source, destination) {\r\n    source = getProjection(source);\r\n    const pixelExtent = source.getExtent();\r\n    const projectedExtent = source.getWorldExtent();\r\n    const scale = getHeight(projectedExtent) / getHeight(pixelExtent);\r\n    composeTransform(tmpTransform,\r\n      projectedExtent[0], projectedExtent[3],\r\n      scale, -scale, 0,\r\n      0, 0);\r\n    transform2D(this.flatCoordinates_, 0, this.flatCoordinates_.length, 2,\r\n      tmpTransform, this.flatCoordinates_);\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * @return {Array.<number>|Array.<Array.<number>>} Ends or endss.\r\n */\r\nRenderFeature.prototype.getEnds =\r\nRenderFeature.prototype.getEndss = function() {\r\n  return this.ends_;\r\n};\r\n\r\n\r\n/**\r\n * @return {Array.<number>} Flat coordinates.\r\n */\r\nRenderFeature.prototype.getFlatCoordinates =\r\n    RenderFeature.prototype.getOrientedFlatCoordinates;\r\n\r\n\r\n/**\r\n * Get the feature for working with its geometry.\r\n * @return {module:ol/render/Feature} Feature.\r\n */\r\nRenderFeature.prototype.getSimplifiedGeometry =\r\n    RenderFeature.prototype.getGeometry;\r\n\r\n\r\n/**\r\n * @return {undefined}\r\n */\r\nRenderFeature.prototype.getStyleFunction = UNDEFINED;\r\n\r\n\r\nexport default RenderFeature;\r\n"],"names":["const","let","this"],"mappings":"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"}