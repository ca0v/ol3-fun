{"version":3,"file":"Replay.js","sources":["../../../../src/ol/render/webgl/Replay.js"],"sourcesContent":["/**\r\n * @module ol/render/webgl/Replay\r\n */\r\n\r\nimport {getCenter} from '../../extent.js';\r\nimport VectorContext from '../VectorContext.js';\r\nimport {\r\n  create as createTransform,\r\n  reset as resetTransform,\r\n  rotate as rotateTransform,\r\n  scale as scaleTransform,\r\n  translate as translateTransform\r\n} from '../../transform.js';\r\nimport {create, fromTransform} from '../../vec/mat4.js';\r\nimport {ARRAY_BUFFER, ELEMENT_ARRAY_BUFFER, TRIANGLES,\r\n  UNSIGNED_INT, UNSIGNED_SHORT} from '../../webgl.js';\r\n\r\nclass WebGLReplay extends VectorContext {\r\n  /**\r\n   * @param {number} tolerance Tolerance.\r\n   * @param {module:ol/extent~Extent} maxExtent Max extent.\r\n   */\r\n  constructor(tolerance, maxExtent) {\r\n    super();\r\n\r\n    /**\r\n     * @protected\r\n     * @type {number}\r\n     */\r\n    this.tolerance = tolerance;\r\n\r\n    /**\r\n     * @protected\r\n     * @const\r\n     * @type {module:ol/extent~Extent}\r\n     */\r\n    this.maxExtent = maxExtent;\r\n\r\n    /**\r\n     * The origin of the coordinate system for the point coordinates sent to\r\n     * the GPU. To eliminate jitter caused by precision problems in the GPU\r\n     * we use the \"Rendering Relative to Eye\" technique described in the \"3D\r\n     * Engine Design for Virtual Globes\" book.\r\n     * @protected\r\n     * @type {module:ol/coordinate~Coordinate}\r\n     */\r\n    this.origin = getCenter(maxExtent);\r\n\r\n    /**\r\n     * @private\r\n     * @type {module:ol/transform~Transform}\r\n     */\r\n    this.projectionMatrix_ = createTransform();\r\n\r\n    /**\r\n     * @private\r\n     * @type {module:ol/transform~Transform}\r\n     */\r\n    this.offsetRotateMatrix_ = createTransform();\r\n\r\n    /**\r\n     * @private\r\n     * @type {module:ol/transform~Transform}\r\n     */\r\n    this.offsetScaleMatrix_ = createTransform();\r\n\r\n    /**\r\n     * @private\r\n     * @type {Array.<number>}\r\n     */\r\n    this.tmpMat4_ = create();\r\n\r\n    /**\r\n     * @protected\r\n     * @type {Array.<number>}\r\n     */\r\n    this.indices = [];\r\n\r\n    /**\r\n     * @protected\r\n     * @type {?module:ol/webgl/Buffer}\r\n     */\r\n    this.indicesBuffer = null;\r\n\r\n    /**\r\n     * Start index per feature (the index).\r\n     * @protected\r\n     * @type {Array.<number>}\r\n     */\r\n    this.startIndices = [];\r\n\r\n    /**\r\n     * Start index per feature (the feature).\r\n     * @protected\r\n     * @type {Array.<module:ol/Feature|module:ol/render/Feature>}\r\n     */\r\n    this.startIndicesFeature = [];\r\n\r\n    /**\r\n     * @protected\r\n     * @type {Array.<number>}\r\n     */\r\n    this.vertices = [];\r\n\r\n    /**\r\n     * @protected\r\n     * @type {?module:ol/webgl/Buffer}\r\n     */\r\n    this.verticesBuffer = null;\r\n\r\n    /**\r\n     * Optional parameter for PolygonReplay instances.\r\n     * @protected\r\n     * @type {module:ol/render/webgl/LineStringReplay|undefined}\r\n     */\r\n    this.lineStringReplay = undefined;\r\n\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   * @param {module:ol/webgl/Context} context WebGL context.\r\n   * @return {function()} Delete resources function.\r\n   */\r\n  getDeleteResourcesFunction(context) {}\r\n\r\n  /**\r\n   * @abstract\r\n   * @param {module:ol/webgl/Context} context Context.\r\n   */\r\n  finish(context) {}\r\n\r\n  /**\r\n   * @abstract\r\n   * @protected\r\n   * @param {WebGLRenderingContext} gl gl.\r\n   * @param {module:ol/webgl/Context} context Context.\r\n   * @param {module:ol/size~Size} size Size.\r\n   * @param {number} pixelRatio Pixel ratio.\r\n   * @return {module:ol/render/webgl/circlereplay/defaultshader/Locations|\r\n     module:ol/render/webgl/linestringreplay/defaultshader/Locations|\r\n     module:ol/render/webgl/polygonreplay/defaultshader/Locations|\r\n     module:ol/render/webgl/texturereplay/defaultshader/Locations} Locations.\r\n   */\r\n  setUpProgram(gl, context, size, pixelRatio) {}\r\n\r\n  /**\r\n   * @abstract\r\n   * @protected\r\n   * @param {WebGLRenderingContext} gl gl.\r\n   * @param {module:ol/render/webgl/circlereplay/defaultshader/Locations|\r\n     module:ol/render/webgl/linestringreplay/defaultshader/Locations|\r\n     module:ol/render/webgl/polygonreplay/defaultshader/Locations|\r\n     module:ol/render/webgl/texturereplay/defaultshader/Locations} locations Locations.\r\n   */\r\n  shutDownProgram(gl, locations) {}\r\n\r\n  /**\r\n   * @abstract\r\n   * @protected\r\n   * @param {WebGLRenderingContext} gl gl.\r\n   * @param {module:ol/webgl/Context} context Context.\r\n   * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features to skip.\r\n   * @param {boolean} hitDetection Hit detection mode.\r\n   */\r\n  drawReplay(gl, context, skippedFeaturesHash, hitDetection) {}\r\n\r\n  /**\r\n   * @abstract\r\n   * @protected\r\n   * @param {WebGLRenderingContext} gl gl.\r\n   * @param {module:ol/webgl/Context} context Context.\r\n   * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features to skip.\r\n   * @param {function((module:ol/Feature|module:ol/render/Feature)): T|undefined} featureCallback Feature callback.\r\n   * @param {module:ol/extent~Extent=} opt_hitExtent Hit extent: Only features intersecting this extent are checked.\r\n   * @return {T|undefined} Callback result.\r\n   * @template T\r\n   */\r\n  drawHitDetectionReplayOneByOne(gl, context, skippedFeaturesHash, featureCallback, opt_hitExtent) {}\r\n\r\n  /**\r\n   * @protected\r\n   * @param {WebGLRenderingContext} gl gl.\r\n   * @param {module:ol/webgl/Context} context Context.\r\n   * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features to skip.\r\n   * @param {function((module:ol/Feature|module:ol/render/Feature)): T|undefined} featureCallback Feature callback.\r\n   * @param {boolean} oneByOne Draw features one-by-one for the hit-detecion.\r\n   * @param {module:ol/extent~Extent=} opt_hitExtent Hit extent: Only features intersecting this extent are checked.\r\n   * @return {T|undefined} Callback result.\r\n   * @template T\r\n   */\r\n  drawHitDetectionReplay(gl, context, skippedFeaturesHash, featureCallback, oneByOne, opt_hitExtent) {\r\n    if (!oneByOne) {\r\n      // draw all hit-detection features in \"once\" (by texture group)\r\n      return this.drawHitDetectionReplayAll(gl, context,\r\n        skippedFeaturesHash, featureCallback);\r\n    } else {\r\n      // draw hit-detection features one by one\r\n      return this.drawHitDetectionReplayOneByOne(gl, context,\r\n        skippedFeaturesHash, featureCallback, opt_hitExtent);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @protected\r\n   * @param {WebGLRenderingContext} gl gl.\r\n   * @param {module:ol/webgl/Context} context Context.\r\n   * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features to skip.\r\n   * @param {function((module:ol/Feature|module:ol/render/Feature)): T|undefined} featureCallback Feature callback.\r\n   * @return {T|undefined} Callback result.\r\n   * @template T\r\n   */\r\n  drawHitDetectionReplayAll(gl, context, skippedFeaturesHash, featureCallback) {\r\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n    this.drawReplay(gl, context, skippedFeaturesHash, true);\r\n\r\n    const result = featureCallback(null);\r\n    if (result) {\r\n      return result;\r\n    } else {\r\n      return undefined;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param {module:ol/webgl/Context} context Context.\r\n   * @param {module:ol/coordinate~Coordinate} center Center.\r\n   * @param {number} resolution Resolution.\r\n   * @param {number} rotation Rotation.\r\n   * @param {module:ol/size~Size} size Size.\r\n   * @param {number} pixelRatio Pixel ratio.\r\n   * @param {number} opacity Global opacity.\r\n   * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features to skip.\r\n   * @param {function((module:ol/Feature|module:ol/render/Feature)): T|undefined} featureCallback Feature callback.\r\n   * @param {boolean} oneByOne Draw features one-by-one for the hit-detecion.\r\n   * @param {module:ol/extent~Extent=} opt_hitExtent Hit extent: Only features intersecting this extent are checked.\r\n   * @return {T|undefined} Callback result.\r\n   * @template T\r\n   */\r\n  replay(\r\n    context,\r\n    center,\r\n    resolution,\r\n    rotation,\r\n    size,\r\n    pixelRatio,\r\n    opacity,\r\n    skippedFeaturesHash,\r\n    featureCallback,\r\n    oneByOne,\r\n    opt_hitExtent\r\n  ) {\r\n    const gl = context.getGL();\r\n    let tmpStencil, tmpStencilFunc, tmpStencilMaskVal, tmpStencilRef, tmpStencilMask,\r\n        tmpStencilOpFail, tmpStencilOpPass, tmpStencilOpZFail;\r\n\r\n    if (this.lineStringReplay) {\r\n      tmpStencil = gl.isEnabled(gl.STENCIL_TEST);\r\n      tmpStencilFunc = gl.getParameter(gl.STENCIL_FUNC);\r\n      tmpStencilMaskVal = gl.getParameter(gl.STENCIL_VALUE_MASK);\r\n      tmpStencilRef = gl.getParameter(gl.STENCIL_REF);\r\n      tmpStencilMask = gl.getParameter(gl.STENCIL_WRITEMASK);\r\n      tmpStencilOpFail = gl.getParameter(gl.STENCIL_FAIL);\r\n      tmpStencilOpPass = gl.getParameter(gl.STENCIL_PASS_DEPTH_PASS);\r\n      tmpStencilOpZFail = gl.getParameter(gl.STENCIL_PASS_DEPTH_FAIL);\r\n\r\n      gl.enable(gl.STENCIL_TEST);\r\n      gl.clear(gl.STENCIL_BUFFER_BIT);\r\n      gl.stencilMask(255);\r\n      gl.stencilFunc(gl.ALWAYS, 1, 255);\r\n      gl.stencilOp(gl.KEEP, gl.KEEP, gl.REPLACE);\r\n\r\n      this.lineStringReplay.replay(context,\r\n        center, resolution, rotation, size, pixelRatio,\r\n        opacity, skippedFeaturesHash,\r\n        featureCallback, oneByOne, opt_hitExtent);\r\n\r\n      gl.stencilMask(0);\r\n      gl.stencilFunc(gl.NOTEQUAL, 1, 255);\r\n    }\r\n\r\n    context.bindBuffer(ARRAY_BUFFER, this.verticesBuffer);\r\n\r\n    context.bindBuffer(ELEMENT_ARRAY_BUFFER, this.indicesBuffer);\r\n\r\n    const locations = this.setUpProgram(gl, context, size, pixelRatio);\r\n\r\n    // set the \"uniform\" values\r\n    const projectionMatrix = resetTransform(this.projectionMatrix_);\r\n    scaleTransform(projectionMatrix, 2 / (resolution * size[0]), 2 / (resolution * size[1]));\r\n    rotateTransform(projectionMatrix, -rotation);\r\n    translateTransform(projectionMatrix, -(center[0] - this.origin[0]), -(center[1] - this.origin[1]));\r\n\r\n    const offsetScaleMatrix = resetTransform(this.offsetScaleMatrix_);\r\n    scaleTransform(offsetScaleMatrix, 2 / size[0], 2 / size[1]);\r\n\r\n    const offsetRotateMatrix = resetTransform(this.offsetRotateMatrix_);\r\n    if (rotation !== 0) {\r\n      rotateTransform(offsetRotateMatrix, -rotation);\r\n    }\r\n\r\n    gl.uniformMatrix4fv(locations.u_projectionMatrix, false,\r\n      fromTransform(this.tmpMat4_, projectionMatrix));\r\n    gl.uniformMatrix4fv(locations.u_offsetScaleMatrix, false,\r\n      fromTransform(this.tmpMat4_, offsetScaleMatrix));\r\n    gl.uniformMatrix4fv(locations.u_offsetRotateMatrix, false,\r\n      fromTransform(this.tmpMat4_, offsetRotateMatrix));\r\n    gl.uniform1f(locations.u_opacity, opacity);\r\n\r\n    // draw!\r\n    let result;\r\n    if (featureCallback === undefined) {\r\n      this.drawReplay(gl, context, skippedFeaturesHash, false);\r\n    } else {\r\n      // draw feature by feature for the hit-detection\r\n      result = this.drawHitDetectionReplay(gl, context, skippedFeaturesHash,\r\n        featureCallback, oneByOne, opt_hitExtent);\r\n    }\r\n\r\n    // disable the vertex attrib arrays\r\n    this.shutDownProgram(gl, locations);\r\n\r\n    if (this.lineStringReplay) {\r\n      if (!tmpStencil) {\r\n        gl.disable(gl.STENCIL_TEST);\r\n      }\r\n      gl.clear(gl.STENCIL_BUFFER_BIT);\r\n      gl.stencilFunc(/** @type {number} */ (tmpStencilFunc),\r\n        /** @type {number} */ (tmpStencilRef), /** @type {number} */ (tmpStencilMaskVal));\r\n      gl.stencilMask(/** @type {number} */ (tmpStencilMask));\r\n      gl.stencilOp(/** @type {number} */ (tmpStencilOpFail),\r\n        /** @type {number} */ (tmpStencilOpZFail), /** @type {number} */ (tmpStencilOpPass));\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * @protected\r\n   * @param {WebGLRenderingContext} gl gl.\r\n   * @param {module:ol/webgl/Context} context Context.\r\n   * @param {number} start Start index.\r\n   * @param {number} end End index.\r\n   */\r\n  drawElements(gl, context, start, end) {\r\n    const elementType = context.hasOESElementIndexUint ?\r\n      UNSIGNED_INT : UNSIGNED_SHORT;\r\n    const elementSize = context.hasOESElementIndexUint ? 4 : 2;\r\n\r\n    const numItems = end - start;\r\n    const offsetInBytes = start * elementSize;\r\n    gl.drawElements(TRIANGLES, numItems, elementType, offsetInBytes);\r\n  }\r\n}\r\n\r\n\r\nexport default WebGLReplay;\r\n"],"names":["super","const","let"],"mappings":"AAAA;;;;AAIA,QAAQ,SAAS,OAAO,iBAAiB,CAAC;AAC1C,OAAO,aAAa,MAAM,qBAAqB,CAAC;AAChD;EACE,MAAM,IAAI,eAAe;EACzB,KAAK,IAAI,cAAc;EACvB,MAAM,IAAI,eAAe;EACzB,KAAK,IAAI,cAAc;EACvB,SAAS,IAAI,kBAAkB;OAC1B,oBAAoB,CAAC;AAC5B,QAAQ,MAAM,EAAE,aAAa,OAAO,mBAAmB,CAAC;AACxD,QAAQ,YAAY,EAAE,oBAAoB,EAAE,SAAS;EACnD,YAAY,EAAE,cAAc,OAAO,gBAAgB,CAAC;;AAEtD,IAAM,WAAW,GAAsB;EAKrC,oBAAW,CAAC,SAAS,EAAE,SAAS,EAAE;IAChCA,kBAAK,KAAC,CAAC,CAAC;;;;;;IAMR,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;;;;;;;IAO3B,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;;;;;;;;;;IAU3B,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC,SAAS,CAAC,CAAC;;;;;;IAMnC,IAAI,CAAC,iBAAiB,GAAG,eAAe,EAAE,CAAC;;;;;;IAM3C,IAAI,CAAC,mBAAmB,GAAG,eAAe,EAAE,CAAC;;;;;;IAM7C,IAAI,CAAC,kBAAkB,GAAG,eAAe,EAAE,CAAC;;;;;;IAM5C,IAAI,CAAC,QAAQ,GAAG,MAAM,EAAE,CAAC;;;;;;IAMzB,IAAI,CAAC,OAAO,GAAG,EAAE,CAAC;;;;;;IAMlB,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;;;;;;;IAO1B,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;;;;;;;IAOvB,IAAI,CAAC,mBAAmB,GAAG,EAAE,CAAC;;;;;;IAM9B,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;;;;;;IAMnB,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;;;;;;;IAO3B,IAAI,CAAC,gBAAgB,GAAG,SAAS,CAAC;;;;;;kDAEnC;;;;;;;wBAOD,iEAA0B,CAAC,OAAO,EAAE,GAAE;;;;;;wBAMtC,yBAAM,CAAC,OAAO,EAAE,GAAE;;;;;;;;;;;;;;wBAclB,qCAAY,CAAC,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,UAAU,EAAE,GAAE;;;;;;;;;;;wBAW9C,2CAAe,CAAC,EAAE,EAAE,SAAS,EAAE,GAAE;;;;;;;;;;wBAUjC,iCAAU,CAAC,EAAE,EAAE,OAAO,EAAE,mBAAmB,EAAE,YAAY,EAAE,GAAE;;;;;;;;;;;;;wBAa7D,yEAA8B,CAAC,EAAE,EAAE,OAAO,EAAE,mBAAmB,EAAE,eAAe,EAAE,aAAa,EAAE,GAAE;;;;;;;;;;;;;wBAanG,yDAAsB,CAAC,EAAE,EAAE,OAAO,EAAE,mBAAmB,EAAE,eAAe,EAAE,QAAQ,EAAE,aAAa,EAAE;IACjG,IAAI,CAAC,QAAQ,EAAE;;MAEb,OAAO,IAAI,CAAC,yBAAyB,CAAC,EAAE,EAAE,OAAO;QAC/C,mBAAmB,EAAE,eAAe,CAAC,CAAC;KACzC,MAAM;;MAEL,OAAO,IAAI,CAAC,8BAA8B,CAAC,EAAE,EAAE,OAAO;QACpD,mBAAmB,EAAE,eAAe,EAAE,aAAa,CAAC,CAAC;KACxD;IACF;;;;;;;;;;;wBAWD,+DAAyB,CAAC,EAAE,EAAE,OAAO,EAAE,mBAAmB,EAAE,eAAe,EAAE;IAC3E,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,gBAAgB,GAAG,EAAE,CAAC,gBAAgB,CAAC,CAAC;IACpD,IAAI,CAAC,UAAU,CAAC,EAAE,EAAE,OAAO,EAAE,mBAAmB,EAAE,IAAI,CAAC,CAAC;;IAExDC,GAAK,CAAC,MAAM,GAAG,eAAe,CAAC,IAAI,CAAC,CAAC;IACrC,IAAI,MAAM,EAAE;MACV,OAAO,MAAM,CAAC;KACf,MAAM;MACL,OAAO,SAAS,CAAC;KAClB;IACF;;;;;;;;;;;;;;;;;wBAiBD,yBAAM;IACJ,OAAO;IACP,MAAM;IACN,UAAU;IACV,QAAQ;IACR,IAAI;IACJ,UAAU;IACV,OAAO;IACP,mBAAmB;IACnB,eAAe;IACf,QAAQ;IACR,aAAa;IACb;IACAA,GAAK,CAAC,EAAE,GAAG,OAAO,CAAC,KAAK,EAAE,CAAC;IAC3BC,GAAG,CAAC,UAAU,EAAE,cAAc,EAAE,iBAAiB,EAAE,aAAa,EAAE,cAAc;QAC5E,gBAAgB,EAAE,gBAAgB,EAAE,iBAAiB,CAAC;;IAE1D,IAAI,IAAI,CAAC,gBAAgB,EAAE;MACzB,UAAU,GAAG,EAAE,CAAC,SAAS,CAAC,EAAE,CAAC,YAAY,CAAC,CAAC;MAC3C,cAAc,GAAG,EAAE,CAAC,YAAY,CAAC,EAAE,CAAC,YAAY,CAAC,CAAC;MAClD,iBAAiB,GAAG,EAAE,CAAC,YAAY,CAAC,EAAE,CAAC,kBAAkB,CAAC,CAAC;MAC3D,aAAa,GAAG,EAAE,CAAC,YAAY,CAAC,EAAE,CAAC,WAAW,CAAC,CAAC;MAChD,cAAc,GAAG,EAAE,CAAC,YAAY,CAAC,EAAE,CAAC,iBAAiB,CAAC,CAAC;MACvD,gBAAgB,GAAG,EAAE,CAAC,YAAY,CAAC,EAAE,CAAC,YAAY,CAAC,CAAC;MACpD,gBAAgB,GAAG,EAAE,CAAC,YAAY,CAAC,EAAE,CAAC,uBAAuB,CAAC,CAAC;MAC/D,iBAAiB,GAAG,EAAE,CAAC,YAAY,CAAC,EAAE,CAAC,uBAAuB,CAAC,CAAC;;MAEhE,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,YAAY,CAAC,CAAC;MAC3B,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,kBAAkB,CAAC,CAAC;MAChC,EAAE,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;MACpB,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC,MAAM,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC;MAClC,EAAE,CAAC,SAAS,CAAC,EAAE,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,EAAE,EAAE,CAAC,OAAO,CAAC,CAAC;;MAE3C,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,OAAO;QAClC,MAAM,EAAE,UAAU,EAAE,QAAQ,EAAE,IAAI,EAAE,UAAU;QAC9C,OAAO,EAAE,mBAAmB;QAC5B,eAAe,EAAE,QAAQ,EAAE,aAAa,CAAC,CAAC;;MAE5C,EAAE,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;MAClB,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC,QAAQ,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC;KACrC;;IAED,OAAO,CAAC,UAAU,CAAC,YAAY,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;;IAEtD,OAAO,CAAC,UAAU,CAAC,oBAAoB,EAAE,IAAI,CAAC,aAAa,CAAC,CAAC;;IAE7DD,GAAK,CAAC,SAAS,GAAG,IAAI,CAAC,YAAY,CAAC,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,UAAU,CAAC,CAAC;;;IAGnEA,GAAK,CAAC,gBAAgB,GAAG,cAAc,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;IAChE,cAAc,CAAC,gBAAgB,EAAE,CAAC,GAAG,CAAC,UAAU,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,UAAU,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACzF,eAAe,CAAC,gBAAgB,EAAE,CAAC,QAAQ,CAAC,CAAC;IAC7C,kBAAkB,CAAC,gBAAgB,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;;IAEnGA,GAAK,CAAC,iBAAiB,GAAG,cAAc,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;IAClE,cAAc,CAAC,iBAAiB,EAAE,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;;IAE5DA,GAAK,CAAC,kBAAkB,GAAG,cAAc,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;IACpE,IAAI,QAAQ,KAAK,CAAC,EAAE;MAClB,eAAe,CAAC,kBAAkB,EAAE,CAAC,QAAQ,CAAC,CAAC;KAChD;;IAED,EAAE,CAAC,gBAAgB,CAAC,SAAS,CAAC,kBAAkB,EAAE,KAAK;MACrD,aAAa,CAAC,IAAI,CAAC,QAAQ,EAAE,gBAAgB,CAAC,CAAC,CAAC;IAClD,EAAE,CAAC,gBAAgB,CAAC,SAAS,CAAC,mBAAmB,EAAE,KAAK;MACtD,aAAa,CAAC,IAAI,CAAC,QAAQ,EAAE,iBAAiB,CAAC,CAAC,CAAC;IACnD,EAAE,CAAC,gBAAgB,CAAC,SAAS,CAAC,oBAAoB,EAAE,KAAK;MACvD,aAAa,CAAC,IAAI,CAAC,QAAQ,EAAE,kBAAkB,CAAC,CAAC,CAAC;IACpD,EAAE,CAAC,SAAS,CAAC,SAAS,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;;;IAG3CC,GAAG,CAAC,MAAM,CAAC;IACX,IAAI,eAAe,KAAK,SAAS,EAAE;MACjC,IAAI,CAAC,UAAU,CAAC,EAAE,EAAE,OAAO,EAAE,mBAAmB,EAAE,KAAK,CAAC,CAAC;KAC1D,MAAM;;MAEL,MAAM,GAAG,IAAI,CAAC,sBAAsB,CAAC,EAAE,EAAE,OAAO,EAAE,mBAAmB;QACnE,eAAe,EAAE,QAAQ,EAAE,aAAa,CAAC,CAAC;KAC7C;;;IAGD,IAAI,CAAC,eAAe,CAAC,EAAE,EAAE,SAAS,CAAC,CAAC;;IAEpC,IAAI,IAAI,CAAC,gBAAgB,EAAE;MACzB,IAAI,CAAC,UAAU,EAAE;QACf,EAAE,CAAC,OAAO,CAAC,EAAE,CAAC,YAAY,CAAC,CAAC;OAC7B;MACD,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,kBAAkB,CAAC,CAAC;MAChC,EAAE,CAAC,WAAW,uBAAuB,CAAC,cAAc,CAAC;8BAC7B,CAAC,aAAa,CAAC,wBAAwB,CAAC,iBAAiB,CAAC,CAAC,CAAC;MACpF,EAAE,CAAC,WAAW,uBAAuB,CAAC,cAAc,CAAC,CAAC,CAAC;MACvD,EAAE,CAAC,SAAS,uBAAuB,CAAC,gBAAgB,CAAC;8BAC7B,CAAC,iBAAiB,CAAC,wBAAwB,CAAC,gBAAgB,CAAC,CAAC,CAAC;KACxF;;IAED,OAAO,MAAM,CAAC;IACf;;;;;;;;;wBASD,qCAAY,CAAC,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,EAAE;IACpCD,GAAK,CAAC,WAAW,GAAG,OAAO,CAAC,sBAAsB;MAChD,YAAY,GAAG,cAAc,CAAC;IAChCA,GAAK,CAAC,WAAW,GAAG,OAAO,CAAC,sBAAsB,GAAG,CAAC,GAAG,CAAC,CAAC;;IAE3DA,GAAK,CAAC,QAAQ,GAAG,GAAG,GAAG,KAAK,CAAC;IAC7BA,GAAK,CAAC,aAAa,GAAG,KAAK,GAAG,WAAW,CAAC;IAC1C,EAAE,CAAC,YAAY,CAAC,SAAS,EAAE,QAAQ,EAAE,WAAW,EAAE,aAAa,CAAC,CAAC;GAClE;;;EA/UuB,gBAgVzB;;;AAGD,eAAe,WAAW,CAAC;"}