{"version":3,"file":"TextureReplay.js","sources":["../../../../src/ol/render/webgl/TextureReplay.js"],"sourcesContent":["/**\r\n * @module ol/render/webgl/TextureReplay\r\n */\r\nimport {getUid} from '../../util.js';\r\nimport {intersects} from '../../extent.js';\r\nimport {isEmpty} from '../../obj.js';\r\nimport {fragment, vertex} from '../webgl/texturereplay/defaultshader.js';\r\nimport Locations from '../webgl/texturereplay/defaultshader/Locations.js';\r\nimport WebGLReplay from '../webgl/Replay.js';\r\nimport {CLAMP_TO_EDGE, FLOAT, TEXTURE_2D} from '../../webgl.js';\r\nimport {createTexture} from '../../webgl/Context.js';\r\n\r\nclass WebGLTextureReplay extends WebGLReplay {\r\n  /**\r\n   * @param {number} tolerance Tolerance.\r\n   * @param {module:ol/extent~Extent} maxExtent Max extent.\r\n   */\r\n  constructor(tolerance, maxExtent) {\r\n    super(tolerance, maxExtent);\r\n\r\n    /**\r\n     * @type {number|undefined}\r\n     * @protected\r\n     */\r\n    this.anchorX = undefined;\r\n\r\n    /**\r\n     * @type {number|undefined}\r\n     * @protected\r\n     */\r\n    this.anchorY = undefined;\r\n\r\n    /**\r\n     * @type {Array.<number>}\r\n     * @protected\r\n     */\r\n    this.groupIndices = [];\r\n\r\n    /**\r\n     * @type {Array.<number>}\r\n     * @protected\r\n     */\r\n    this.hitDetectionGroupIndices = [];\r\n\r\n    /**\r\n     * @type {number|undefined}\r\n     * @protected\r\n     */\r\n    this.height = undefined;\r\n\r\n    /**\r\n     * @type {number|undefined}\r\n     * @protected\r\n     */\r\n    this.imageHeight = undefined;\r\n\r\n    /**\r\n     * @type {number|undefined}\r\n     * @protected\r\n     */\r\n    this.imageWidth = undefined;\r\n\r\n    /**\r\n     * @protected\r\n     * @type {module:ol/render/webgl/texturereplay/defaultshader/Locations}\r\n     */\r\n    this.defaultLocations = null;\r\n\r\n    /**\r\n     * @protected\r\n     * @type {number|undefined}\r\n     */\r\n    this.opacity = undefined;\r\n\r\n    /**\r\n     * @type {number|undefined}\r\n     * @protected\r\n     */\r\n    this.originX = undefined;\r\n\r\n    /**\r\n     * @type {number|undefined}\r\n     * @protected\r\n     */\r\n    this.originY = undefined;\r\n\r\n    /**\r\n     * @protected\r\n     * @type {boolean|undefined}\r\n     */\r\n    this.rotateWithView = undefined;\r\n\r\n    /**\r\n     * @protected\r\n     * @type {number|undefined}\r\n     */\r\n    this.rotation = undefined;\r\n\r\n    /**\r\n     * @protected\r\n     * @type {number|undefined}\r\n     */\r\n    this.scale = undefined;\r\n\r\n    /**\r\n     * @type {number|undefined}\r\n     * @protected\r\n     */\r\n    this.width = undefined;\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  getDeleteResourcesFunction(context) {\r\n    const verticesBuffer = this.verticesBuffer;\r\n    const indicesBuffer = this.indicesBuffer;\r\n    const textures = this.getTextures(true);\r\n    const gl = context.getGL();\r\n    return function() {\r\n      if (!gl.isContextLost()) {\r\n        let i, ii;\r\n        for (i = 0, ii = textures.length; i < ii; ++i) {\r\n          gl.deleteTexture(textures[i]);\r\n        }\r\n      }\r\n      context.deleteBuffer(verticesBuffer);\r\n      context.deleteBuffer(indicesBuffer);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @param {Array.<number>} flatCoordinates Flat coordinates.\r\n   * @param {number} offset Offset.\r\n   * @param {number} end End.\r\n   * @param {number} stride Stride.\r\n   * @return {number} My end.\r\n   * @protected\r\n   */\r\n  drawCoordinates(flatCoordinates, offset, end, stride) {\r\n    const anchorX = /** @type {number} */ (this.anchorX);\r\n    const anchorY = /** @type {number} */ (this.anchorY);\r\n    const height = /** @type {number} */ (this.height);\r\n    const imageHeight = /** @type {number} */ (this.imageHeight);\r\n    const imageWidth = /** @type {number} */ (this.imageWidth);\r\n    const opacity = /** @type {number} */ (this.opacity);\r\n    const originX = /** @type {number} */ (this.originX);\r\n    const originY = /** @type {number} */ (this.originY);\r\n    const rotateWithView = this.rotateWithView ? 1.0 : 0.0;\r\n    // this.rotation_ is anti-clockwise, but rotation is clockwise\r\n    const rotation = /** @type {number} */ (-this.rotation);\r\n    const scale = /** @type {number} */ (this.scale);\r\n    const width = /** @type {number} */ (this.width);\r\n    const cos = Math.cos(rotation);\r\n    const sin = Math.sin(rotation);\r\n    let numIndices = this.indices.length;\r\n    let numVertices = this.vertices.length;\r\n    let i, n, offsetX, offsetY, x, y;\r\n    for (i = offset; i < end; i += stride) {\r\n      x = flatCoordinates[i] - this.origin[0];\r\n      y = flatCoordinates[i + 1] - this.origin[1];\r\n\r\n      // There are 4 vertices per [x, y] point, one for each corner of the\r\n      // rectangle we're going to draw. We'd use 1 vertex per [x, y] point if\r\n      // WebGL supported Geometry Shaders (which can emit new vertices), but that\r\n      // is not currently the case.\r\n      //\r\n      // And each vertex includes 8 values: the x and y coordinates, the x and\r\n      // y offsets used to calculate the position of the corner, the u and\r\n      // v texture coordinates for the corner, the opacity, and whether the\r\n      // the image should be rotated with the view (rotateWithView).\r\n\r\n      n = numVertices / 8;\r\n\r\n      // bottom-left corner\r\n      offsetX = -scale * anchorX;\r\n      offsetY = -scale * (height - anchorY);\r\n      this.vertices[numVertices++] = x;\r\n      this.vertices[numVertices++] = y;\r\n      this.vertices[numVertices++] = offsetX * cos - offsetY * sin;\r\n      this.vertices[numVertices++] = offsetX * sin + offsetY * cos;\r\n      this.vertices[numVertices++] = originX / imageWidth;\r\n      this.vertices[numVertices++] = (originY + height) / imageHeight;\r\n      this.vertices[numVertices++] = opacity;\r\n      this.vertices[numVertices++] = rotateWithView;\r\n\r\n      // bottom-right corner\r\n      offsetX = scale * (width - anchorX);\r\n      offsetY = -scale * (height - anchorY);\r\n      this.vertices[numVertices++] = x;\r\n      this.vertices[numVertices++] = y;\r\n      this.vertices[numVertices++] = offsetX * cos - offsetY * sin;\r\n      this.vertices[numVertices++] = offsetX * sin + offsetY * cos;\r\n      this.vertices[numVertices++] = (originX + width) / imageWidth;\r\n      this.vertices[numVertices++] = (originY + height) / imageHeight;\r\n      this.vertices[numVertices++] = opacity;\r\n      this.vertices[numVertices++] = rotateWithView;\r\n\r\n      // top-right corner\r\n      offsetX = scale * (width - anchorX);\r\n      offsetY = scale * anchorY;\r\n      this.vertices[numVertices++] = x;\r\n      this.vertices[numVertices++] = y;\r\n      this.vertices[numVertices++] = offsetX * cos - offsetY * sin;\r\n      this.vertices[numVertices++] = offsetX * sin + offsetY * cos;\r\n      this.vertices[numVertices++] = (originX + width) / imageWidth;\r\n      this.vertices[numVertices++] = originY / imageHeight;\r\n      this.vertices[numVertices++] = opacity;\r\n      this.vertices[numVertices++] = rotateWithView;\r\n\r\n      // top-left corner\r\n      offsetX = -scale * anchorX;\r\n      offsetY = scale * anchorY;\r\n      this.vertices[numVertices++] = x;\r\n      this.vertices[numVertices++] = y;\r\n      this.vertices[numVertices++] = offsetX * cos - offsetY * sin;\r\n      this.vertices[numVertices++] = offsetX * sin + offsetY * cos;\r\n      this.vertices[numVertices++] = originX / imageWidth;\r\n      this.vertices[numVertices++] = originY / imageHeight;\r\n      this.vertices[numVertices++] = opacity;\r\n      this.vertices[numVertices++] = rotateWithView;\r\n\r\n      this.indices[numIndices++] = n;\r\n      this.indices[numIndices++] = n + 1;\r\n      this.indices[numIndices++] = n + 2;\r\n      this.indices[numIndices++] = n;\r\n      this.indices[numIndices++] = n + 2;\r\n      this.indices[numIndices++] = n + 3;\r\n    }\r\n\r\n    return numVertices;\r\n  }\r\n\r\n  /**\r\n   * @protected\r\n   * @param {Array.<WebGLTexture>} textures Textures.\r\n   * @param {Array.<HTMLCanvasElement|HTMLImageElement|HTMLVideoElement>} images Images.\r\n   * @param {!Object.<string, WebGLTexture>} texturePerImage Texture cache.\r\n   * @param {WebGLRenderingContext} gl Gl.\r\n   */\r\n  createTextures(textures, images, texturePerImage, gl) {\r\n    let texture, image, uid, i;\r\n    const ii = images.length;\r\n    for (i = 0; i < ii; ++i) {\r\n      image = images[i];\r\n\r\n      uid = getUid(image).toString();\r\n      if (uid in texturePerImage) {\r\n        texture = texturePerImage[uid];\r\n      } else {\r\n        texture = createTexture(\r\n          gl, image, CLAMP_TO_EDGE, CLAMP_TO_EDGE);\r\n        texturePerImage[uid] = texture;\r\n      }\r\n      textures[i] = texture;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  setUpProgram(gl, context, size, pixelRatio) {\r\n    // get the program\r\n    const program = context.getProgram(fragment, vertex);\r\n\r\n    // get the locations\r\n    let locations;\r\n    if (!this.defaultLocations) {\r\n      locations = new Locations(gl, program);\r\n      this.defaultLocations = locations;\r\n    } else {\r\n      locations = this.defaultLocations;\r\n    }\r\n\r\n    // use the program (FIXME: use the return value)\r\n    context.useProgram(program);\r\n\r\n    // enable the vertex attrib arrays\r\n    gl.enableVertexAttribArray(locations.a_position);\r\n    gl.vertexAttribPointer(locations.a_position, 2, FLOAT,\r\n      false, 32, 0);\r\n\r\n    gl.enableVertexAttribArray(locations.a_offsets);\r\n    gl.vertexAttribPointer(locations.a_offsets, 2, FLOAT,\r\n      false, 32, 8);\r\n\r\n    gl.enableVertexAttribArray(locations.a_texCoord);\r\n    gl.vertexAttribPointer(locations.a_texCoord, 2, FLOAT,\r\n      false, 32, 16);\r\n\r\n    gl.enableVertexAttribArray(locations.a_opacity);\r\n    gl.vertexAttribPointer(locations.a_opacity, 1, FLOAT,\r\n      false, 32, 24);\r\n\r\n    gl.enableVertexAttribArray(locations.a_rotateWithView);\r\n    gl.vertexAttribPointer(locations.a_rotateWithView, 1, FLOAT,\r\n      false, 32, 28);\r\n\r\n    return locations;\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  shutDownProgram(gl, locations) {\r\n    gl.disableVertexAttribArray(locations.a_position);\r\n    gl.disableVertexAttribArray(locations.a_offsets);\r\n    gl.disableVertexAttribArray(locations.a_texCoord);\r\n    gl.disableVertexAttribArray(locations.a_opacity);\r\n    gl.disableVertexAttribArray(locations.a_rotateWithView);\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  drawReplay(gl, context, skippedFeaturesHash, hitDetection) {\r\n    const textures = hitDetection ? this.getHitDetectionTextures() : this.getTextures();\r\n    const groupIndices = hitDetection ? this.hitDetectionGroupIndices : this.groupIndices;\r\n\r\n    if (!isEmpty(skippedFeaturesHash)) {\r\n      this.drawReplaySkipping(gl, context, skippedFeaturesHash, textures, groupIndices);\r\n    } else {\r\n      let i, ii, start;\r\n      for (i = 0, ii = textures.length, start = 0; i < ii; ++i) {\r\n        gl.bindTexture(TEXTURE_2D, textures[i]);\r\n        const end = groupIndices[i];\r\n        this.drawElements(gl, context, start, end);\r\n        start = end;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Draw the replay while paying attention to skipped features.\r\n   *\r\n   * This functions creates groups of features that can be drawn to together,\r\n   * so that the number of `drawElements` calls is minimized.\r\n   *\r\n   * For example given the following texture groups:\r\n   *\r\n   *    Group 1: A B C\r\n   *    Group 2: D [E] F G\r\n   *\r\n   * If feature E should be skipped, the following `drawElements` calls will be\r\n   * made:\r\n   *\r\n   *    drawElements with feature A, B and C\r\n   *    drawElements with feature D\r\n   *    drawElements with feature F and G\r\n   *\r\n   * @protected\r\n   * @param {WebGLRenderingContext} gl gl.\r\n   * @param {module:ol/webgl/Context} context Context.\r\n   * @param {Object.<string, boolean>} skippedFeaturesHash Ids of features\r\n   *  to skip.\r\n   * @param {Array.<WebGLTexture>} textures Textures.\r\n   * @param {Array.<number>} groupIndices Texture group indices.\r\n   */\r\n  drawReplaySkipping(gl, context, skippedFeaturesHash, textures, groupIndices) {\r\n    let featureIndex = 0;\r\n\r\n    let i, ii;\r\n    for (i = 0, ii = textures.length; i < ii; ++i) {\r\n      gl.bindTexture(TEXTURE_2D, textures[i]);\r\n      const groupStart = (i > 0) ? groupIndices[i - 1] : 0;\r\n      const groupEnd = groupIndices[i];\r\n\r\n      let start = groupStart;\r\n      let end = groupStart;\r\n      while (featureIndex < this.startIndices.length &&\r\n          this.startIndices[featureIndex] <= groupEnd) {\r\n        const feature = this.startIndicesFeature[featureIndex];\r\n\r\n        const featureUid = getUid(feature).toString();\r\n        if (skippedFeaturesHash[featureUid] !== undefined) {\r\n          // feature should be skipped\r\n          if (start !== end) {\r\n            // draw the features so far\r\n            this.drawElements(gl, context, start, end);\r\n          }\r\n          // continue with the next feature\r\n          start = (featureIndex === this.startIndices.length - 1) ?\r\n            groupEnd : this.startIndices[featureIndex + 1];\r\n          end = start;\r\n        } else {\r\n          // the feature is not skipped, augment the end index\r\n          end = (featureIndex === this.startIndices.length - 1) ?\r\n            groupEnd : this.startIndices[featureIndex + 1];\r\n        }\r\n        featureIndex++;\r\n      }\r\n\r\n      if (start !== end) {\r\n        // draw the remaining features (in case there was no skipped feature\r\n        // in this texture group, all features of a group are drawn together)\r\n        this.drawElements(gl, context, start, end);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  drawHitDetectionReplayOneByOne(gl, context, skippedFeaturesHash, featureCallback, opt_hitExtent) {\r\n    let i, groupStart, start, end, feature, featureUid;\r\n    let featureIndex = this.startIndices.length - 1;\r\n    const hitDetectionTextures = this.getHitDetectionTextures();\r\n    for (i = hitDetectionTextures.length - 1; i >= 0; --i) {\r\n      gl.bindTexture(TEXTURE_2D, hitDetectionTextures[i]);\r\n      groupStart = (i > 0) ? this.hitDetectionGroupIndices[i - 1] : 0;\r\n      end = this.hitDetectionGroupIndices[i];\r\n\r\n      // draw all features for this texture group\r\n      while (featureIndex >= 0 &&\r\n          this.startIndices[featureIndex] >= groupStart) {\r\n        start = this.startIndices[featureIndex];\r\n        feature = this.startIndicesFeature[featureIndex];\r\n        featureUid = getUid(feature).toString();\r\n\r\n        if (skippedFeaturesHash[featureUid] === undefined &&\r\n            feature.getGeometry() &&\r\n            (opt_hitExtent === undefined || intersects(\r\n              /** @type {Array<number>} */ (opt_hitExtent),\r\n              feature.getGeometry().getExtent()))) {\r\n          gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n          this.drawElements(gl, context, start, end);\r\n\r\n          const result = featureCallback(feature);\r\n          if (result) {\r\n            return result;\r\n          }\r\n        }\r\n\r\n        end = start;\r\n        featureIndex--;\r\n      }\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  finish(context) {\r\n    this.anchorX = undefined;\r\n    this.anchorY = undefined;\r\n    this.height = undefined;\r\n    this.imageHeight = undefined;\r\n    this.imageWidth = undefined;\r\n    this.indices = null;\r\n    this.opacity = undefined;\r\n    this.originX = undefined;\r\n    this.originY = undefined;\r\n    this.rotateWithView = undefined;\r\n    this.rotation = undefined;\r\n    this.scale = undefined;\r\n    this.vertices = null;\r\n    this.width = undefined;\r\n  }\r\n\r\n  /**\r\n   * @abstract\r\n   * @protected\r\n   * @param {boolean=} opt_all Return hit detection textures with regular ones.\r\n   * @returns {Array.<WebGLTexture>} Textures.\r\n   */\r\n  getTextures(opt_all) {}\r\n\r\n  /**\r\n   * @abstract\r\n   * @protected\r\n   * @returns {Array.<WebGLTexture>} Textures.\r\n   */\r\n  getHitDetectionTextures() {}\r\n}\r\n\r\n\r\nexport default WebGLTextureReplay;\r\n"],"names":["super","const","let","this"],"mappings":"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"}