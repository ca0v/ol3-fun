{"version":3,"file":"CircleReplay.js","sources":["../../../../src/ol/render/webgl/CircleReplay.js"],"sourcesContent":["/**\r\n * @module ol/render/webgl/CircleReplay\r\n */\r\nimport {getUid} from '../../util.js';\r\nimport {equals} from '../../array.js';\r\nimport {asArray} from '../../color.js';\r\nimport {intersects} from '../../extent.js';\r\nimport {isEmpty} from '../../obj.js';\r\nimport {translate} from '../../geom/flat/transform.js';\r\nimport {fragment, vertex} from '../webgl/circlereplay/defaultshader.js';\r\nimport Locations from '../webgl/circlereplay/defaultshader/Locations.js';\r\nimport WebGLReplay from '../webgl/Replay.js';\r\nimport {DEFAULT_LINEDASH, DEFAULT_LINEDASHOFFSET, DEFAULT_STROKESTYLE,\r\n  DEFAULT_FILLSTYLE, DEFAULT_LINEWIDTH} from '../webgl.js';\r\nimport {FLOAT} from '../../webgl.js';\r\nimport WebGLBuffer from '../../webgl/Buffer.js';\r\n\r\nclass WebGLCircleReplay extends WebGLReplay {\r\n  /**\r\n   * @param {number} tolerance Tolerance.\r\n   * @param {module:ol/extent~Extent} maxExtent Max extent.\r\n   */\r\n  constructor(tolerance, maxExtent) {\r\n    super(tolerance, maxExtent);\r\n\r\n    /**\r\n     * @private\r\n     * @type {module:ol/render/webgl/circlereplay/defaultshader/Locations}\r\n     */\r\n    this.defaultLocations_ = null;\r\n\r\n    /**\r\n     * @private\r\n     * @type {Array.<Array.<Array.<number>|number>>}\r\n     */\r\n    this.styles_ = [];\r\n\r\n    /**\r\n     * @private\r\n     * @type {Array.<number>}\r\n     */\r\n    this.styleIndices_ = [];\r\n\r\n    /**\r\n     * @private\r\n     * @type {number}\r\n     */\r\n    this.radius_ = 0;\r\n\r\n    /**\r\n     * @private\r\n     * @type {{fillColor: (Array.<number>|null),\r\n     *         strokeColor: (Array.<number>|null),\r\n     *         lineDash: Array.<number>,\r\n     *         lineDashOffset: (number|undefined),\r\n     *         lineWidth: (number|undefined),\r\n     *         changed: boolean}|null}\r\n     */\r\n    this.state_ = {\r\n      fillColor: null,\r\n      strokeColor: null,\r\n      lineDash: null,\r\n      lineDashOffset: undefined,\r\n      lineWidth: undefined,\r\n      changed: false\r\n    };\r\n\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {Array.<number>} flatCoordinates Flat coordinates.\r\n   * @param {number} offset Offset.\r\n   * @param {number} end End.\r\n   * @param {number} stride Stride.\r\n   */\r\n  drawCoordinates_(flatCoordinates, offset, end, stride) {\r\n    let numVertices = this.vertices.length;\r\n    let numIndices = this.indices.length;\r\n    let n = numVertices / 4;\r\n    let i, ii;\r\n    for (i = offset, ii = end; i < ii; i += stride) {\r\n      this.vertices[numVertices++] = flatCoordinates[i];\r\n      this.vertices[numVertices++] = flatCoordinates[i + 1];\r\n      this.vertices[numVertices++] = 0;\r\n      this.vertices[numVertices++] = this.radius_;\r\n\r\n      this.vertices[numVertices++] = flatCoordinates[i];\r\n      this.vertices[numVertices++] = flatCoordinates[i + 1];\r\n      this.vertices[numVertices++] = 1;\r\n      this.vertices[numVertices++] = this.radius_;\r\n\r\n      this.vertices[numVertices++] = flatCoordinates[i];\r\n      this.vertices[numVertices++] = flatCoordinates[i + 1];\r\n      this.vertices[numVertices++] = 2;\r\n      this.vertices[numVertices++] = this.radius_;\r\n\r\n      this.vertices[numVertices++] = flatCoordinates[i];\r\n      this.vertices[numVertices++] = flatCoordinates[i + 1];\r\n      this.vertices[numVertices++] = 3;\r\n      this.vertices[numVertices++] = this.radius_;\r\n\r\n      this.indices[numIndices++] = n;\r\n      this.indices[numIndices++] = n + 1;\r\n      this.indices[numIndices++] = n + 2;\r\n\r\n      this.indices[numIndices++] = n + 2;\r\n      this.indices[numIndices++] = n + 3;\r\n      this.indices[numIndices++] = n;\r\n\r\n      n += 4;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  drawCircle(circleGeometry, feature) {\r\n    const radius = circleGeometry.getRadius();\r\n    const stride = circleGeometry.getStride();\r\n    if (radius) {\r\n      this.startIndices.push(this.indices.length);\r\n      this.startIndicesFeature.push(feature);\r\n      if (this.state_.changed) {\r\n        this.styleIndices_.push(this.indices.length);\r\n        this.state_.changed = false;\r\n      }\r\n\r\n      this.radius_ = radius;\r\n      let flatCoordinates = circleGeometry.getFlatCoordinates();\r\n      flatCoordinates = translate(flatCoordinates, 0, 2,\r\n        stride, -this.origin[0], -this.origin[1]);\r\n      this.drawCoordinates_(flatCoordinates, 0, 2, stride);\r\n    } else {\r\n      if (this.state_.changed) {\r\n        this.styles_.pop();\r\n        if (this.styles_.length) {\r\n          const lastState = this.styles_[this.styles_.length - 1];\r\n          this.state_.fillColor = /** @type {Array.<number>} */ (lastState[0]);\r\n          this.state_.strokeColor = /** @type {Array.<number>} */ (lastState[1]);\r\n          this.state_.lineWidth = /** @type {number} */ (lastState[2]);\r\n          this.state_.changed = false;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   **/\r\n  finish(context) {\r\n    // create, bind, and populate the vertices buffer\r\n    this.verticesBuffer = new WebGLBuffer(this.vertices);\r\n\r\n    // create, bind, and populate the indices buffer\r\n    this.indicesBuffer = new WebGLBuffer(this.indices);\r\n\r\n    this.startIndices.push(this.indices.length);\r\n\r\n    //Clean up, if there is nothing to draw\r\n    if (this.styleIndices_.length === 0 && this.styles_.length > 0) {\r\n      this.styles_ = [];\r\n    }\r\n\r\n    this.vertices = null;\r\n    this.indices = null;\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  getDeleteResourcesFunction(context) {\r\n    // We only delete our stuff here. The shaders and the program may\r\n    // be used by other CircleReplay instances (for other layers). And\r\n    // they will be deleted when disposing of the module:ol/webgl/Context~WebGLContext\r\n    // object.\r\n    const verticesBuffer = this.verticesBuffer;\r\n    const indicesBuffer = this.indicesBuffer;\r\n    return function() {\r\n      context.deleteBuffer(verticesBuffer);\r\n      context.deleteBuffer(indicesBuffer);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  setUpProgram(gl, context, size, pixelRatio) {\r\n    // get the program\r\n    const program = context.getProgram(fragment, vertex);\r\n\r\n    // get the locations\r\n    let locations;\r\n    if (!this.defaultLocations_) {\r\n      locations = new Locations(gl, program);\r\n      this.defaultLocations_ = locations;\r\n    } else {\r\n      locations = this.defaultLocations_;\r\n    }\r\n\r\n    context.useProgram(program);\r\n\r\n    // enable the vertex attrib arrays\r\n    gl.enableVertexAttribArray(locations.a_position);\r\n    gl.vertexAttribPointer(locations.a_position, 2, FLOAT,\r\n      false, 16, 0);\r\n\r\n    gl.enableVertexAttribArray(locations.a_instruction);\r\n    gl.vertexAttribPointer(locations.a_instruction, 1, FLOAT,\r\n      false, 16, 8);\r\n\r\n    gl.enableVertexAttribArray(locations.a_radius);\r\n    gl.vertexAttribPointer(locations.a_radius, 1, FLOAT,\r\n      false, 16, 12);\r\n\r\n    // Enable renderer specific uniforms.\r\n    gl.uniform2fv(locations.u_size, size);\r\n    gl.uniform1f(locations.u_pixelRatio, pixelRatio);\r\n\r\n    return locations;\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  shutDownProgram(gl, locations) {\r\n    gl.disableVertexAttribArray(locations.a_position);\r\n    gl.disableVertexAttribArray(locations.a_instruction);\r\n    gl.disableVertexAttribArray(locations.a_radius);\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  drawReplay(gl, context, skippedFeaturesHash, hitDetection) {\r\n    if (!isEmpty(skippedFeaturesHash)) {\r\n      this.drawReplaySkipping_(gl, context, skippedFeaturesHash);\r\n    } else {\r\n      //Draw by style groups to minimize drawElements() calls.\r\n      let i, start, end, nextStyle;\r\n      end = this.startIndices[this.startIndices.length - 1];\r\n      for (i = this.styleIndices_.length - 1; i >= 0; --i) {\r\n        start = this.styleIndices_[i];\r\n        nextStyle = this.styles_[i];\r\n        this.setFillStyle_(gl, /** @type {Array.<number>} */ (nextStyle[0]));\r\n        this.setStrokeStyle_(gl, /** @type {Array.<number>} */ (nextStyle[1]),\r\n          /** @type {number} */ (nextStyle[2]));\r\n        this.drawElements(gl, context, start, end);\r\n        end = start;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  drawHitDetectionReplayOneByOne(gl, context, skippedFeaturesHash, featureCallback, opt_hitExtent) {\r\n    let i, start, end, nextStyle, groupStart, feature, featureUid, featureIndex;\r\n    featureIndex = this.startIndices.length - 2;\r\n    end = this.startIndices[featureIndex + 1];\r\n    for (i = this.styleIndices_.length - 1; i >= 0; --i) {\r\n      nextStyle = this.styles_[i];\r\n      this.setFillStyle_(gl, /** @type {Array.<number>} */ (nextStyle[0]));\r\n      this.setStrokeStyle_(gl, /** @type {Array.<number>} */ (nextStyle[1]),\r\n        /** @type {number} */ (nextStyle[2]));\r\n      groupStart = this.styleIndices_[i];\r\n\r\n      while (featureIndex >= 0 &&\r\n          this.startIndices[featureIndex] >= groupStart) {\r\n        start = this.startIndices[featureIndex];\r\n        feature = this.startIndicesFeature[featureIndex];\r\n        featureUid = getUid(feature).toString();\r\n\r\n        if (skippedFeaturesHash[featureUid] === undefined &&\r\n            feature.getGeometry() &&\r\n            (opt_hitExtent === undefined || intersects(\r\n              /** @type {Array<number>} */ (opt_hitExtent),\r\n              feature.getGeometry().getExtent()))) {\r\n          gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n          this.drawElements(gl, context, start, end);\r\n\r\n          const result = featureCallback(feature);\r\n\r\n          if (result) {\r\n            return result;\r\n          }\r\n\r\n        }\r\n        featureIndex--;\r\n        end = start;\r\n      }\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {WebGLRenderingContext} gl gl.\r\n   * @param {module:ol/webgl/Context} context Context.\r\n   * @param {Object} skippedFeaturesHash Ids of features to skip.\r\n   */\r\n  drawReplaySkipping_(gl, context, skippedFeaturesHash) {\r\n    let i, start, end, nextStyle, groupStart, feature, featureUid, featureIndex, featureStart;\r\n    featureIndex = this.startIndices.length - 2;\r\n    end = start = this.startIndices[featureIndex + 1];\r\n    for (i = this.styleIndices_.length - 1; i >= 0; --i) {\r\n      nextStyle = this.styles_[i];\r\n      this.setFillStyle_(gl, /** @type {Array.<number>} */ (nextStyle[0]));\r\n      this.setStrokeStyle_(gl, /** @type {Array.<number>} */ (nextStyle[1]),\r\n        /** @type {number} */ (nextStyle[2]));\r\n      groupStart = this.styleIndices_[i];\r\n\r\n      while (featureIndex >= 0 &&\r\n          this.startIndices[featureIndex] >= groupStart) {\r\n        featureStart = this.startIndices[featureIndex];\r\n        feature = this.startIndicesFeature[featureIndex];\r\n        featureUid = getUid(feature).toString();\r\n\r\n        if (skippedFeaturesHash[featureUid]) {\r\n          if (start !== end) {\r\n            this.drawElements(gl, context, start, end);\r\n          }\r\n          end = featureStart;\r\n        }\r\n        featureIndex--;\r\n        start = featureStart;\r\n      }\r\n      if (start !== end) {\r\n        this.drawElements(gl, context, start, end);\r\n      }\r\n      start = end = groupStart;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {WebGLRenderingContext} gl gl.\r\n   * @param {Array.<number>} color Color.\r\n   */\r\n  setFillStyle_(gl, color) {\r\n    gl.uniform4fv(this.defaultLocations_.u_fillColor, color);\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   * @param {WebGLRenderingContext} gl gl.\r\n   * @param {Array.<number>} color Color.\r\n   * @param {number} lineWidth Line width.\r\n   */\r\n  setStrokeStyle_(gl, color, lineWidth) {\r\n    gl.uniform4fv(this.defaultLocations_.u_strokeColor, color);\r\n    gl.uniform1f(this.defaultLocations_.u_lineWidth, lineWidth);\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  setFillStrokeStyle(fillStyle, strokeStyle) {\r\n    let strokeStyleColor, strokeStyleWidth;\r\n    if (strokeStyle) {\r\n      const strokeStyleLineDash = strokeStyle.getLineDash();\r\n      this.state_.lineDash = strokeStyleLineDash ?\r\n        strokeStyleLineDash : DEFAULT_LINEDASH;\r\n      const strokeStyleLineDashOffset = strokeStyle.getLineDashOffset();\r\n      this.state_.lineDashOffset = strokeStyleLineDashOffset ?\r\n        strokeStyleLineDashOffset : DEFAULT_LINEDASHOFFSET;\r\n      strokeStyleColor = strokeStyle.getColor();\r\n      if (!(strokeStyleColor instanceof CanvasGradient) &&\r\n          !(strokeStyleColor instanceof CanvasPattern)) {\r\n        strokeStyleColor = asArray(strokeStyleColor).map(function(c, i) {\r\n          return i != 3 ? c / 255 : c;\r\n        }) || DEFAULT_STROKESTYLE;\r\n      } else {\r\n        strokeStyleColor = DEFAULT_STROKESTYLE;\r\n      }\r\n      strokeStyleWidth = strokeStyle.getWidth();\r\n      strokeStyleWidth = strokeStyleWidth !== undefined ?\r\n        strokeStyleWidth : DEFAULT_LINEWIDTH;\r\n    } else {\r\n      strokeStyleColor = [0, 0, 0, 0];\r\n      strokeStyleWidth = 0;\r\n    }\r\n    let fillStyleColor = fillStyle ? fillStyle.getColor() : [0, 0, 0, 0];\r\n    if (!(fillStyleColor instanceof CanvasGradient) &&\r\n        !(fillStyleColor instanceof CanvasPattern)) {\r\n      fillStyleColor = asArray(fillStyleColor).map(function(c, i) {\r\n        return i != 3 ? c / 255 : c;\r\n      }) || DEFAULT_FILLSTYLE;\r\n    } else {\r\n      fillStyleColor = DEFAULT_FILLSTYLE;\r\n    }\r\n    if (!this.state_.strokeColor || !equals(this.state_.strokeColor, strokeStyleColor) ||\r\n        !this.state_.fillColor || !equals(this.state_.fillColor, fillStyleColor) ||\r\n        this.state_.lineWidth !== strokeStyleWidth) {\r\n      this.state_.changed = true;\r\n      this.state_.fillColor = fillStyleColor;\r\n      this.state_.strokeColor = strokeStyleColor;\r\n      this.state_.lineWidth = strokeStyleWidth;\r\n      this.styles_.push([fillStyleColor, strokeStyleColor, strokeStyleWidth]);\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport default WebGLCircleReplay;\r\n"],"names":["super","let","this","const"],"mappings":"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"}