{"version":3,"file":"DragRotate.js","sources":["../../../src/ol/interaction/DragRotate.js"],"sourcesContent":["/**\r\n * @module ol/interaction/DragRotate\r\n */\r\nimport {disable} from '../rotationconstraint.js';\r\nimport ViewHint from '../ViewHint.js';\r\nimport {altShiftKeysOnly, mouseOnly, mouseActionButton} from '../events/condition.js';\r\nimport {FALSE} from '../functions.js';\r\nimport {rotate, rotateWithoutConstraints} from '../interaction/Interaction.js';\r\nimport PointerInteraction from '../interaction/Pointer.js';\r\n\r\n\r\n/**\r\n * @typedef {Object} Options\r\n * @property {module:ol/events/condition~Condition} [condition] A function that takes an\r\n * {@link module:ol/MapBrowserEvent~MapBrowserEvent} and returns a boolean\r\n * to indicate whether that event should be handled.\r\n * Default is {@link module:ol/events/condition~altShiftKeysOnly}.\r\n * @property {number} [duration=250] Animation duration in milliseconds.\r\n */\r\n\r\n\r\n/**\r\n * @classdesc\r\n * Allows the user to rotate the map by clicking and dragging on the map,\r\n * normally combined with an {@link module:ol/events/condition} that limits\r\n * it to when the alt and shift keys are held down.\r\n *\r\n * This interaction is only supported for mouse devices.\r\n * @api\r\n */\r\nclass DragRotate extends PointerInteraction {\r\n\r\n  /**\r\n   * @param {module:ol/interaction/DragRotate~Options=} opt_options Options.\r\n   */\r\n  constructor(opt_options) {\r\n\r\n    const options = opt_options ? opt_options : {};\r\n\r\n    super({\r\n      handleDownEvent: handleDownEvent,\r\n      handleDragEvent: handleDragEvent,\r\n      handleUpEvent: handleUpEvent,\r\n      stopDown: FALSE\r\n    });\r\n\r\n    /**\r\n     * @private\r\n     * @type {module:ol/events/condition~Condition}\r\n     */\r\n    this.condition_ = options.condition ? options.condition : altShiftKeysOnly;\r\n\r\n    /**\r\n     * @private\r\n     * @type {number|undefined}\r\n     */\r\n    this.lastAngle_ = undefined;\r\n\r\n    /**\r\n     * @private\r\n     * @type {number}\r\n     */\r\n    this.duration_ = options.duration !== undefined ? options.duration : 250;\r\n\r\n  }\r\n\r\n}\r\n\r\n\r\n/**\r\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\r\n * @this {module:ol/interaction/DragRotate}\r\n */\r\nfunction handleDragEvent(mapBrowserEvent) {\r\n  if (!mouseOnly(mapBrowserEvent)) {\r\n    return;\r\n  }\r\n\r\n  const map = mapBrowserEvent.map;\r\n  const view = map.getView();\r\n  if (view.getConstraints().rotation === disable) {\r\n    return;\r\n  }\r\n  const size = map.getSize();\r\n  const offset = mapBrowserEvent.pixel;\r\n  const theta =\r\n      Math.atan2(size[1] / 2 - offset[1], offset[0] - size[0] / 2);\r\n  if (this.lastAngle_ !== undefined) {\r\n    const delta = theta - this.lastAngle_;\r\n    const rotation = view.getRotation();\r\n    rotateWithoutConstraints(view, rotation - delta);\r\n  }\r\n  this.lastAngle_ = theta;\r\n}\r\n\r\n\r\n/**\r\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\r\n * @return {boolean} Stop drag sequence?\r\n * @this {module:ol/interaction/DragRotate}\r\n */\r\nfunction handleUpEvent(mapBrowserEvent) {\r\n  if (!mouseOnly(mapBrowserEvent)) {\r\n    return true;\r\n  }\r\n\r\n  const map = mapBrowserEvent.map;\r\n  const view = map.getView();\r\n  view.setHint(ViewHint.INTERACTING, -1);\r\n  const rotation = view.getRotation();\r\n  rotate(view, rotation, undefined, this.duration_);\r\n  return false;\r\n}\r\n\r\n\r\n/**\r\n * @param {module:ol/MapBrowserPointerEvent} mapBrowserEvent Event.\r\n * @return {boolean} Start drag sequence?\r\n * @this {module:ol/interaction/DragRotate}\r\n */\r\nfunction handleDownEvent(mapBrowserEvent) {\r\n  if (!mouseOnly(mapBrowserEvent)) {\r\n    return false;\r\n  }\r\n\r\n  if (mouseActionButton(mapBrowserEvent) && this.condition_(mapBrowserEvent)) {\r\n    const map = mapBrowserEvent.map;\r\n    map.getView().setHint(ViewHint.INTERACTING, 1);\r\n    this.lastAngle_ = undefined;\r\n    return true;\r\n  } else {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport default DragRotate;\r\n"],"names":["const","super"],"mappings":"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"}