{"version":3,"file":"interiorpoint.js","sources":["../../../../src/ol/geom/flat/interiorpoint.js"],"sourcesContent":["/**\r\n * @module ol/geom/flat/interiorpoint\r\n */\r\nimport {numberSafeCompareFunction} from '../../array.js';\r\nimport {linearRingsContainsXY} from '../flat/contains.js';\r\n\r\n\r\n/**\r\n * Calculates a point that is likely to lie in the interior of the linear rings.\r\n * Inspired by JTS's com.vividsolutions.jts.geom.Geometry#getInteriorPoint.\r\n * @param {Array.<number>} flatCoordinates Flat coordinates.\r\n * @param {number} offset Offset.\r\n * @param {Array.<number>} ends Ends.\r\n * @param {number} stride Stride.\r\n * @param {Array.<number>} flatCenters Flat centers.\r\n * @param {number} flatCentersOffset Flat center offset.\r\n * @param {Array.<number>=} opt_dest Destination.\r\n * @return {Array.<number>} Destination point as XYM coordinate, where M is the\r\n * length of the horizontal intersection that the point belongs to.\r\n */\r\nexport function getInteriorPointOfArray(flatCoordinates, offset,\r\n  ends, stride, flatCenters, flatCentersOffset, opt_dest) {\r\n  let i, ii, x, x1, x2, y1, y2;\r\n  const y = flatCenters[flatCentersOffset + 1];\r\n  /** @type {Array.<number>} */\r\n  const intersections = [];\r\n  // Calculate intersections with the horizontal line\r\n  for (let r = 0, rr = ends.length; r < rr; ++r) {\r\n    const end = ends[r];\r\n    x1 = flatCoordinates[end - stride];\r\n    y1 = flatCoordinates[end - stride + 1];\r\n    for (i = offset; i < end; i += stride) {\r\n      x2 = flatCoordinates[i];\r\n      y2 = flatCoordinates[i + 1];\r\n      if ((y <= y1 && y2 <= y) || (y1 <= y && y <= y2)) {\r\n        x = (y - y1) / (y2 - y1) * (x2 - x1) + x1;\r\n        intersections.push(x);\r\n      }\r\n      x1 = x2;\r\n      y1 = y2;\r\n    }\r\n  }\r\n  // Find the longest segment of the horizontal line that has its center point\r\n  // inside the linear ring.\r\n  let pointX = NaN;\r\n  let maxSegmentLength = -Infinity;\r\n  intersections.sort(numberSafeCompareFunction);\r\n  x1 = intersections[0];\r\n  for (i = 1, ii = intersections.length; i < ii; ++i) {\r\n    x2 = intersections[i];\r\n    const segmentLength = Math.abs(x2 - x1);\r\n    if (segmentLength > maxSegmentLength) {\r\n      x = (x1 + x2) / 2;\r\n      if (linearRingsContainsXY(flatCoordinates, offset, ends, stride, x, y)) {\r\n        pointX = x;\r\n        maxSegmentLength = segmentLength;\r\n      }\r\n    }\r\n    x1 = x2;\r\n  }\r\n  if (isNaN(pointX)) {\r\n    // There is no horizontal line that has its center point inside the linear\r\n    // ring.  Use the center of the the linear ring's extent.\r\n    pointX = flatCenters[flatCentersOffset];\r\n  }\r\n  if (opt_dest) {\r\n    opt_dest.push(pointX, y, maxSegmentLength);\r\n    return opt_dest;\r\n  } else {\r\n    return [pointX, y, maxSegmentLength];\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * @param {Array.<number>} flatCoordinates Flat coordinates.\r\n * @param {number} offset Offset.\r\n * @param {Array.<Array.<number>>} endss Endss.\r\n * @param {number} stride Stride.\r\n * @param {Array.<number>} flatCenters Flat centers.\r\n * @return {Array.<number>} Interior points as XYM coordinates, where M is the\r\n * length of the horizontal intersection that the point belongs to.\r\n */\r\nexport function getInteriorPointsOfMultiArray(flatCoordinates, offset, endss, stride, flatCenters) {\r\n  let interiorPoints = [];\r\n  for (let i = 0, ii = endss.length; i < ii; ++i) {\r\n    const ends = endss[i];\r\n    interiorPoints = getInteriorPointOfArray(flatCoordinates,\r\n      offset, ends, stride, flatCenters, 2 * i, interiorPoints);\r\n    offset = ends[ends.length - 1];\r\n  }\r\n  return interiorPoints;\r\n}\r\n"],"names":["let","const"],"mappings":"AAAA;;;AAGA,QAAQ,yBAAyB,OAAO,gBAAgB,CAAC;AACzD,QAAQ,qBAAqB,OAAO,qBAAqB,CAAC;;;;;;;;;;;;;;;;AAgB1D,OAAO,SAAS,uBAAuB,CAAC,eAAe,EAAE,MAAM;EAC7D,IAAI,EAAE,MAAM,EAAE,WAAW,EAAE,iBAAiB,EAAE,QAAQ,EAAE;EACxDA,GAAG,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC;EAC7BC,GAAK,CAAC,CAAC,GAAG,WAAW,CAAC,iBAAiB,GAAG,CAAC,CAAC,CAAC;;EAE7CA,GAAK,CAAC,aAAa,GAAG,EAAE,CAAC;;EAEzB,KAAKD,GAAG,CAAC,CAAC,GAAG,CAAC,EAAE,EAAE,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,GAAG,EAAE,EAAE,EAAE,CAAC,EAAE;IAC7CC,GAAK,CAAC,GAAG,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;IACpB,EAAE,GAAG,eAAe,CAAC,GAAG,GAAG,MAAM,CAAC,CAAC;IACnC,EAAE,GAAG,eAAe,CAAC,GAAG,GAAG,MAAM,GAAG,CAAC,CAAC,CAAC;IACvC,KAAK,CAAC,GAAG,MAAM,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,IAAI,MAAM,EAAE;MACrC,EAAE,GAAG,eAAe,CAAC,CAAC,CAAC,CAAC;MACxB,EAAE,GAAG,eAAe,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;MAC5B,IAAI,CAAC,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,EAAE;QAChD,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,EAAE,CAAC;QAC1C,aAAa,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;OACvB;MACD,EAAE,GAAG,EAAE,CAAC;MACR,EAAE,GAAG,EAAE,CAAC;KACT;GACF;;;EAGDD,GAAG,CAAC,MAAM,GAAG,GAAG,CAAC;EACjBA,GAAG,CAAC,gBAAgB,GAAG,CAAC,QAAQ,CAAC;EACjC,aAAa,CAAC,IAAI,CAAC,yBAAyB,CAAC,CAAC;EAC9C,EAAE,GAAG,aAAa,CAAC,CAAC,CAAC,CAAC;EACtB,KAAK,CAAC,GAAG,CAAC,EAAE,EAAE,GAAG,aAAa,CAAC,MAAM,EAAE,CAAC,GAAG,EAAE,EAAE,EAAE,CAAC,EAAE;IAClD,EAAE,GAAG,aAAa,CAAC,CAAC,CAAC,CAAC;IACtBC,GAAK,CAAC,aAAa,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC;IACxC,IAAI,aAAa,GAAG,gBAAgB,EAAE;MACpC,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,CAAC,CAAC;MAClB,IAAI,qBAAqB,CAAC,eAAe,EAAE,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE;QACtE,MAAM,GAAG,CAAC,CAAC;QACX,gBAAgB,GAAG,aAAa,CAAC;OAClC;KACF;IACD,EAAE,GAAG,EAAE,CAAC;GACT;EACD,IAAI,KAAK,CAAC,MAAM,CAAC,EAAE;;;IAGjB,MAAM,GAAG,WAAW,CAAC,iBAAiB,CAAC,CAAC;GACzC;EACD,IAAI,QAAQ,EAAE;IACZ,QAAQ,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,gBAAgB,CAAC,CAAC;IAC3C,OAAO,QAAQ,CAAC;GACjB,MAAM;IACL,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,gBAAgB,CAAC,CAAC;GACtC;CACF;;;;;;;;;;;;AAYD,OAAO,SAAS,6BAA6B,CAAC,eAAe,EAAE,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,WAAW,EAAE;EACjGD,GAAG,CAAC,cAAc,GAAG,EAAE,CAAC;EACxB,KAAKA,GAAG,CAAC,CAAC,GAAG,CAAC,EAAE,EAAE,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,GAAG,EAAE,EAAE,EAAE,CAAC,EAAE;IAC9CC,GAAK,CAAC,IAAI,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;IACtB,cAAc,GAAG,uBAAuB,CAAC,eAAe;MACtD,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,WAAW,EAAE,CAAC,GAAG,CAAC,EAAE,cAAc,CAAC,CAAC;IAC5D,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;GAChC;EACD,OAAO,cAAc,CAAC;CACvB;"}