{"version":3,"file":"textpath.js","sources":["../../../../src/ol/geom/flat/textpath.js"],"sourcesContent":["/**\r\n * @module ol/geom/flat/textpath\r\n */\r\nimport {lerp} from '../../math.js';\r\n\r\n\r\n/**\r\n * @param {Array.<number>} flatCoordinates Path to put text on.\r\n * @param {number} offset Start offset of the `flatCoordinates`.\r\n * @param {number} end End offset of the `flatCoordinates`.\r\n * @param {number} stride Stride.\r\n * @param {string} text Text to place on the path.\r\n * @param {function(string):number} measure Measure function returning the\r\n * width of the character passed as 1st argument.\r\n * @param {number} startM m along the path where the text starts.\r\n * @param {number} maxAngle Max angle between adjacent chars in radians.\r\n * @return {Array.<Array.<*>>} The result array of null if `maxAngle` was\r\n * exceeded. Entries of the array are x, y, anchorX, angle, chunk.\r\n */\r\nexport function drawTextOnPath(\r\n  flatCoordinates, offset, end, stride, text, measure, startM, maxAngle) {\r\n  const result = [];\r\n\r\n  // Keep text upright\r\n  const reverse = flatCoordinates[offset] > flatCoordinates[end - stride];\r\n\r\n  const numChars = text.length;\r\n\r\n  let x1 = flatCoordinates[offset];\r\n  let y1 = flatCoordinates[offset + 1];\r\n  offset += stride;\r\n  let x2 = flatCoordinates[offset];\r\n  let y2 = flatCoordinates[offset + 1];\r\n  let segmentM = 0;\r\n  let segmentLength = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\r\n\r\n  let chunk = '';\r\n  let chunkLength = 0;\r\n  let data, index, previousAngle;\r\n  for (let i = 0; i < numChars; ++i) {\r\n    index = reverse ? numChars - i - 1 : i;\r\n    const char = text.charAt(index);\r\n    chunk = reverse ? char + chunk : chunk + char;\r\n    const charLength = measure(chunk) - chunkLength;\r\n    chunkLength += charLength;\r\n    const charM = startM + charLength / 2;\r\n    while (offset < end - stride && segmentM + segmentLength < charM) {\r\n      x1 = x2;\r\n      y1 = y2;\r\n      offset += stride;\r\n      x2 = flatCoordinates[offset];\r\n      y2 = flatCoordinates[offset + 1];\r\n      segmentM += segmentLength;\r\n      segmentLength = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\r\n    }\r\n    const segmentPos = charM - segmentM;\r\n    let angle = Math.atan2(y2 - y1, x2 - x1);\r\n    if (reverse) {\r\n      angle += angle > 0 ? -Math.PI : Math.PI;\r\n    }\r\n    if (previousAngle !== undefined) {\r\n      let delta = angle - previousAngle;\r\n      delta += (delta > Math.PI) ? -2 * Math.PI : (delta < -Math.PI) ? 2 * Math.PI : 0;\r\n      if (Math.abs(delta) > maxAngle) {\r\n        return null;\r\n      }\r\n    }\r\n    const interpolate = segmentPos / segmentLength;\r\n    const x = lerp(x1, x2, interpolate);\r\n    const y = lerp(y1, y2, interpolate);\r\n    if (previousAngle == angle) {\r\n      if (reverse) {\r\n        data[0] = x;\r\n        data[1] = y;\r\n        data[2] = charLength / 2;\r\n      }\r\n      data[4] = chunk;\r\n    } else {\r\n      chunk = char;\r\n      chunkLength = charLength;\r\n      data = [x, y, charLength / 2, angle, chunk];\r\n      if (reverse) {\r\n        result.unshift(data);\r\n      } else {\r\n        result.push(data);\r\n      }\r\n      previousAngle = angle;\r\n    }\r\n    startM += charLength;\r\n  }\r\n  return result;\r\n}\r\n"],"names":["const","let"],"mappings":"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"}