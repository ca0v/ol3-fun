{"version":3,"file":"interpolate.js","sources":["../../../../src/ol/geom/flat/interpolate.js"],"sourcesContent":["/**\r\n * @module ol/geom/flat/interpolate\r\n */\r\nimport {binarySearch} from '../../array.js';\r\nimport {lerp} from '../../math.js';\r\n\r\n\r\n/**\r\n * @param {Array.<number>} flatCoordinates Flat coordinates.\r\n * @param {number} offset Offset.\r\n * @param {number} end End.\r\n * @param {number} stride Stride.\r\n * @param {number} fraction Fraction.\r\n * @param {Array.<number>=} opt_dest Destination.\r\n * @return {Array.<number>} Destination.\r\n */\r\nexport function interpolatePoint(flatCoordinates, offset, end, stride, fraction, opt_dest) {\r\n  let pointX = NaN;\r\n  let pointY = NaN;\r\n  const n = (end - offset) / stride;\r\n  if (n === 1) {\r\n    pointX = flatCoordinates[offset];\r\n    pointY = flatCoordinates[offset + 1];\r\n  } else if (n == 2) {\r\n    pointX = (1 - fraction) * flatCoordinates[offset] +\r\n        fraction * flatCoordinates[offset + stride];\r\n    pointY = (1 - fraction) * flatCoordinates[offset + 1] +\r\n        fraction * flatCoordinates[offset + stride + 1];\r\n  } else if (n !== 0) {\r\n    let x1 = flatCoordinates[offset];\r\n    let y1 = flatCoordinates[offset + 1];\r\n    let length = 0;\r\n    const cumulativeLengths = [0];\r\n    for (let i = offset + stride; i < end; i += stride) {\r\n      const x2 = flatCoordinates[i];\r\n      const y2 = flatCoordinates[i + 1];\r\n      length += Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\r\n      cumulativeLengths.push(length);\r\n      x1 = x2;\r\n      y1 = y2;\r\n    }\r\n    const target = fraction * length;\r\n    const index = binarySearch(cumulativeLengths, target);\r\n    if (index < 0) {\r\n      const t = (target - cumulativeLengths[-index - 2]) /\r\n          (cumulativeLengths[-index - 1] - cumulativeLengths[-index - 2]);\r\n      const o = offset + (-index - 2) * stride;\r\n      pointX = lerp(\r\n        flatCoordinates[o], flatCoordinates[o + stride], t);\r\n      pointY = lerp(\r\n        flatCoordinates[o + 1], flatCoordinates[o + stride + 1], t);\r\n    } else {\r\n      pointX = flatCoordinates[offset + index * stride];\r\n      pointY = flatCoordinates[offset + index * stride + 1];\r\n    }\r\n  }\r\n  if (opt_dest) {\r\n    opt_dest[0] = pointX;\r\n    opt_dest[1] = pointY;\r\n    return opt_dest;\r\n  } else {\r\n    return [pointX, pointY];\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * @param {Array.<number>} flatCoordinates Flat coordinates.\r\n * @param {number} offset Offset.\r\n * @param {number} end End.\r\n * @param {number} stride Stride.\r\n * @param {number} m M.\r\n * @param {boolean} extrapolate Extrapolate.\r\n * @return {module:ol/coordinate~Coordinate} Coordinate.\r\n */\r\nexport function lineStringCoordinateAtM(flatCoordinates, offset, end, stride, m, extrapolate) {\r\n  if (end == offset) {\r\n    return null;\r\n  }\r\n  let coordinate;\r\n  if (m < flatCoordinates[offset + stride - 1]) {\r\n    if (extrapolate) {\r\n      coordinate = flatCoordinates.slice(offset, offset + stride);\r\n      coordinate[stride - 1] = m;\r\n      return coordinate;\r\n    } else {\r\n      return null;\r\n    }\r\n  } else if (flatCoordinates[end - 1] < m) {\r\n    if (extrapolate) {\r\n      coordinate = flatCoordinates.slice(end - stride, end);\r\n      coordinate[stride - 1] = m;\r\n      return coordinate;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n  // FIXME use O(1) search\r\n  if (m == flatCoordinates[offset + stride - 1]) {\r\n    return flatCoordinates.slice(offset, offset + stride);\r\n  }\r\n  let lo = offset / stride;\r\n  let hi = end / stride;\r\n  while (lo < hi) {\r\n    const mid = (lo + hi) >> 1;\r\n    if (m < flatCoordinates[(mid + 1) * stride - 1]) {\r\n      hi = mid;\r\n    } else {\r\n      lo = mid + 1;\r\n    }\r\n  }\r\n  const m0 = flatCoordinates[lo * stride - 1];\r\n  if (m == m0) {\r\n    return flatCoordinates.slice((lo - 1) * stride, (lo - 1) * stride + stride);\r\n  }\r\n  const m1 = flatCoordinates[(lo + 1) * stride - 1];\r\n  const t = (m - m0) / (m1 - m0);\r\n  coordinate = [];\r\n  for (let i = 0; i < stride - 1; ++i) {\r\n    coordinate.push(lerp(flatCoordinates[(lo - 1) * stride + i],\r\n      flatCoordinates[lo * stride + i], t));\r\n  }\r\n  coordinate.push(m);\r\n  return coordinate;\r\n}\r\n\r\n\r\n/**\r\n * @param {Array.<number>} flatCoordinates Flat coordinates.\r\n * @param {number} offset Offset.\r\n * @param {Array.<number>} ends Ends.\r\n * @param {number} stride Stride.\r\n * @param {number} m M.\r\n * @param {boolean} extrapolate Extrapolate.\r\n * @param {boolean} interpolate Interpolate.\r\n * @return {module:ol/coordinate~Coordinate} Coordinate.\r\n */\r\nexport function lineStringsCoordinateAtM(\r\n  flatCoordinates, offset, ends, stride, m, extrapolate, interpolate) {\r\n  if (interpolate) {\r\n    return lineStringCoordinateAtM(\r\n      flatCoordinates, offset, ends[ends.length - 1], stride, m, extrapolate);\r\n  }\r\n  let coordinate;\r\n  if (m < flatCoordinates[stride - 1]) {\r\n    if (extrapolate) {\r\n      coordinate = flatCoordinates.slice(0, stride);\r\n      coordinate[stride - 1] = m;\r\n      return coordinate;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n  if (flatCoordinates[flatCoordinates.length - 1] < m) {\r\n    if (extrapolate) {\r\n      coordinate = flatCoordinates.slice(flatCoordinates.length - stride);\r\n      coordinate[stride - 1] = m;\r\n      return coordinate;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n  for (let i = 0, ii = ends.length; i < ii; ++i) {\r\n    const end = ends[i];\r\n    if (offset == end) {\r\n      continue;\r\n    }\r\n    if (m < flatCoordinates[offset + stride - 1]) {\r\n      return null;\r\n    } else if (m <= flatCoordinates[end - 1]) {\r\n      return lineStringCoordinateAtM(\r\n        flatCoordinates, offset, end, stride, m, false);\r\n    }\r\n    offset = end;\r\n  }\r\n  return null;\r\n}\r\n"],"names":["let","const"],"mappings":"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"}