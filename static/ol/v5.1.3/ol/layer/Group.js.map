{"version":3,"file":"Group.js","sources":["../../../src/ol/layer/Group.js"],"sourcesContent":["/**\r\n * @module ol/layer/Group\r\n */\r\nimport {getUid} from '../util.js';\r\nimport Collection from '../Collection.js';\r\nimport CollectionEventType from '../CollectionEventType.js';\r\nimport {getChangeEventType} from '../Object.js';\r\nimport ObjectEventType from '../ObjectEventType.js';\r\nimport {assert} from '../asserts.js';\r\nimport {listen, unlistenByKey} from '../events.js';\r\nimport EventType from '../events/EventType.js';\r\nimport {getIntersection} from '../extent.js';\r\nimport BaseLayer from '../layer/Base.js';\r\nimport {assign, clear} from '../obj.js';\r\nimport SourceState from '../source/State.js';\r\n\r\n\r\n/**\r\n * @typedef {Object} Options\r\n * @property {number} [opacity=1] Opacity (0, 1).\r\n * @property {boolean} [visible=true] Visibility.\r\n * @property {module:ol/extent~Extent} [extent] The bounding extent for layer rendering.  The layer will not be\r\n * rendered outside of this extent.\r\n * @property {number} [zIndex=0] The z-index for layer rendering.  At rendering time, the layers\r\n * will be ordered, first by Z-index and then by position.\r\n * @property {number} [minResolution] The minimum resolution (inclusive) at which this layer will be\r\n * visible.\r\n * @property {number} [maxResolution] The maximum resolution (exclusive) below which this layer will\r\n * be visible.\r\n * @property {(Array.<module:ol/layer/Base>|module:ol/Collection.<module:ol/layer/Base>)} [layers] Child layers.\r\n */\r\n\r\n\r\n/**\r\n * @enum {string}\r\n * @private\r\n */\r\nconst Property = {\r\n  LAYERS: 'layers'\r\n};\r\n\r\n\r\n/**\r\n * @classdesc\r\n * A {@link module:ol/Collection~Collection} of layers that are handled together.\r\n *\r\n * A generic `change` event is triggered when the group/Collection changes.\r\n *\r\n * @api\r\n */\r\nclass LayerGroup extends BaseLayer {\r\n  /**\r\n   * @param {module:ol/layer/Group~Options=} opt_options Layer options.\r\n   */\r\n  constructor(opt_options) {\r\n\r\n    const options = opt_options || {};\r\n    const baseOptions = /** @type {module:ol/layer/Group~Options} */ (assign({}, options));\r\n    delete baseOptions.layers;\r\n\r\n    let layers = options.layers;\r\n\r\n    super(baseOptions);\r\n\r\n    /**\r\n     * @private\r\n     * @type {Array.<module:ol/events~EventsKey>}\r\n     */\r\n    this.layersListenerKeys_ = [];\r\n\r\n    /**\r\n     * @private\r\n     * @type {Object.<string, Array.<module:ol/events~EventsKey>>}\r\n     */\r\n    this.listenerKeys_ = {};\r\n\r\n    listen(this,\r\n      getChangeEventType(Property.LAYERS),\r\n      this.handleLayersChanged_, this);\r\n\r\n    if (layers) {\r\n      if (Array.isArray(layers)) {\r\n        layers = new Collection(layers.slice(), {unique: true});\r\n      } else {\r\n        assert(layers instanceof Collection,\r\n          43); // Expected `layers` to be an array or a `Collection`\r\n        layers = layers;\r\n      }\r\n    } else {\r\n      layers = new Collection(undefined, {unique: true});\r\n    }\r\n\r\n    this.setLayers(layers);\r\n\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  handleLayerChange_() {\r\n    this.changed();\r\n  }\r\n\r\n  /**\r\n   * @param {module:ol/events/Event} event Event.\r\n   * @private\r\n   */\r\n  handleLayersChanged_() {\r\n    this.layersListenerKeys_.forEach(unlistenByKey);\r\n    this.layersListenerKeys_.length = 0;\r\n\r\n    const layers = this.getLayers();\r\n    this.layersListenerKeys_.push(\r\n      listen(layers, CollectionEventType.ADD, this.handleLayersAdd_, this),\r\n      listen(layers, CollectionEventType.REMOVE, this.handleLayersRemove_, this)\r\n    );\r\n\r\n    for (const id in this.listenerKeys_) {\r\n      this.listenerKeys_[id].forEach(unlistenByKey);\r\n    }\r\n    clear(this.listenerKeys_);\r\n\r\n    const layersArray = layers.getArray();\r\n    for (let i = 0, ii = layersArray.length; i < ii; i++) {\r\n      const layer = layersArray[i];\r\n      this.listenerKeys_[getUid(layer).toString()] = [\r\n        listen(layer, ObjectEventType.PROPERTYCHANGE, this.handleLayerChange_, this),\r\n        listen(layer, EventType.CHANGE, this.handleLayerChange_, this)\r\n      ];\r\n    }\r\n\r\n    this.changed();\r\n  }\r\n\r\n  /**\r\n   * @param {module:ol/Collection~CollectionEvent} collectionEvent CollectionEvent.\r\n   * @private\r\n   */\r\n  handleLayersAdd_(collectionEvent) {\r\n    const layer = /** @type {module:ol/layer/Base} */ (collectionEvent.element);\r\n    const key = getUid(layer).toString();\r\n    this.listenerKeys_[key] = [\r\n      listen(layer, ObjectEventType.PROPERTYCHANGE, this.handleLayerChange_, this),\r\n      listen(layer, EventType.CHANGE, this.handleLayerChange_, this)\r\n    ];\r\n    this.changed();\r\n  }\r\n\r\n  /**\r\n   * @param {module:ol/Collection~CollectionEvent} collectionEvent CollectionEvent.\r\n   * @private\r\n   */\r\n  handleLayersRemove_(collectionEvent) {\r\n    const layer = /** @type {module:ol/layer/Base} */ (collectionEvent.element);\r\n    const key = getUid(layer).toString();\r\n    this.listenerKeys_[key].forEach(unlistenByKey);\r\n    delete this.listenerKeys_[key];\r\n    this.changed();\r\n  }\r\n\r\n  /**\r\n   * Returns the {@link module:ol/Collection collection} of {@link module:ol/layer/Layer~Layer layers}\r\n   * in this group.\r\n   * @return {!module:ol/Collection.<module:ol/layer/Base>} Collection of\r\n   *   {@link module:ol/layer/Base layers} that are part of this group.\r\n   * @observable\r\n   * @api\r\n   */\r\n  getLayers() {\r\n    return (\r\n      /** @type {!module:ol/Collection.<module:ol/layer/Base>} */ (this.get(Property.LAYERS))\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Set the {@link module:ol/Collection collection} of {@link module:ol/layer/Layer~Layer layers}\r\n   * in this group.\r\n   * @param {!module:ol/Collection.<module:ol/layer/Base>} layers Collection of\r\n   *   {@link module:ol/layer/Base layers} that are part of this group.\r\n   * @observable\r\n   * @api\r\n   */\r\n  setLayers(layers) {\r\n    this.set(Property.LAYERS, layers);\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  getLayersArray(opt_array) {\r\n    const array = opt_array !== undefined ? opt_array : [];\r\n    this.getLayers().forEach(function(layer) {\r\n      layer.getLayersArray(array);\r\n    });\r\n    return array;\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  getLayerStatesArray(opt_states) {\r\n    const states = opt_states !== undefined ? opt_states : [];\r\n\r\n    const pos = states.length;\r\n\r\n    this.getLayers().forEach(function(layer) {\r\n      layer.getLayerStatesArray(states);\r\n    });\r\n\r\n    const ownLayerState = this.getLayerState();\r\n    for (let i = pos, ii = states.length; i < ii; i++) {\r\n      const layerState = states[i];\r\n      layerState.opacity *= ownLayerState.opacity;\r\n      layerState.visible = layerState.visible && ownLayerState.visible;\r\n      layerState.maxResolution = Math.min(\r\n        layerState.maxResolution, ownLayerState.maxResolution);\r\n      layerState.minResolution = Math.max(\r\n        layerState.minResolution, ownLayerState.minResolution);\r\n      if (ownLayerState.extent !== undefined) {\r\n        if (layerState.extent !== undefined) {\r\n          layerState.extent = getIntersection(layerState.extent, ownLayerState.extent);\r\n        } else {\r\n          layerState.extent = ownLayerState.extent;\r\n        }\r\n      }\r\n    }\r\n\r\n    return states;\r\n  }\r\n\r\n  /**\r\n   * @inheritDoc\r\n   */\r\n  getSourceState() {\r\n    return SourceState.READY;\r\n  }\r\n}\r\n\r\n\r\nexport default LayerGroup;\r\n"],"names":["const","let","super","this"],"mappings":"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"}