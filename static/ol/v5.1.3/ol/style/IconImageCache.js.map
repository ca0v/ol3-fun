{"version":3,"file":"IconImageCache.js","sources":["../../../src/ol/style/IconImageCache.js"],"sourcesContent":["/**\r\n * @module ol/style/IconImageCache\r\n */\r\nimport {asString} from '../color.js';\r\n\r\n/**\r\n * @classdesc\r\n * Singleton class. Available through {@link module:ol/style/IconImageCache~shared}.\r\n */\r\nclass IconImageCache {\r\n  constructor() {\r\n\r\n    /**\r\n    * @type {!Object.<string, module:ol/style/IconImage>}\r\n    * @private\r\n    */\r\n    this.cache_ = {};\r\n\r\n    /**\r\n    * @type {number}\r\n    * @private\r\n    */\r\n    this.cacheSize_ = 0;\r\n\r\n    /**\r\n    * @type {number}\r\n    * @private\r\n    */\r\n    this.maxCacheSize_ = 32;\r\n  }\r\n\r\n  /**\r\n  * FIXME empty description for jsdoc\r\n  */\r\n  clear() {\r\n    this.cache_ = {};\r\n    this.cacheSize_ = 0;\r\n  }\r\n\r\n  /**\r\n  * FIXME empty description for jsdoc\r\n  */\r\n  expire() {\r\n    if (this.cacheSize_ > this.maxCacheSize_) {\r\n      let i = 0;\r\n      for (const key in this.cache_) {\r\n        const iconImage = this.cache_[key];\r\n        if ((i++ & 3) === 0 && !iconImage.hasListener()) {\r\n          delete this.cache_[key];\r\n          --this.cacheSize_;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n  * @param {string} src Src.\r\n  * @param {?string} crossOrigin Cross origin.\r\n  * @param {module:ol/color~Color} color Color.\r\n  * @return {module:ol/style/IconImage} Icon image.\r\n  */\r\n  get(src, crossOrigin, color) {\r\n    const key = getKey(src, crossOrigin, color);\r\n    return key in this.cache_ ? this.cache_[key] : null;\r\n  }\r\n\r\n  /**\r\n  * @param {string} src Src.\r\n  * @param {?string} crossOrigin Cross origin.\r\n  * @param {module:ol/color~Color} color Color.\r\n  * @param {module:ol/style/IconImage} iconImage Icon image.\r\n  */\r\n  set(src, crossOrigin, color, iconImage) {\r\n    const key = getKey(src, crossOrigin, color);\r\n    this.cache_[key] = iconImage;\r\n    ++this.cacheSize_;\r\n  }\r\n\r\n  /**\r\n  * Set the cache size of the icon cache. Default is `32`. Change this value when\r\n  * your map uses more than 32 different icon images and you are not caching icon\r\n  * styles on the application level.\r\n  * @param {number} maxCacheSize Cache max size.\r\n  * @api\r\n  */\r\n  setSize(maxCacheSize) {\r\n    this.maxCacheSize_ = maxCacheSize;\r\n    this.expire();\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * @param {string} src Src.\r\n * @param {?string} crossOrigin Cross origin.\r\n * @param {module:ol/color~Color} color Color.\r\n * @return {string} Cache key.\r\n */\r\nfunction getKey(src, crossOrigin, color) {\r\n  const colorString = color ? asString(color) : 'null';\r\n  return crossOrigin + ':' + src + ':' + colorString;\r\n}\r\n\r\n\r\nexport default IconImageCache;\r\n\r\n\r\n/**\r\n * The {@link module:ol/style/IconImageCache~IconImageCache} for\r\n * {@link module:ol/style/Icon~Icon} images.\r\n * @api\r\n */\r\nexport const shared = new IconImageCache();\r\n"],"names":["let","const","this"],"mappings":"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"}