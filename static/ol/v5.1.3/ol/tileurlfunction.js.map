{"version":3,"file":"tileurlfunction.js","sources":["../../src/ol/tileurlfunction.js"],"sourcesContent":["/**\r\n * @module ol/tileurlfunction\r\n */\r\nimport {assert} from './asserts.js';\r\nimport {modulo} from './math.js';\r\nimport {hash as tileCoordHash} from './tilecoord.js';\r\n\r\n\r\n/**\r\n * @param {string} template Template.\r\n * @param {module:ol/tilegrid/TileGrid} tileGrid Tile grid.\r\n * @return {module:ol/Tile~UrlFunction} Tile URL function.\r\n */\r\nexport function createFromTemplate(template, tileGrid) {\r\n  const zRegEx = /\\{z\\}/g;\r\n  const xRegEx = /\\{x\\}/g;\r\n  const yRegEx = /\\{y\\}/g;\r\n  const dashYRegEx = /\\{-y\\}/g;\r\n  return (\r\n    /**\r\n     * @param {module:ol/tilecoord~TileCoord} tileCoord Tile Coordinate.\r\n     * @param {number} pixelRatio Pixel ratio.\r\n     * @param {module:ol/proj/Projection} projection Projection.\r\n     * @return {string|undefined} Tile URL.\r\n     */\r\n    function(tileCoord, pixelRatio, projection) {\r\n      if (!tileCoord) {\r\n        return undefined;\r\n      } else {\r\n        return template.replace(zRegEx, tileCoord[0].toString())\r\n          .replace(xRegEx, tileCoord[1].toString())\r\n          .replace(yRegEx, function() {\r\n            const y = -tileCoord[2] - 1;\r\n            return y.toString();\r\n          })\r\n          .replace(dashYRegEx, function() {\r\n            const z = tileCoord[0];\r\n            const range = tileGrid.getFullTileRange(z);\r\n            assert(range, 55); // The {-y} placeholder requires a tile grid with extent\r\n            const y = range.getHeight() + tileCoord[2];\r\n            return y.toString();\r\n          });\r\n      }\r\n    }\r\n  );\r\n}\r\n\r\n\r\n/**\r\n * @param {Array.<string>} templates Templates.\r\n * @param {module:ol/tilegrid/TileGrid} tileGrid Tile grid.\r\n * @return {module:ol/Tile~UrlFunction} Tile URL function.\r\n */\r\nexport function createFromTemplates(templates, tileGrid) {\r\n  const len = templates.length;\r\n  const tileUrlFunctions = new Array(len);\r\n  for (let i = 0; i < len; ++i) {\r\n    tileUrlFunctions[i] = createFromTemplate(templates[i], tileGrid);\r\n  }\r\n  return createFromTileUrlFunctions(tileUrlFunctions);\r\n}\r\n\r\n\r\n/**\r\n * @param {Array.<module:ol/Tile~UrlFunction>} tileUrlFunctions Tile URL Functions.\r\n * @return {module:ol/Tile~UrlFunction} Tile URL function.\r\n */\r\nexport function createFromTileUrlFunctions(tileUrlFunctions) {\r\n  if (tileUrlFunctions.length === 1) {\r\n    return tileUrlFunctions[0];\r\n  }\r\n  return (\r\n    /**\r\n     * @param {module:ol/tilecoord~TileCoord} tileCoord Tile Coordinate.\r\n     * @param {number} pixelRatio Pixel ratio.\r\n     * @param {module:ol/proj/Projection} projection Projection.\r\n     * @return {string|undefined} Tile URL.\r\n     */\r\n    function(tileCoord, pixelRatio, projection) {\r\n      if (!tileCoord) {\r\n        return undefined;\r\n      } else {\r\n        const h = tileCoordHash(tileCoord);\r\n        const index = modulo(h, tileUrlFunctions.length);\r\n        return tileUrlFunctions[index](tileCoord, pixelRatio, projection);\r\n      }\r\n    }\r\n  );\r\n}\r\n\r\n\r\n/**\r\n * @param {module:ol/tilecoord~TileCoord} tileCoord Tile coordinate.\r\n * @param {number} pixelRatio Pixel ratio.\r\n * @param {module:ol/proj/Projection} projection Projection.\r\n * @return {string|undefined} Tile URL.\r\n */\r\nexport function nullTileUrlFunction(tileCoord, pixelRatio, projection) {\r\n  return undefined;\r\n}\r\n\r\n\r\n/**\r\n * @param {string} url URL.\r\n * @return {Array.<string>} Array of urls.\r\n */\r\nexport function expandUrl(url) {\r\n  const urls = [];\r\n  let match = /\\{([a-z])-([a-z])\\}/.exec(url);\r\n  if (match) {\r\n    // char range\r\n    const startCharCode = match[1].charCodeAt(0);\r\n    const stopCharCode = match[2].charCodeAt(0);\r\n    let charCode;\r\n    for (charCode = startCharCode; charCode <= stopCharCode; ++charCode) {\r\n      urls.push(url.replace(match[0], String.fromCharCode(charCode)));\r\n    }\r\n    return urls;\r\n  }\r\n  match = match = /\\{(\\d+)-(\\d+)\\}/.exec(url);\r\n  if (match) {\r\n    // number range\r\n    const stop = parseInt(match[2], 10);\r\n    for (let i = parseInt(match[1], 10); i <= stop; i++) {\r\n      urls.push(url.replace(match[0], i.toString()));\r\n    }\r\n    return urls;\r\n  }\r\n  urls.push(url);\r\n  return urls;\r\n}\r\n"],"names":["const","let"],"mappings":"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"}